<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.svg"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>raynor</title><meta name="description" content="raynor's messy notebook.">
    <link rel="modulepreload" href="/assets/app.6a98a4dc.js"><link rel="modulepreload" href="/assets/SpringCloud.html.a447426f.js"><link rel="modulepreload" href="/assets/SpringCloud.html.b60a7f17.js">
    <link rel="stylesheet" href="/assets/style.c88710ac.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/favicon.svg" alt="raynor"><span class="site-name can-hide">raynor</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/java/" class="router-link-active" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/database/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/js/" class="" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ops/" class="" aria-label="OPS"><!--[--><!--]--> OPS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/practice/" class="" aria-label="Practice"><!--[--><!--]--> Practice <!--[--><!--]--></a></div><div class="navbar-item"><a href="/snippets/" class="" aria-label="Snippets"><!--[--><!--]--> Snippets <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><div class="navbar-buttons"><a rel="noopener noreferrer" target="_blank" href="https://github.com/zongkx/zongkx.github.io"><svg class="ov-icon" style="font-size:1.26em;" aria-hidden="true" width="20.16" height="20.16" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32 0 01-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 01.676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 01.63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731 0 0112 3.315c.912 0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 01.616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293 0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492 0 01-.012 2.716 1 1 0 01-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998 0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66 0-.955-.312-1.744-.913-2.404a1 1 0 01-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 01-.833.135A9.626 9.626 0 0012 5.315c-.89 0-1.772.119-2.592.35a1 1 0 01-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 01-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 01-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/></svg></a><a rel="noopener noreferrer" target="_blank" href="https://zongkx.icu"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.12 17.023l-4.199-2.29a4 4 0 110-5.465l4.2-2.29a4 4 0 11.959 1.755l-4.2 2.29a4.008 4.008 0 010 1.954l4.199 2.29a4 4 0 11-.959 1.755zM6 14a2 2 0 100-4 2 2 0 000 4zm11-6a2 2 0 100-4 2 2 0 000 4zm0 12a2 2 0 100-4 2 2 0 000 4z"/></svg></a><button class="toggle-dark-button" title="toggle dark mode"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor" focusable="false"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 110-12 6 6 0 010 12zm0-2a4 4 0 100-8 4 4 0 000 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor" focusable="false"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0012 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0010 7zm-6 5a8 8 0 0015.062 3.762A9 9 0 018.238 4.938 7.999 7.999 0 004 12z"/></svg></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/java/" class="router-link-active" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/database/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/js/" class="" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ops/" class="" aria-label="OPS"><!--[--><!--]--> OPS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/practice/" class="" aria-label="Practice"><!--[--><!--]--> Practice <!--[--><!--]--></a></div><div class="navbar-item"><a href="/snippets/" class="" aria-label="Snippets"><!--[--><!--]--> Snippets <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/java/CSV_Writer.html" class="sidebar-item" aria-label="CSV_Writer.md"><!--[--><!--]--> CSV_Writer.md <!--[--><!--]--></a><!----></li><li><a href="/java/Graylog.html" class="sidebar-item" aria-label="Graylog.md"><!--[--><!--]--> Graylog.md <!--[--><!--]--></a><!----></li><li><a href="/java/Guava.html" class="sidebar-item" aria-label="Guava.md"><!--[--><!--]--> Guava.md <!--[--><!--]--></a><!----></li><li><a href="/java/IDEAlive_template.html" class="sidebar-item" aria-label="IDEAlive_template.md"><!--[--><!--]--> IDEAlive_template.md <!--[--><!--]--></a><!----></li><li><a href="/java/Jackson.html" class="sidebar-item" aria-label="Jackson.md"><!--[--><!--]--> Jackson.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Lamdba.html" class="sidebar-item" aria-label="Java-Lamdba.md"><!--[--><!--]--> Java-Lamdba.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Stream_%E9%9B%86%E5%90%88.html" class="sidebar-item" aria-label="Java-Stream_集合.md"><!--[--><!--]--> Java-Stream_集合.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Thread.html" class="sidebar-item" aria-label="Java-Thread.md"><!--[--><!--]--> Java-Thread.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E5%8F%8D%E5%B0%84_%E6%B3%9B%E5%9E%8B.html" class="sidebar-item" aria-label="Java-反射_泛型.md"><!--[--><!--]--> Java-反射_泛型.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B8%B8%E9%87%8F.html" class="sidebar-item" aria-label="Java-常见的常量.md"><!--[--><!--]--> Java-常见的常量.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E9%9D%A2%E8%AF%95.html" class="sidebar-item" aria-label="Java-面试.md"><!--[--><!--]--> Java-面试.md <!--[--><!--]--></a><!----></li><li><a href="/java/JavaUtils.html" class="sidebar-item" aria-label="JavaUtils.md"><!--[--><!--]--> JavaUtils.md <!--[--><!--]--></a><!----></li><li><a href="/java/JdbcTemplate.html" class="sidebar-item" aria-label="JdbcTemplate.md"><!--[--><!--]--> JdbcTemplate.md <!--[--><!--]--></a><!----></li><li><a href="/java/Json.html" class="sidebar-item" aria-label="Json.md"><!--[--><!--]--> Json.md <!--[--><!--]--></a><!----></li><li><a href="/java/Maven.html" class="sidebar-item" aria-label="Maven.md"><!--[--><!--]--> Maven.md <!--[--><!--]--></a><!----></li><li><a href="/java/Minio.html" class="sidebar-item" aria-label="Minio.md"><!--[--><!--]--> Minio.md <!--[--><!--]--></a><!----></li><li><a href="/java/Nacos.html" class="sidebar-item" aria-label="Nacos.md"><!--[--><!--]--> Nacos.md <!--[--><!--]--></a><!----></li><li><a href="/java/OkHttp3.html" class="sidebar-item" aria-label="OkHttp3.md"><!--[--><!--]--> OkHttp3.md <!--[--><!--]--></a><!----></li><li><a href="/java/OpenFeign.html" class="sidebar-item" aria-label="OpenFeign.md"><!--[--><!--]--> OpenFeign.md <!--[--><!--]--></a><!----></li><li><a href="/java/" class="router-link-active sidebar-item" aria-label="Dev"><!--[--><!--]--> Dev <!--[--><!--]--></a><!----></li><li><a href="/java/RestTemplate.html" class="sidebar-item" aria-label="RestTemplate.md"><!--[--><!--]--> RestTemplate.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot-%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86DataSourceBean.html" class="sidebar-item" aria-label="SpringBoot-动态管理DataSourceBean.md"><!--[--><!--]--> SpringBoot-动态管理DataSourceBean.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="SpringBoot基础.md"><!--[--><!--]--> SpringBoot基础.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot%E8%BF%9B%E9%98%B6.html" class="sidebar-item" aria-label="SpringBoot进阶.md"><!--[--><!--]--> SpringBoot进阶.md <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="SpringCloud.md"><!--[--><!--]--> SpringCloud.md <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringCloud.html#概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringCloud.html#什么是微服务" class="router-link-active router-link-exact-active sidebar-item" aria-label="什么是微服务"><!--[--><!--]--> 什么是微服务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#微服务的四个核心问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="微服务的四个核心问题"><!--[--><!--]--> 微服务的四个核心问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#解决方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#微服务带来的负面问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="微服务带来的负面问题"><!--[--><!--]--> 微服务带来的负面问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#微服务的各种组件" class="router-link-active router-link-exact-active sidebar-item" aria-label="微服务的各种组件"><!--[--><!--]--> 微服务的各种组件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#微服务的下一代发展" class="router-link-active router-link-exact-active sidebar-item" aria-label="微服务的下一代发展"><!--[--><!--]--> 微服务的下一代发展 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringCloud.html#dubbo" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringCloud.html#依赖和配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="依赖和配置"><!--[--><!--]--> 依赖和配置 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringCloud.html#springcloud" class="router-link-active router-link-exact-active sidebar-item" aria-label="SpringCloud"><!--[--><!--]--> SpringCloud <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringCloud.html#eureka" class="router-link-active router-link-exact-active sidebar-item" aria-label="Eureka"><!--[--><!--]--> Eureka <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#eureka和zookeeper" class="router-link-active router-link-exact-active sidebar-item" aria-label="Eureka和Zookeeper"><!--[--><!--]--> Eureka和Zookeeper <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#ribbon" class="router-link-active router-link-exact-active sidebar-item" aria-label="Ribbon"><!--[--><!--]--> Ribbon <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#feign" class="router-link-active router-link-exact-active sidebar-item" aria-label="Feign"><!--[--><!--]--> Feign <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#hystrix-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hystrix"><!--[--><!--]--> Hystrix <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#dashboard" class="router-link-active router-link-exact-active sidebar-item" aria-label="DashBoard"><!--[--><!--]--> DashBoard <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#gateway" class="router-link-active router-link-exact-active sidebar-item" aria-label="Gateway"><!--[--><!--]--> Gateway <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#config" class="router-link-active router-link-exact-active sidebar-item" aria-label="Config"><!--[--><!--]--> Config <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#bus" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bus"><!--[--><!--]--> Bus <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#sleuth" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sleuth"><!--[--><!--]--> Sleuth <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringCloud.html#springcloud-alibaba-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="SpringCloud Alibaba"><!--[--><!--]--> SpringCloud Alibaba <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringCloud.html#nacos" class="router-link-active router-link-exact-active sidebar-item" aria-label="Nacos"><!--[--><!--]--> Nacos <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#配置中心" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置中心"><!--[--><!--]--> 配置中心 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringCloud.html#客户端整合ribbon-openfeign" class="router-link-active router-link-exact-active sidebar-item" aria-label="客户端整合Ribbon/OpenFeign"><!--[--><!--]--> 客户端整合Ribbon/OpenFeign <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/java/Spring%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="Spring基础.md"><!--[--><!--]--> Spring基础.md <!--[--><!--]--></a><!----></li><li><a href="/java/WPS.html" class="sidebar-item" aria-label="WPS.md"><!--[--><!--]--> WPS.md <!--[--><!--]--></a><!----></li><li><a href="/java/%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6.html" class="sidebar-item" aria-label="安全框架.md"><!--[--><!--]--> 安全框架.md <!--[--><!--]--></a><!----></li><li><a href="/java/%E6%B5%8B%E8%AF%95.html" class="sidebar-item" aria-label="测试.md"><!--[--><!--]--> 测试.md <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><h3 id="什么是微服务" tabindex="-1"><a class="header-anchor" href="#什么是微服务" aria-hidden="true">#</a> 什么是微服务</h3><p>从项目发展的历程来说，从最开始的All in one到垂直应用架构，伴随着项目的复杂度的提升，为了解决可靠性、拓展性，慢慢发展出了微服务架构的模式。 垂直应用架构虽然已经对各个模块做了拆分，但是并仍然存在代码复用性差、靠可行低的问题，而微服务架构的核心便是通过业务拆分单个服务，通过网络传输进行通信，通过统一的服务治理、负载均衡等实现易于拓展、高可用低耦合的目的。对于JavaWeb开发而言，微服务就是针对某个具体单一的业务需求而实现的程序，微服务架构提倡系统拆分为各个微服务，通过各个服务的协调配合来实现业务系统。</p><h3 id="微服务的四个核心问题" tabindex="-1"><a class="header-anchor" href="#微服务的四个核心问题" aria-hidden="true">#</a> 微服务的四个核心问题</h3><ol><li>服务很多，客户端该怎么访问？</li></ol><p>通过路由网关来实现：代理、路由、过滤的功能 ;实现外部访问统一入口的基础而过滤器功能则负责对请求的处理过程进行干预,是实现请求校验、服务聚合等功能的基础.</p><ol start="2"><li>服务之间通信问题？</li></ol><p>服务之间通信问题可以通过HTTP协议或者RPC协议来实现</p><ol start="3"><li>服务很多，怎么治理？</li></ol><p>其核心就是需要一个服务注册、发现的机制。</p><ol start="4"><li>服务很多，挂了怎么办？</li></ol><p>微服务的核心问题就是服务事故的解决，其解决依赖于系统的容灾机制。</p><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h3><h4 id="dubbo-zookeeper" tabindex="-1"><a class="header-anchor" href="#dubbo-zookeeper" aria-hidden="true">#</a> Dubbo+Zookeeper</h4><p>相较于SpringCloud，Dubbo更像一个纯粹的实现RPC通信的架构，它往往配合Zookeeper提供的服务注册发现中心的功能，来实现半自动的微服务系统架构的搭建。 该方案缺少API网关、熔断机制，需要第三方组件或者手动实现。</p><blockquote><p>RPC和HTTP协议</p></blockquote><h4 id="springcloud-netflix" tabindex="-1"><a class="header-anchor" href="#springcloud-netflix" aria-hidden="true">#</a> SpringCloud Netflix</h4><p>API网关：Zuul 通信：Feign（基于HttpClient通信，同步阻塞） 服务注册发现：Eureka 熔断机制：Hystrix</p><h4 id="springcloud-alibaba" tabindex="-1"><a class="header-anchor" href="#springcloud-alibaba" aria-hidden="true">#</a> SpringCloud Alibaba</h4><p>由于Netflix中部分组件已经停更的问题，去年秋季Alibaba成功孵化，其核心还是一站式微服务解决方案。未来可能会得到更多应用。</p><h3 id="微服务带来的负面问题" tabindex="-1"><a class="header-anchor" href="#微服务带来的负面问题" aria-hidden="true">#</a> 微服务带来的负面问题</h3><p>运维压力增大；系统部署依赖；通信成本；数据一致性问题；</p><h3 id="微服务的各种组件" tabindex="-1"><a class="header-anchor" href="#微服务的各种组件" aria-hidden="true">#</a> 微服务的各种组件</h3><ol><li>服务配置管理：Archaius、Diamond</li><li>服务注册发现：Eureka、Zookeeper、Consul</li><li>服务调用：Rest、RPC、gRPC</li><li>服务熔断器：Hystrix 、 Envoy</li><li>负载均衡：Ribbon、Nginx</li><li>服务接口调用（客户端调用服务简化工具）：Feign</li><li>消息队列：Kafka、RabbtiMQ、ActiveMQ</li><li>服务配置中心管理：SpringCloudConfig、Chef</li><li>服务路由（API网关）：Zuul</li><li>服务监控：Zabbix、Nagios、Metrics、Specataor</li><li>全链路追踪：Zipkin、Brave、Dapper</li><li>服务部署：Docker、OpenStack、Kubernetes</li><li>数据流操作开发包：SpringCloudStream</li><li>事件消息总线：SpringCloudBus</li></ol><h3 id="微服务的下一代发展" tabindex="-1"><a class="header-anchor" href="#微服务的下一代发展" aria-hidden="true">#</a> 微服务的下一代发展</h3><p>服务网格ServiceMesh，产品比如Istio</p><h2 id="dubbo" tabindex="-1"><a class="header-anchor" href="#dubbo" aria-hidden="true">#</a> Dubbo</h2><p>之前已经学习使用了Dubbo+Zookeeper，其版本相较于目前更低， <a href="https://blog.csdn.net/ZzzPaul/article/details/82343603" target="_blank" rel="noopener noreferrer">Dubbo2.6</a> 不过最新版的2.7.5在具体的使用上区别不大，下面只对有变化的地方：</p><h3 id="依赖和配置" tabindex="-1"><a class="header-anchor" href="#依赖和配置" aria-hidden="true">#</a> 依赖和配置</h3><p>新增了curator-recipes依赖，同时需要排除log4j解决依赖冲突。其余除了@Service和@Reference包路径变化之外，仍然可以使用。下面例子使用了Zookeeper，其相关配置安装参考如下：<a href="https://blog.csdn.net/ZzzPaul/article/details/82315287" target="_blank" rel="noopener noreferrer">ZK和Dubbo Admin</a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> 	&lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
            &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;
            &lt;version&gt;2.8.0&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                        &lt;groupId&gt;log4j&lt;/groupId&gt;
                        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.101tec&lt;/groupId&gt;
            &lt;artifactId&gt;zkclient&lt;/artifactId&gt;
            &lt;version&gt;0.11&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="provider" tabindex="-1"><a class="header-anchor" href="#provider" aria-hidden="true">#</a> provider</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># Service version
demo.service.version = 1.0.0
# Base packages to scan Dubbo Components (e.g @Service , @Reference)
dubbo.scan.basePackages  = com.demo.provider.service

# Dubbo Config properties
## ApplicationConfig Bean
#提供发应用名称,用于计算依赖关系
dubbo.application.id = my-dubbo-provider
dubbo.application.name = my-dubbo-provider


## ProtocolConfig Bean
#使用dubbo协议,在12345端口暴露服务
dubbo.protocol.id = dubbo
dubbo.protocol.name = dubbo
dubbo.protocol.port = 12345

## RegistryConfig Bean
#使用zookeeper注册中心暴露服务地址
dubbo.registry.id = my-registry
dubbo.registry.address = zookeeper://127.0.0.1:2181
#dubbo.registry.address = N/A
@org.apache.dubbo.config.annotation.Service(
        version = &quot;${demo.service.version}&quot;,
        application = &quot;${dubbo.application.id}&quot;,
        protocol = &quot;${dubbo.protocol.id}&quot;,
        registry = &quot;${dubbo.registry.id}&quot;
)
@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserMapper userMapper;

    @Override
    public List&lt;User&gt; userList() {
        QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;();
        return userMapper.selectList(queryWrapper);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="consumer" tabindex="-1"><a class="header-anchor" href="#consumer" aria-hidden="true">#</a> consumer</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># Dubbo Config properties
## ApplicationConfig Bean消费方应用名称,用于计算依赖关系,不是匹配条件,不能和提供方名称一样
dubbo.application.id = my-dubbo-consumer
dubbo.application.name = my-dubbo-consumer

dubbo.service.version = 1.0.0

dubbo.registry.id = my-registry
dubbo.registry.address = zookeeper://127.0.0.1:2181
dubbo.registry.check=false

## ProtocolConfig Bean
dubbo.protocol.id = dubbo
dubbo.protocol.name = dubbo
dubbo.protocol.port = 12345
@RestController
public class IndexController {

    @Reference(version = &quot;1.0.0&quot;)
    private UserService userService;

    @GetMapping(&quot;/users&quot;)
    public List&lt;User&gt; get(){
        return userService.userList();
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="springcloud" tabindex="-1"><a class="header-anchor" href="#springcloud" aria-hidden="true">#</a> SpringCloud</h2><p>之后的SpringCloud将会以Netflix为主，版本为Hoxton.SR3，SpringBoot版本为2.2.4.RELEASE，这两者的版本需要相互配合：</p><blockquote><p>Hoxton 2.2.x Greenwich 2.1.x Finchley 2.0.x Edgware 1.5.x Dalston 1.5.x</p></blockquote><p>Spring Cloud的子项目，大致可分成两类，一类是对现有成熟框架&quot;Spring Boot化&quot;的封装和抽象，也是数量最多的项目；第二类是开发了一部分分布式系统的基础设施的实现，如Spring Cloud Stream扮演的就是kafka, ActiveMQ这样的角色。</p><h3 id="eureka" tabindex="-1"><a class="header-anchor" href="#eureka" aria-hidden="true">#</a> Eureka</h3><blockquote><p>在微服务架构中往往会有一个注册中心，每个微服务都会向注册中心去注册自己的地址及端口信息，注册中心维护着服务名称与服务实例的对应关系。每个微服务都会定时从注册中心获取服务列表，同时汇报自己的运行情况，这样当有的服务需要调用其他服务时，就可以从自己获取到的服务列表中获取实例地址进行调用，Eureka实现了这套服务注册与发现机制。</p></blockquote><h3 id="eureka和zookeeper" tabindex="-1"><a class="header-anchor" href="#eureka和zookeeper" aria-hidden="true">#</a> Eureka和Zookeeper</h3><p>分布式结构的CAP定理：指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），最多只能同时三个特性中的两个，三者不可兼得。</p><blockquote><p>RDBMS==&gt;（MySql,Oracle,SqlServer等关系型数据库）遵循的原则是：ACID原则（A：原子性。C：一致性。I：独立性。D：持久性。）。 NoSql==&gt;  （redis,Mogodb等非关系型数据库）遵循的原则是：CAP原则</p></blockquote><blockquote><p>Zookeeper是CP放弃A，zookeeper分布式集群是使用主从模型实现的，在一个时间点上，只有一个leader真正的对外提供服务。其他的slave都会实时备份leader中的数据，当leader宕机，则slave选举出新的leader对外提供服务。 eureka是AP放弃C，eureka分布集群是平等模型（无主模型），所有的节点都是平等的，客户端访问任意节点都可以提供实时的服务响应。如果某节点发生宕机等故障，接收到的请求会转交给其他的节点。无主模型，每个节点的数据可能不实时一致，节点需要通过网络通讯从其他节点获取数据，并实现数据的一致，可能有网络延迟或者网络故障或者通讯频率问题。</p></blockquote><p>Eureka Server和Client</p><p>Eureka是BS架构，相比于Zookeeper本地运行客户端，需要手动实现Eureka注册中心。 Eureka Cilent是一个Java客户端，类似于Zookeeper的zk-client，都是用于简化和注册中心的交互，它内置了使用轮询算法的负载均衡器，在应用启动后将会向Eureka Server发送心跳（默认30秒）。如果Server在多个心跳周期内没有接收到某个客户端的心跳（90秒），将会移除该节点</p><h4 id="依赖和配置-1" tabindex="-1"><a class="header-anchor" href="#依赖和配置-1" aria-hidden="true">#</a> 依赖和配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;
        &lt;/dependency&gt;
 	&lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
server:
  port: 8001
spring:
  application:
    name: eureka-server
eureka:
  instance:
    hostname: localhost #server的实例名称
  client:
    fetch-registry: false #是否向注册中心注册自己
    register-with-eureka: false #false表示自己是注册中心
    service-url:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ # 监控页面
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>在启动类上添加注解：@EnableEurekaServer，启动后访问http://localhost:8001/即可。</p><h4 id="添加客户端" tabindex="-1"><a class="header-anchor" href="#添加客户端" aria-hidden="true">#</a> 添加客户端</h4><p>新建模块 client-eureka</p><h4 id="依赖和配置-2" tabindex="-1"><a class="header-anchor" href="#依赖和配置-2" aria-hidden="true">#</a> 依赖和配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
    
&lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
# 指定运行端口
server:
  port: 8002

# 指定服务名称
spring:
  application:
    name: eureka-client
eureka:
  client:
    # 注册到Eureka的注册中心
    register-with-eureka: true
    # 获取注册实例列表
    fetch-registry: true
    service-url:
      # 配置注册中心地址
      defaultZone: http://localhost:8001/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>启动类添加注解@EnableEurekaClient即可，</p><blockquote><p>@EnableDiscoveryClient和@EnableEurekaClient共同点就是：都是能够让注册中心能够发现，扫描到改服务。</p></blockquote><blockquote><p>不同点：@EnableEurekaClient只适用于Eureka作为注册中心，@EnableDiscoveryClient 可以是其他注册中心。</p></blockquote><p>再次访问<a href="http://localhost:8001%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0/" target="_blank" rel="noopener noreferrer">http://localhost:8001即可看到</a></p><blockquote><p>Application AMIs Availability Zones Status EUREKA-CLIENT n/a (1) (1) UP (1) - NoteBook:eureka-client:8002</p></blockquote><h4 id="搭建eureka注册中心集群" tabindex="-1"><a class="header-anchor" href="#搭建eureka注册中心集群" aria-hidden="true">#</a> 搭建Eureka注册中心集群</h4><blockquote><p>由于所有服务都会注册到注册中心去，服务之间的调用都是通过从注册中心获取的服务列表来调用，注册中心一旦宕机，所有服务调用都会出现问题。所以我们需要多个注册中心组成集群来提供服务，下面将搭建一个双节点的注册中心集群。</p></blockquote><h5 id="搭建两个注册中心" tabindex="-1"><a class="header-anchor" href="#搭建两个注册中心" aria-hidden="true">#</a> 搭建两个注册中心</h5><p>首先给server-eureka添加两个配置文件 application-replica1.yml和application-replica2.yml</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>server:
  port: 8002
spring:
  application:
    name: eureka-server1
eureka:
  instance:
    hostname: replica1 #server的实例名称
  client:
    fetch-registry: true #是否向注册中心注册自己
    register-with-eureka: true #false表示自己是注册中心
    service-url:
      defaultZone: http://${eureka.instance.hostname}:8003/eureka/ # 监控页面
server:
  port: 8003
spring:
  application:
    name: eureka-server2
eureka:
  instance:
    hostname: replica2 #server的实例名称
  client:
    fetch-registry: true #是否向注册中心注册自己
    register-with-eureka: true #false表示自己是注册中心
    service-url:
      defaultZone: http://${eureka.instance.hostname}:8002/eureka/ # 监控页面
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>通过两个server相互注册，搭建了注册中心的双节点集群，由于defaultZone使用了域名，所以还需在本机的host文件中配置一下。 127.0.0.1 replica1 127.0.0.1 replica2</p><h5 id="分别运行两个注册中心" tabindex="-1"><a class="header-anchor" href="#分别运行两个注册中心" aria-hidden="true">#</a> 分别运行两个注册中心</h5><p>在idea的运行配置中，将Active profiles 分别修改为replica2和replica1，然后两次启动该组件。访问任一<a href="http://localhost/" target="_blank" rel="noopener noreferrer">http://localhost</a>:8003/或者http://localhost:8002/均可以看到</p><p>EUREKA-SERVER1 n/a (1) (1) UP (1) - NoteBook:eureka-server1:8002 EUREKA-SERVER2 n/a (1) (1) UP (1) - NoteBook:eureka-server2:8003</p><h5 id="client注册到两个服务中心" tabindex="-1"><a class="header-anchor" href="#client注册到两个服务中心" aria-hidden="true">#</a> Client注册到两个服务中心</h5><blockquote><p>defaultZone: <a href="http://replica1:8002/eureka/,http://replica2:8003/eureka/" target="_blank" rel="noopener noreferrer">http://replica1:8002/eureka/,http://replica2:8003/eureka/</a></p></blockquote><h4 id="其它常用配置" tabindex="-1"><a class="header-anchor" href="#其它常用配置" aria-hidden="true">#</a> 其它常用配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>eureka:
  client: #eureka客户端配置
    register-with-eureka: true #是否将自己注册到eureka服务端上去
    fetch-registry: true #是否获取eureka服务端上注册的服务列表
    service-url:
      defaultZone: http://localhost:8001/eureka/ # 指定注册中心地址
    enabled: true # 启用eureka客户端
    registry-fetch-interval-seconds: 30 #定义去eureka服务端获取服务列表的时间间隔
  instance: #eureka客户端实例配置
    lease-renewal-interval-in-seconds: 30 #定义服务多久去注册中心续约
    lease-expiration-duration-in-seconds: 90 #定义服务多久不去续约认为服务失效
    metadata-map:
      zone: guangdong #所在区域
    hostname: localhost #服务主机名称
    prefer-ip-address: false #是否优先使用ip来作为主机名
  server: #eureka服务端配置
    enable-self-preservation: false #关闭eureka服务端的保护机制
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="添加认证" tabindex="-1"><a class="header-anchor" href="#添加认证" aria-hidden="true">#</a> 添加认证</h4><p>需要spring security</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
spring:
  application:
    name: server-security-eureka
  security:
    user:
      # 配置spring security登录用户名和密码
      name: root
      password: 123456
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>WebConfig</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@EnableWebSecurity
public class WebConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().ignoringAntMatchers(&quot;/eureka/**&quot;);
        super.configure(http);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对Client而言需要配置中添加用户名密码信息</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> http://${username}:${password}@${hostname}:${port}/eureka/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="ribbon" tabindex="-1"><a class="header-anchor" href="#ribbon" aria-hidden="true">#</a> Ribbon</h3><p>在微服务架构中，很多服务都会部署多个，其他服务去调用该服务的时候，如何保证负载均衡是个不得不去考虑的问题。负载均衡可以增加系统的可用性和扩展性，当我们使用RestTemplate来调用其他服务时，Ribbon可以很方便的实现负载均衡功能。</p><h4 id="resttemplate" tabindex="-1"><a class="header-anchor" href="#resttemplate" aria-hidden="true">#</a> RestTemplate</h4><blockquote><p>RestTemplate是一个HTTP客户端，使用它我们可以方便的调用HTTP接口，支持GET、POST、PUT、DELETE等方法。</p></blockquote><p>在前面的文章中也有RestTemplate的介绍，注入该实例就可以通过HTTP协议完成远程Restful接口调用。</p><h4 id="user-service" tabindex="-1"><a class="header-anchor" href="#user-service" aria-hidden="true">#</a> User-Service</h4><p>已有接口如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Resource
    private IUserService userService;

    @GetMapping(&quot;/&quot;)
    public List&lt;User&gt; userList(){
        return userService.list();
    }

    @GetMapping(&quot;/{id}&quot;)
    public User userOne(@PathVariable Long id ){
        return userService.getById(id);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在没有引入ribbon的时候只需要注入RestTemplate便可以完成远程接口调用。 并且注册服务到Eureka-Server中</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
  application:
    name: user-service
mybatis-plus:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.cloud.demo.entity
mybatis:

# 指定运行端口
server:
  port: 8010
eureka:
  client:
    # 注册到Eureka的注册中心
    register-with-eureka: true
    # 获取注册实例列表
    fetch-registry: true
    service-url:
      # 配置注册中心地址
      defaultZone: http://root:123456@localhost:8005/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="user-ribbon-service" tabindex="-1"><a class="header-anchor" href="#user-ribbon-service" aria-hidden="true">#</a> User-Ribbon-Service</h4><h4 id="依赖和配置-3" tabindex="-1"><a class="header-anchor" href="#依赖和配置-3" aria-hidden="true">#</a> 依赖和配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
server:
  port: 8011
# 指定服务名称
spring:
  application:
    name: user-service-ribbon-client

eureka:
  client:
    # 注册到Eureka的注册中心
    register-with-eureka: true
    # 获取注册实例列表
    fetch-registry: true
    service-url:
      # 配置注册中心地址
      defaultZone: http://root:123456@localhost:8005/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>对RestTemplate配置：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Bean
    @LoadBalanced//负载均衡
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>测试</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Autowired
    private RestTemplate restTemplate;

    @GetMapping(&quot;/user/{id}&quot;)
    public User userList(@PathVariable Long id ){
       User user = restTemplate.getForObject(&quot;http://user-service/user/&quot;+id,User.class);
       return user;
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><a href="//xn--spring-vy7ih03iy0bb73q8xe.application.name" target="_blank" rel="noopener noreferrer">//路径应该为spring.application.name</a></p><h4 id="ribbon常用配置" tabindex="-1"><a class="header-anchor" href="#ribbon常用配置" aria-hidden="true">#</a> Ribbon常用配置</h4><h5 id="全局配置" tabindex="-1"><a class="header-anchor" href="#全局配置" aria-hidden="true">#</a> 全局配置</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ribbon:
  ConnectTimeout: 1000 #服务请求连接超时时间（毫秒）
  ReadTimeout: 3000 #服务请求处理超时时间（毫秒）
  OkToRetryOnAllOperations: true #对超时请求启用重试机制
  MaxAutoRetriesNextServer: 1 #切换重试实例的最大个数
  MaxAutoRetries: 1 # 切换实例后重试最大次数
  NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule #修改负载均衡算法
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="指定服务进行配置" tabindex="-1"><a class="header-anchor" href="#指定服务进行配置" aria-hidden="true">#</a> 指定服务进行配置</h5><blockquote><p>调用user-service的单独配置,至于这个怎么使用,会在后面.</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>user-service:
  ribbon:
    ConnectTimeout: 1000 #服务请求连接超时时间（毫秒）
    ReadTimeout: 3000 #服务请求处理超时时间（毫秒）
    OkToRetryOnAllOperations: true #对超时请求启用重试机制
    MaxAutoRetriesNextServer: 1 #切换重试实例的最大个数
    MaxAutoRetries: 1 # 切换实例后重试最大次数
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule #修改负载均衡算法
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="feign" tabindex="-1"><a class="header-anchor" href="#feign" aria-hidden="true">#</a> Feign</h3><p>Feign可以理解为社区版的Ribbon和Hystrix的集合，它简化了使用Ribbon所需要的RestTemplate的操作，更符合基于接口的开发模式，通过内部进一步的封装，可以通过注解的方式完成Rest接口调用和负载均衡的功能，同时它也提供了基于Hystrix的服务容错保护功能</p><h4 id="依赖和配置-4" tabindex="-1"><a class="header-anchor" href="#依赖和配置-4" aria-hidden="true">#</a> 依赖和配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>配置基本不变，核心还是注册EurekaCilent</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>server:
  port: 8014

spring:
  application:
    name: feign-client

eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: http://root:123456@localhost:8005/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="feignclient" tabindex="-1"><a class="header-anchor" href="#feignclient" aria-hidden="true">#</a> <a href="/FeignClient">@FeignClient </a></h4><p>需要声明一个接口FeignClientService</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@FeignClient(value = &quot;USER-SERVICE&quot;)
public interface UserFeignService {

    @GetMapping(&quot;/user/&quot;)//路径要为user-service中的全路径,否则feign.FeignException$NotFound
    public List&lt;User&gt; userList();

}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>除了value属性以外,也包含fallback = UserFallbackService.class等, 该属性等同于Hystrix的服务降级实现类.</p><h4 id="hystrix" tabindex="-1"><a class="header-anchor" href="#hystrix" aria-hidden="true">#</a> Hystrix</h4><ol><li>声明新类实现UserFeignService,实现接口中的方法,并且为该类添加[[@Component注解,修改FeignClientService接口的@FeignClient(value ](/Component注解,修改FeignClientService接口的@FeignClient(value ) ](/Component注解,修改FeignClientService接口的[@FeignClient(value ](/FeignClient(value ) ) = &quot;USER-SERVICE&quot;)为[[@FeignClient(value ](/FeignClient(value ) ](/FeignClient(value ) = &quot;USER-SERVICE&quot;,fallback = UserFallbackService.class) 即可完成服务熔断的调用,不过该方法无法处理异常</li><li>可以使用另一种方式: 实现类implements FallbackFactory,[[@FeignClient(value ](/FeignClient(value ) ](/FeignClient(value ) = &quot;USER-SERVICE&quot;,fallbackFactory = UserFallbackService.class)</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
public class TestServiceHystrix implements FallbackFactory&lt;TestService&gt; {
    @Override
    public TestService create(Throwable throwable) {
        return new TestService() {
            @Override
            public List&lt;User&gt; userList(){
	    //...
            };
        };
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="常见配置" tabindex="-1"><a class="header-anchor" href="#常见配置" aria-hidden="true">#</a> 常见配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#feign接口开启hystrix
feign.hystrix.enabled=true
#是否允许超时，默认、建议true
hystrix.command.default.execution.timeout.enabled=true
#超时时间，“hystrix.command.default.execution.timeout.enabled=true”时会生效
hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=5000
#超时是否中断，默认、建议为true
hystrix.command.default.execution.isolation.thread.interruptOnTimeout=true
#取消是否中断，默认、建议为false
hystrix.command.default.execution.isolation.thread.interruptOnCancel=false
#最大并发请求，默认10，建议根据实际情况设定此值
hystrix.command.default.execution.isolation.semaphore.maxConcurrentRequests=100
#最大并发降级请求处理上线，默认10，建议根据实际情况设此值，降级请求并发量高于此值时，抛出异常
hystrix.command.default.fallback.isolation.semaphore.maxConcurrentRequests=20
#此属性确定断路器是否用于跟踪健康状况，以及当断路器打开的时候是否用于短路请求(使请求快速失败进入降级逻辑)。
#默认、建议true
hystrix.command.default.circuitBreaker.enabled=true
#断路器请求量阈值，默认20，建议默认，部分接口如果不能容忍此值可单独配置
#例如，如果值是20，那么如果在滑动窗口中只接收到19个请求(比如一个10秒的窗口)，
# 即使所有19个请求都失败了，断路器也不会打开
hystrix.command.default.circuitBreaker.requestVolumeThreshold=10
#隔离策略，默认、建议THREAD
hystrix.command.default.execution.isolation.strategy=THREAD
#断路器等待窗口时间，此属性设置断路器打开后拒绝请求的时间量，
# 每隔一段时间( sleepWindowInMilliseconds ，单位是毫秒)允许再次尝试(也就是放行一个请求)确定是否应该关闭断路器。
#默认5000，建议保持默认
hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds=5000
#断路器错误百分比阈值，设置一个错误百分比，当请求错误率超过设定值，断路器就会打开。
#默认50，建议保持默认
hystrix.command.default.circuitBreaker.errorThresholdPercentage=50
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="hystrix-1" tabindex="-1"><a class="header-anchor" href="#hystrix-1" aria-hidden="true">#</a> Hystrix</h3><blockquote><p>在微服务架构中，服务与服务之间通过远程调用的方式进行通信，一旦某个被调用的服务发生了故障，其依赖服务也会发生故障，此时就会发生故障的蔓延，最终导致系统瘫痪。Hystrix实现了断路器模式，当某个服务发生故障时，通过断路器的监控，给调用方返回一个错误响应，而不是长时间的等待，这样就不会使得调用方由于长时间得不到响应而占用线程，从而防止故障的蔓延。Hystrix具备服务降级、服务熔断、线程隔离、请求缓存、请求合并及服务监控等强大功能。</p></blockquote><h4 id="执行顺序" tabindex="-1"><a class="header-anchor" href="#执行顺序" aria-hidden="true">#</a> 执行顺序</h4><h4 id="服务熔断" tabindex="-1"><a class="header-anchor" href="#服务熔断" aria-hidden="true">#</a> 服务熔断</h4><h5 id="依赖和配置-5" tabindex="-1"><a class="header-anchor" href="#依赖和配置-5" aria-hidden="true">#</a> 依赖和配置</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
        &lt;/dependency&gt;
server:
  port: 8012
spring:
  application:
    name: hystrix-service
eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: http://root:123456@localhost:8005/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>开启8005端口的Eureka Server和8010端口的服务提供者User-Service, 后者提供Restful接口</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @GetMapping(&quot;/{id}&quot;)
    public User userOne(@PathVariable Long id ){
        return userService.getById(id);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在hystrix-service启动类上添加注解: @EnableCircuitBreaker用来表示开启熔断器</p><h5 id="hystrixcommand" tabindex="-1"><a class="header-anchor" href="#hystrixcommand" aria-hidden="true">#</a> <a href="/HystrixCommand">@HystrixCommand </a></h5><p>在注册完RestTemplate的基础上,添加接口:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @GetMapping(&quot;/hystrix/user/{id}&quot;)
    @HystrixCommand(fallbackMethod = &quot;fallbackMethod1&quot;)//服务降级后调用下面的方法,其返回值应当一致
    public User getUser(@PathVariable Long id){
        return restTemplate.getForObject(&quot;http://localhost:8010/user/&quot;+id,User.class);
    }

    public User fallbackMethod1(@PathVariable Long id){
        System.out.println(&quot;服务调用失败&quot;);
        return new User();
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在没有getUser出现异常的情况下,Hystrix会根据指定服务降级处理方法完成调用,避免出现长时间等待等问题.</p><p>@HystrixCommand的属性</p><blockquote><p>fallbackMethod：指定服务降级处理方法； ignoreExceptions：忽略某些异常，不发生服务降级； commandKey：命令名称，用于区分不同的命令； groupKey：分组名称，Hystrix会根据不同的分组来统计命令的告警及仪表盘信息； threadPoolKey：线程池名称，用于划分线程池。</p></blockquote><h5 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h5><ol><li>停掉User-Service或者更改为错误的请求路径</li></ol><p>GET:<a href="http://localhost:8012/hystrix/user/%7B1%7D" target="_blank" rel="noopener noreferrer">http://localhost:8012/hystrix/user/{1}</a></p><blockquote><p>服务调用失败</p></blockquote><ol><li>添加属性 ignoreExceptions = NullPointerException.class</li></ol><p>在其接口中throw new NullPointerException(); 再测试后服务未降级</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> @GetMapping(&quot;/hystrix/exception/{id}&quot;)
    @HystrixCommand(fallbackMethod = &quot;fallbackMethod1&quot;,
            ignoreExceptions = NullPointerException.class,
            commandKey = &quot;getUserCommand&quot;,
            groupKey = &quot;getUserGroup&quot;,
            threadPoolKey = &quot;getUserThreadPool&quot;
    )
    public User exceptionTest1(@PathVariable Long id){
        if (id == 1) {
            throw new IndexOutOfBoundsException();
        } else if (id == 2) {
            throw new NullPointerException();
        }
        return new User();
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="请求缓存" tabindex="-1"><a class="header-anchor" href="#请求缓存" aria-hidden="true">#</a> 请求缓存</h5><p>Hystrix有两种方式来应对高并发场景，分别是请求缓存与请求合并 前者鉴于其缺点:</p><ul><li>是一个本地缓存。在集群情况下缓存是不能同步的。</li><li>不支持第三方缓存容器。Redis，memcache 不支持的。 所以往往使用SpringCache来替代.</li></ul><blockquote><p>@CacheResult：开启缓存，默认所有参数作为缓存的key，cacheKeyMethod可以通过返回String类型的方法指定key； @CacheKey：指定缓存的key，可以指定参数或指定参数中的属性值为缓存key，cacheKeyMethod还可以通过返回String类型的方法指定； @CacheRemove：移除缓存，需要指定commandKey。</p></blockquote><p>在缓存使用过程中，我们需要在每次使用缓存的请求前后对HystrixRequestContext进行初始化和关闭,否则会报异常:</p><blockquote><p>Request caching is not available. Maybe you need to initialize the HystrixRequestContext?</p></blockquote><p>所以需要声明一个Filter,在doFilter中开启和关闭HystrixRequestContext</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
@WebFilter(urlPatterns = &quot;/*&quot;,asyncSupported = true)
public class HystrixRequestContextFilter implements Filter {

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HystrixRequestContext context = HystrixRequestContext.initializeContext();
        try {
            filterChain.doFilter(servletRequest,servletResponse);
        }finally {
            context.close();
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="使用缓存" tabindex="-1"><a class="header-anchor" href="#使用缓存" aria-hidden="true">#</a> 使用缓存</h5><p>通过 [[@CacheResult(cacheKeyMethod ](/CacheResult(cacheKeyMethod ) ](/CacheResult(cacheKeyMethod ) = &quot;getCacheKey&quot;) (其属性cacheKeyMethod需要手动实现一个方法:getCacheKey作为缓存的key,比如下面可以用查询主键作为cacheKey)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @GetMapping(&quot;/hystrix/user/{id}&quot;)
    @CacheResult(cacheKeyMethod = &quot;getCacheKey&quot;)
    @HystrixCommand(fallbackMethod = &quot;fallbackMethod1&quot;)
    public User getUser(@PathVariable Long id){
        return restTemplate.getForObject(&quot;http://localhost:8010/user/&quot;+id,User.class);
    }

    public String getCacheKey(Long id) {//生成缓存key的方法
        return String.valueOf(id);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>连续两次使用相同的id请求该接口,可以发现user-service中只打印了一次请求日志.</p><h5 id="缓存删除" tabindex="-1"><a class="header-anchor" href="#缓存删除" aria-hidden="true">#</a> 缓存删除</h5><p>cacheKeyMethod获取cache的key,该方法的参数必须和当前接口的参数一致,且commandKey要和该缓存的@CacheResult的接口一致.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @PutMapping(&quot;/hystrix/putUser&quot;)
    @HystrixCommand
    @CacheRemove(cacheKeyMethod = &quot;getCacheKey1&quot;,commandKey = &quot;getUser&quot;)
    public User user(@RequestBody User user){
        restTemplate.put(&quot;http://localhost:8010/user/&quot;,user,user.getId());
        return user;
    }
    public String getCacheKey1(User user) {
        return String.valueOf(user.getId());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试该接口再去请求get接口,缓存消失.</p><p>问题:怎么能再次设置缓存?</p><h5 id="请求合并" tabindex="-1"><a class="header-anchor" href="#请求合并" aria-hidden="true">#</a> 请求合并</h5><blockquote><p>微服务系统中的服务间通信，需要通过远程调用来实现，随着调用次数越来越多，占用线程资源也会越来越多。Hystrix中提供了@HystrixCollapser用于合并请求，从而达到减少通信消耗及线程数量的效果。</p></blockquote><p>在一次HTTP请求的过程中，收集一段时间内的相同请求，放到一个批处理命令中执行。实现合并请求，同样需要先初始化请求上下文.</p><p>注解@HystrixCollapser的常用属性</p><ol><li>batchMethod：用于设置请求合并的方法；</li><li>collapserProperties：请求合并属性，用于控制实例属性，有很多；</li><li>timerDelayInMilliseconds：collapserProperties中的属性，用于控制每隔多少时间合并一次请求；</li></ol><h3 id="dashboard" tabindex="-1"><a class="header-anchor" href="#dashboard" aria-hidden="true">#</a> DashBoard</h3><p>用来监控hystrix实例的执行情况。</p><h4 id="dashboard模块" tabindex="-1"><a class="header-anchor" href="#dashboard模块" aria-hidden="true">#</a> DashBoard模块</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;
        &lt;/dependency&gt;
server:
  port: 8013
spring:
  application:
    name: hystrix-dashboard-service
eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: http://root:123456@localhost:8005/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>启动类添加注解: @EnableHystrixDashboard <a href="/EnableEurekaClient">@EnableEurekaClient </a> 启动后访问: <a href="http://localhost:8013/hystrix" target="_blank" rel="noopener noreferrer">http://localhost:8013/hystrix</a></p><h4 id="被监控方" tabindex="-1"><a class="header-anchor" href="#被监控方" aria-hidden="true">#</a> 被监控方</h4><p>首先需要开启Actuator</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
management:
  endpoints:
    web:
      exposure:
        #暴露hystrix监控端点
        include: &#39;hystrix.stream&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>被检控方需要注册一个servlet bean</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Bean
    public ServletRegistrationBean getServlet(){
        HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();
        ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);
        registrationBean.setLoadOnStartup(1);
        registrationBean.addUrlMappings(&quot;/actuator/hystrix.stream&quot;);
        registrationBean.setName(&quot;HystrixMetricsStreamServlet&quot;);
        return registrationBean;
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>分别启动Eureka-Server,Hystrix-Service,User-Service,Dashboard-Service 服务注册完成后先测试Hystrix-Service接口, 在dashboard页面 添加URL <a href="http://localhost:8012/actuator/hystrix.stream" target="_blank" rel="noopener noreferrer">http://localhost:8012/actuator/hystrix.stream</a> Delay:2000 Title:随意 点击MonitorStream即可监控Hystrix-Service该实例.</p><h4 id="dashboard图表" tabindex="-1"><a class="header-anchor" href="#dashboard图表" aria-hidden="true">#</a> DashBoard图表</h4><p><img src="https://img-blog.csdnimg.cn/20191227163602699.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70#alt=img#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=t3NQl&amp;originHeight=617&amp;originWidth=1265&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><hr><h3 id="gateway" tabindex="-1"><a class="header-anchor" href="#gateway" aria-hidden="true">#</a> Gateway</h3><h4 id="nginx和gateway" tabindex="-1"><a class="header-anchor" href="#nginx和gateway" aria-hidden="true">#</a> Nginx和Gateway</h4><blockquote><p>Nginx 负载均衡/反向代理 Gateway 路由网关/过滤器/统一鉴权</p></blockquote><h4 id="为什么要有服务网关" tabindex="-1"><a class="header-anchor" href="#为什么要有服务网关" aria-hidden="true">#</a> 为什么要有服务网关?</h4><blockquote><p>Nginx作为网站请求的第一道,稳定性能强,能够独立完成反向代理和跨域的问题,但是使用Gateway,能够提供更丰富的功能,比如动态路由/过滤器(统一鉴权/限流)等,而且Gateway作为Cloud体系中的一环,集成功能更加简单.</p></blockquote><h4 id="gateway和zuul" tabindex="-1"><a class="header-anchor" href="#gateway和zuul" aria-hidden="true">#</a> Gateway和Zuul</h4><blockquote><p>Gateway内置了限流过滤器 Gateway非阻塞式的API,并发更强 Zuul1编程模型简单，易于扩展； Gateway编程模型稍难，代码阅读难度要比Zuul高不少，扩展也稍复杂一些。</p></blockquote><h4 id="依赖" tabindex="-1"><a class="header-anchor" href="#依赖" aria-hidden="true">#</a> 依赖</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="yml" tabindex="-1"><a class="header-anchor" href="#yml" aria-hidden="true">#</a> yml</h4><p>Gateway的基本功能仅用配置即可完成</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring:
  application:
    name: gateway-web
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          &#39;[/**]&#39;: #匹配所有的请求
            allowedOrigins: &quot;*&quot; # 跨域处理
            allowedMethods: #
              - GET
              - POST
              - PUT
              - DELETE
      routes:
        - id: shop-web-goods-route
#          uri: http://localhost:18081 #指定要路由的服务 http://localhost:18081
          uri: lb://GOODS #lb负载均衡,后面是微服务名称
          predicates: #路由断言,配置路由规则
            #- Host=zong.com** #所有的zong.com的请求都被路由到上面的uri,这里测试可以先修改windows的host文件如下,127.0.0.1 zong.com,
            # 访问http://zong.com:8001/brand/all,可看到正确路由
          - Path=/api/goods/** #所有以/brand开头的请求,都路由到http://localhost:18081微服务
          filters:
          - StripPrefix=1 # 所有以/api/brand开头的请求,都路由到  http://localhost:18081微服务,且/api由gateway自动去除
#          - name: RequestRateLimiter
#            args:
#              key-resolver: &quot;#{@ipKeyResolver}&quot;
#              redis-rate-limiter.replenishRate: 1
#              redis-rate-limiter.burstCapacity: 1
        - id: shop-web-user-route
          uri: lb://USER #lb负载均衡,后面是微服务名称
          predicates: #路由断言,配置路由规则
          - Path=/api/user/**
          filters:
          - StripPrefix=1 # 所有以/api/brand开头的请求,都路由到  http://localhost:18081微服务,且/api由gateway自动去除
#          - name: RequestRateLimiter #请求限流数,名字不能乱写,使用默认的factory
#            args:
#              key-resolver: &quot;#{@ipKeyResolver}&quot;
#              redis-rate-limiter.replenishRate: 1
#              redis-rate-limiter.burstCapacity: 1
management:
  endpoint:
    gateway:
      enabled: true
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h4 id="配合jwt实现鉴权的demo" tabindex="-1"><a class="header-anchor" href="#配合jwt实现鉴权的demo" aria-hidden="true">#</a> 配合JWT实现鉴权的demo</h4><p>配置全局过滤器,对请求进行过滤,检测token是否有效.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>package com.zong.filter;

import com.zong.util.JwtUtil;
import org.apache.commons.lang.StringUtils;
import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.Ordered;
import org.springframework.http.HttpCookie;
import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.http.server.reactive.ServerHttpResponse;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

/**
 * 全局过滤器,用户校验
 */
@Component

public class AuthFilter implements GlobalFilter, Ordered {

    public static final String AUTH_TOKEN = &quot;Auth&quot;;
    @Override
    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        //获取用户令牌
        ServerHttpRequest request = exchange.getRequest();
        ServerHttpResponse response = exchange.getResponse();
        //
        String token = request.getHeaders().getFirst(AUTH_TOKEN);
        boolean hasToken = true;
        if(StringUtils.isEmpty(token)){
            token = request.getQueryParams().getFirst(AUTH_TOKEN);
            hasToken = false;
        }
        if(StringUtils.isEmpty(token)){
            HttpCookie cookie = request.getCookies().getFirst(AUTH_TOKEN);
            if (cookie != null) {
                token = cookie.getValue();
                hasToken = false;
            }
        }
        if(StringUtils.isEmpty(token)){
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }
        try {
            //有效
            JwtUtil.parseJWT(token);
        } catch (Exception e) {
            //无效拦截
            e.printStackTrace();
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }
        //放行
        //将令牌放入header
        if(!hasToken){
            request.mutate().header(AUTH_TOKEN,token);
        }
        return chain.filter(exchange);
    }

    @Override//排序,越小越先执行
    public int getOrder() {
        return 0;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h4 id="jwt定义" tabindex="-1"><a class="header-anchor" href="#jwt定义" aria-hidden="true">#</a> JWT定义</h4><p>头部:{type:&#39;JWT&#39;,alg:&#39;HS256&#39;},对头部进行base64加密,得到编码后的字符串</p><p>载荷:</p><ol><li>标准声明</li><li>私有声明(不参与令牌校验)</li><li>公共声明(不参与令牌校验)</li></ol><p>比如: {&#39;sub&#39;:&quot;123456&quot;,&quot;name&quot;:&quot;Paul&quot;,&quot;admin&quot;:true},将其base64加密,得到编码后的字符串</p><p>签名: 头部(加密后的)+载荷(加密后的)+密钥-&gt; HS256加密(头中指定的加密算法) -&gt;密文-&gt;签名</p><p>jwt:将三部分密文用.隔开拼在一起就是最终的jwt</p><p>校验:服务中存有密钥,对比头部+载荷+密钥 加密后的密文与调用方对比.</p><p>eg.</p><blockquote><ol><li>在gateway中设置全局拦截器,依次尝试从header/参数/cookies中获取token</li><li>利用密钥校验,失败或token为空,则返回401,跳到登录页面,成功则放行</li><li>登录接口生成token,放入cookie,并返回token参数给前台 JWT生成和校验</li></ol></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
            &lt;version&gt;0.9.0&lt;/version&gt;
        &lt;/dependency&gt;
    public static void main(String[] args) {

        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;self&quot;,&quot;aaa&quot;);

        JwtBuilder builder = Jwts.builder()
                .setId(&quot;Paul&quot;)
                .setSubject(&quot;AAA&quot;)
                .setIssuedAt(new Date())//颁发时间
                .addClaims(map)//载荷中自定义的部分
                .setExpiration(new Date(System.currentTimeMillis()+2000))//过期时间 20秒
                .signWith(SignatureAlgorithm.HS256,&quot;itcast&quot;);//加密算法和密钥
//        System.out.println(builder.compact());
        String token = builder.compact();

        String t =  token;
        Claims claims = Jwts.parser().setSigningKey(&quot;itcast&quot;)
                .parseClaimsJws(t)
                .getBody();
        System.out.println(claims.toString());


    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>在用户微服务login接口中生成jwt token</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> User user = userService.findById(name);
        if(BCrypt.checkpw(password,user.getPassword())){
            //创建用户令牌信息
            Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
            map.put(&quot;role&quot;,&quot;USER&quot;);
            map.put(&quot;success&quot;,&quot;SUCCESS&quot;);
            map.put(&quot;name&quot;,name);
            String token = JwtUtil.createJWT(UUID.randomUUID().toString(), JSON.toJSONString(map),null);
            //存入cookie
            Cookie cookie = new Cookie(&quot;Auth&quot;, token);
            cookie.setDomain(&quot;localhost&quot;);
            cookie.setPath(&quot;/&quot;);
            response.addCookie(cookie);
            //令牌作为参数给用户
            return token;
        }
        return &quot;error&quot;;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这里使用了BCrypt.java来进行密码明文密文的对比及加密,可到官网下载 <a href="http://www.mindrot.org/projects/jBCrypt/" target="_blank" rel="noopener noreferrer">BCrypt</a></p><h3 id="config" tabindex="-1"><a class="header-anchor" href="#config" aria-hidden="true">#</a> Config</h3><h4 id="服务端依赖" tabindex="-1"><a class="header-anchor" href="#服务端依赖" aria-hidden="true">#</a> 服务端依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="服务端配置" tabindex="-1"><a class="header-anchor" href="#服务端配置" aria-hidden="true">#</a> 服务端配置</h4><p>比如微服务A的配置文件 a.yml</p><p>需要将该文件重命名为 a-dev.yml,上传至git仓库(dev/tst/prod)</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> config
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//gitee.com/raynorzong/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>config.git <span class="token comment">#git仓库地址</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token comment">#账号</span>
          <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token comment">#密码</span>
          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span> /blob/master	<span class="token comment">#路径</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="服务端启动" tabindex="-1"><a class="header-anchor" href="#服务端启动" aria-hidden="true">#</a> 服务端启动</h4><p>启动类添加注解@EnableConfigServer即可.</p><h4 id="客户端依赖" tabindex="-1"><a class="header-anchor" href="#客户端依赖" aria-hidden="true">#</a> 客户端依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="客户端配置" tabindex="-1"><a class="header-anchor" href="#客户端配置" aria-hidden="true">#</a> 客户端配置</h4><p>删除客户端原配置文件,新增bootstrap.yml引导文件</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">6001</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> goods <span class="token comment">#前缀</span>
      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment">#后缀</span>
      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment">#分支</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>正常启动即可.</p><h4 id="多服务端配置" tabindex="-1"><a class="header-anchor" href="#多服务端配置" aria-hidden="true">#</a> 多服务端配置</h4><ul><li>服务端添加Eureka Client依赖并在启动类添加注解<a href="/EnableEurekaClient">@EnableEurekaClient </a></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6001</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> 127.0.0.1
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#是否将自己注册到服务中心</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#是否从Eureka中获取信息</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>eureka.instance.hostname<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>修改配置文件,删除uri,添加discovery,同样的,客户端的引导文件也需要添加EurekaClient配置</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-adress</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>7001/eureka
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> goods <span class="token comment">#前缀</span>
      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment">#后缀</span>
      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment">#分支</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">service-id</span><span class="token punctuation">:</span> config
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="bus" tabindex="-1"><a class="header-anchor" href="#bus" aria-hidden="true">#</a> Bus</h3><h4 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h4><p>SpringCloud Config怎么实现配置更新,首先需要更改git上的配置文件,然后客户端.</p><p>而SpringCloud Bus就是为了能够实时更新配置文件,来解决上面的缺陷,该服务依赖RabbitMQ,且该服务一般与Config放在一个服务中.</p><h4 id="服务端依赖-1" tabindex="-1"><a class="header-anchor" href="#服务端依赖-1" aria-hidden="true">#</a> 服务端依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-bus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-stream-binder-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="服务端配置-1" tabindex="-1"><a class="header-anchor" href="#服务端配置-1" aria-hidden="true">#</a> 服务端配置</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6001</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-adress</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>7001/eureka

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> config
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//gitee.com/raynorzong/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>config.git
          <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token comment">#</span>
          <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token comment">#</span>
          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span> /blob/master
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span> <span class="token comment">#RabbitMQ的配置</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">username</span><span class="token punctuation">:</span> username
    <span class="token key atrule">password</span><span class="token punctuation">:</span> password
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">addresses</span><span class="token punctuation">:</span> 39.97.243.43

<span class="token key atrule">management</span><span class="token punctuation">:</span> <span class="token comment">#暴露触发消息总线的地址</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> bus<span class="token punctuation">-</span>refresh
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="客户端依赖-1" tabindex="-1"><a class="header-anchor" href="#客户端依赖-1" aria-hidden="true">#</a> 客户端依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-bus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-stream-binder-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="客户端配置-1" tabindex="-1"><a class="header-anchor" href="#客户端配置-1" aria-hidden="true">#</a> 客户端配置</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
<span class="token comment">#      uri: http://127.0.0.1:6001</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> goods <span class="token comment">#前缀</span>
      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment">#后缀</span>
      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment">#分支</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">service-id</span><span class="token punctuation">:</span> config
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span> <span class="token comment">#RabbitMQ的配置</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
    <span class="token key atrule">username</span><span class="token punctuation">:</span> username
    <span class="token key atrule">password</span><span class="token punctuation">:</span> password
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">addresses</span><span class="token punctuation">:</span> 39.97.243.43
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="测试-1" tabindex="-1"><a class="header-anchor" href="#测试-1" aria-hidden="true">#</a> 测试</h4><p>启动EurekaServer和Config以及微服务A,此时若git中A的配置文件发生改变需要使其服务重新加载配置需要利用消息队列RabbitMQ告诉A服务:</p><p>浏览器发送POST请求(针对Config服务的请求)如下:</p><blockquote><p><a href="http://127.0.0.1:6001/actuator/bus-refresh" target="_blank" rel="noopener noreferrer">http://127.0.0.1:6001/actuator/bus-refresh</a></p></blockquote><p>返回结果204即可完成配置的动态加载.</p><h3 id="sleuth" tabindex="-1"><a class="header-anchor" href="#sleuth" aria-hidden="true">#</a> Sleuth</h3><p>微服务请求调用链,实现日志追踪,易于整合logback/slf4j等</p><h2 id="springcloud-alibaba-1" tabindex="-1"><a class="header-anchor" href="#springcloud-alibaba-1" aria-hidden="true">#</a> SpringCloud Alibaba</h2><h3 id="nacos" tabindex="-1"><a class="header-anchor" href="#nacos" aria-hidden="true">#</a> Nacos</h3><h4 id="简介-1" tabindex="-1"><a class="header-anchor" href="#简介-1" aria-hidden="true">#</a> 简介</h4><p>Nacos可作为注册中心(Eureka/Zookeeper),配置中心(Config)</p><p>官网简介:</p><ul><li>服务发现和服务健康监测</li><li>动态配置服务，带管理界面，支持丰富的配置维度。</li><li>动态 DNS 服务</li><li>服务及其元数据管理</li></ul><h4 id="服务端下载部署" tabindex="-1"><a class="header-anchor" href="#服务端下载部署" aria-hidden="true">#</a> 服务端下载部署</h4><p>可以从<code>https://github.com/alibaba/nacos/releases</code>下载<code>nacos-server-$version.zip</code>包。</p><p>Windows下载解压后（.zip），直接点击<code>bin/startup.cmd -m standalone</code>就可以了。</p><p>Nacos默认是<code>集群模式cluster</code>，可以<code>startup.cmd</code>属性<code>MODE</code>为<code>单机模式standalone</code></p><h4 id="服务端访问" tabindex="-1"><a class="header-anchor" href="#服务端访问" aria-hidden="true">#</a> 服务端访问</h4><p><a href="http://localhost:8848/nacos" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos (opens new window)</a>,默认用户密码nacos/nacos</p><h4 id="注册中心功能" tabindex="-1"><a class="header-anchor" href="#注册中心功能" aria-hidden="true">#</a> 注册中心功能</h4><h5 id="客户端依赖-2" tabindex="-1"><a class="header-anchor" href="#客户端依赖-2" aria-hidden="true">#</a> 客户端依赖</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-boot.version</span><span class="token punctuation">&gt;</span></span>2.3.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-boot.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>2.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    

    <span class="token comment">&lt;!--引入注册中心阿里巴巴--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-boot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h5 id="客户端配置-2" tabindex="-1"><a class="header-anchor" href="#客户端配置-2" aria-hidden="true">#</a> 客户端配置</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># Spring</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token comment"># 应用名称</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token comment"># 服务注册地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="客户端启动" tabindex="-1"><a class="header-anchor" href="#客户端启动" aria-hidden="true">#</a> 客户端启动</h5><ul><li>启动类添加注解@EnableDiscoveryClient</li></ul><h3 id="配置中心" tabindex="-1"><a class="header-anchor" href="#配置中心" aria-hidden="true">#</a> 配置中心</h3><h4 id="客户端依赖-3" tabindex="-1"><a class="header-anchor" href="#客户端依赖-3" aria-hidden="true">#</a> 客户端依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--引入配置中心阿里巴巴--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="客户端配置-3" tabindex="-1"><a class="header-anchor" href="#客户端配置-3" aria-hidden="true">#</a> 客户端配置</h4><ol><li>删除旧的application.yml,新增bootstrap.yml</li><li>添加配置</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> provider
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token comment"># 服务注册地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在上面的配置中，配置了nacos config server的地址，配置的扩展名是ymal（目前仅支持ymal和properties）。注意是没有配置server.port的，sever.port的属性在nacos中配置。上面的配置是和Nacos中的<code>dataId</code> 的格式是对应的，nacos的完整格式如下：</p><blockquote><p><img src="https://g.yuque.com/gr/latex?-#card=math&amp;code=-#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=e7J4B&amp;originHeight=20&amp;originWidth=16&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="">.$</p></blockquote><ol><li>启动nacos，登陆localhost:8848/nacos，创建一个data id:provider-dev.yaml,发布后启动客户端.</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol><li>动态刷新(与Cloud Bus不同)</li></ol><p>需要@RefreshScope注解,修改nacos中的provider-dev.yaml后重新访问下接口,即可实现</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RefreshScope</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/config&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${useLocalCache:false}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> useLocalCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> useLocalCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="服务端配置持久化" tabindex="-1"><a class="header-anchor" href="#服务端配置持久化" aria-hidden="true">#</a> 服务端配置持久化</h4><p>在单机模式时<code>nacos</code>使用嵌入式数据库实现数据的存储，不方便观察数据存储的基本情况。我们可以配置<code>mysql</code>数据库，可视化的查看数据的存储。</p><ul><li>在nacos的 &#39;\nacos\conf&#39; 目录下,存在nacos-mysql.sql文件,导入数据库后</li><li>进入 config文件夹下的 application.properties文件，增加</li></ul><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># db mysql</span>
<span class="token key attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span>
<span class="token key attr-name">db.num</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/nacos-config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span>
<span class="token key attr-name">db.user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">db.password</span><span class="token punctuation">=</span><span class="token value attr-value">123123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>单机启动nacos添加配置后即可看到nacos的配置.</li></ul><h3 id="客户端整合ribbon-openfeign" tabindex="-1"><a class="header-anchor" href="#客户端整合ribbon-openfeign" aria-hidden="true">#</a> 客户端整合Ribbon/OpenFeign</h3><h4 id="ribbon-1" tabindex="-1"><a class="header-anchor" href="#ribbon-1" aria-hidden="true">#</a> Ribbon</h4><p>依赖和配置</p><p>不需要额外的依赖,只需要注册一个bean</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 新增restTemplate对象注入方法，注意，此处LoadBalanced注解一定要加上，否则无法远程调用</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@LoadBalanced</span><span class="token comment">//org.springframework.cloud.client.loadbalancer.LoadBalanced;</span>
<span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="controller" tabindex="-1"><a class="header-anchor" href="#controller" aria-hidden="true">#</a> Controller</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;http://provider/test&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="openfeign" tabindex="-1"><a class="header-anchor" href="#openfeign" aria-hidden="true">#</a> OpenFeign</h4><h5 id="依赖-1" tabindex="-1"><a class="header-anchor" href="#依赖-1" aria-hidden="true">#</a> 依赖</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>10.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h5><p>开启Feign中Hystrix,开启httpclient(默认用java.net.HttpURLConnection)</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启httpclient</span>
  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启hystrix</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>启动类添加Feign客户端注解:<a href="/EnableFeignClients">@EnableFeignClients </a></p><h5 id="测试-2" tabindex="-1"><a class="header-anchor" href="#测试-2" aria-hidden="true">#</a> 测试</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zong<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">TestServiceImpl</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;provider&quot;</span><span class="token punctuation">,</span>fallbackFactory  <span class="token operator">=</span> <span class="token class-name">TestServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TestService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TestService</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">TestService</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TestService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&quot;Fall_Back&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TestService</span> testService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hiFeign</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> testService<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h5 id="请求拦截器" tabindex="-1"><a class="header-anchor" href="#请求拦截器" aria-hidden="true">#</a> 请求拦截器</h5><p>在微服务应用中，通过<code>feign</code>的方式实现<code>http</code>的调用，可以通过实现<code>feign.RequestInterceptor</code>接口在<code>feign</code>执行后进行拦截，对请求头等信息进行修改。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zong<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zong<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">CacheConstants</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zong<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">ServletUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>zong<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span></span><span class="token class-name">RequestInterceptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span></span><span class="token class-name">RequestTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">RequestContextHolder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">ServletRequestAttributes</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignConfig</span> <span class="token keyword">implements</span> <span class="token class-name">RequestInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">RequestTemplate</span> requestTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletRequestAttributes</span> attributes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpServletRequest</span> httpServletRequest <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>httpServletRequest <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span>httpServletRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 传递用户信息请求头，防止丢失</span>
            <span class="token class-name">String</span> userId <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">CacheConstants</span><span class="token punctuation">.</span><span class="token constant">DETAILS_USER_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                requestTemplate<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token class-name">CacheConstants</span><span class="token punctuation">.</span><span class="token constant">DETAILS_USER_ID</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.08em;" aria-hidden="true" width="17.28" height="17.28" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/zongkx/zongkx.github.io/edit/main/notes/java/SpringCloud.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/java/SpringBoot%E8%BF%9B%E9%98%B6.html" class="" aria-label="SpringBoot进阶.md"><!--[--><!--]--> SpringBoot进阶.md <!--[--><!--]--></a></span><span class="next"><a href="/java/Spring%E5%9F%BA%E7%A1%80.html" class="" aria-label="Spring基础.md"><!--[--><!--]--> Spring基础.md <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----></div><!--]--></div>
    <script type="module" src="/assets/app.6a98a4dc.js" defer></script>
  </body>
</html>

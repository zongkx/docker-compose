<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.svg"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>raynor</title><meta name="description" content="raynor's messy notebook.">
    <link rel="modulepreload" href="/assets/app.6a98a4dc.js"><link rel="modulepreload" href="/assets/Spring基础.html.212dd51b.js"><link rel="modulepreload" href="/assets/Spring基础.html.be4b934e.js">
    <link rel="stylesheet" href="/assets/style.c88710ac.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/favicon.svg" alt="raynor"><span class="site-name can-hide">raynor</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/java/" class="router-link-active" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/database/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/js/" class="" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ops/" class="" aria-label="OPS"><!--[--><!--]--> OPS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/practice/" class="" aria-label="Practice"><!--[--><!--]--> Practice <!--[--><!--]--></a></div><div class="navbar-item"><a href="/snippets/" class="" aria-label="Snippets"><!--[--><!--]--> Snippets <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><div class="navbar-buttons"><a rel="noopener noreferrer" target="_blank" href="https://github.com/zongkx/zongkx.github.io"><svg class="ov-icon" style="font-size:1.26em;" aria-hidden="true" width="20.16" height="20.16" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32 0 01-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 01.676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 01.63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731 0 0112 3.315c.912 0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 01.616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293 0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492 0 01-.012 2.716 1 1 0 01-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998 0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66 0-.955-.312-1.744-.913-2.404a1 1 0 01-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 01-.833.135A9.626 9.626 0 0012 5.315c-.89 0-1.772.119-2.592.35a1 1 0 01-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 01-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 01-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/></svg></a><a rel="noopener noreferrer" target="_blank" href="https://zongkx.icu"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.12 17.023l-4.199-2.29a4 4 0 110-5.465l4.2-2.29a4 4 0 11.959 1.755l-4.2 2.29a4.008 4.008 0 010 1.954l4.199 2.29a4 4 0 11-.959 1.755zM6 14a2 2 0 100-4 2 2 0 000 4zm11-6a2 2 0 100-4 2 2 0 000 4zm0 12a2 2 0 100-4 2 2 0 000 4z"/></svg></a><button class="toggle-dark-button" title="toggle dark mode"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor" focusable="false"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 110-12 6 6 0 010 12zm0-2a4 4 0 100-8 4 4 0 000 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor" focusable="false"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0012 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0010 7zm-6 5a8 8 0 0015.062 3.762A9 9 0 018.238 4.938 7.999 7.999 0 004 12z"/></svg></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/java/" class="router-link-active" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/database/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/js/" class="" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ops/" class="" aria-label="OPS"><!--[--><!--]--> OPS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/practice/" class="" aria-label="Practice"><!--[--><!--]--> Practice <!--[--><!--]--></a></div><div class="navbar-item"><a href="/snippets/" class="" aria-label="Snippets"><!--[--><!--]--> Snippets <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/java/CSV_Writer.html" class="sidebar-item" aria-label="CSV_Writer.md"><!--[--><!--]--> CSV_Writer.md <!--[--><!--]--></a><!----></li><li><a href="/java/Graylog.html" class="sidebar-item" aria-label="Graylog.md"><!--[--><!--]--> Graylog.md <!--[--><!--]--></a><!----></li><li><a href="/java/Guava.html" class="sidebar-item" aria-label="Guava.md"><!--[--><!--]--> Guava.md <!--[--><!--]--></a><!----></li><li><a href="/java/IDEAlive_template.html" class="sidebar-item" aria-label="IDEAlive_template.md"><!--[--><!--]--> IDEAlive_template.md <!--[--><!--]--></a><!----></li><li><a href="/java/Jackson.html" class="sidebar-item" aria-label="Jackson.md"><!--[--><!--]--> Jackson.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Lamdba.html" class="sidebar-item" aria-label="Java-Lamdba.md"><!--[--><!--]--> Java-Lamdba.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Stream_%E9%9B%86%E5%90%88.html" class="sidebar-item" aria-label="Java-Stream_集合.md"><!--[--><!--]--> Java-Stream_集合.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Thread.html" class="sidebar-item" aria-label="Java-Thread.md"><!--[--><!--]--> Java-Thread.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E5%8F%8D%E5%B0%84_%E6%B3%9B%E5%9E%8B.html" class="sidebar-item" aria-label="Java-反射_泛型.md"><!--[--><!--]--> Java-反射_泛型.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B8%B8%E9%87%8F.html" class="sidebar-item" aria-label="Java-常见的常量.md"><!--[--><!--]--> Java-常见的常量.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E9%9D%A2%E8%AF%95.html" class="sidebar-item" aria-label="Java-面试.md"><!--[--><!--]--> Java-面试.md <!--[--><!--]--></a><!----></li><li><a href="/java/JavaUtils.html" class="sidebar-item" aria-label="JavaUtils.md"><!--[--><!--]--> JavaUtils.md <!--[--><!--]--></a><!----></li><li><a href="/java/JdbcTemplate.html" class="sidebar-item" aria-label="JdbcTemplate.md"><!--[--><!--]--> JdbcTemplate.md <!--[--><!--]--></a><!----></li><li><a href="/java/Json.html" class="sidebar-item" aria-label="Json.md"><!--[--><!--]--> Json.md <!--[--><!--]--></a><!----></li><li><a href="/java/Maven.html" class="sidebar-item" aria-label="Maven.md"><!--[--><!--]--> Maven.md <!--[--><!--]--></a><!----></li><li><a href="/java/Minio.html" class="sidebar-item" aria-label="Minio.md"><!--[--><!--]--> Minio.md <!--[--><!--]--></a><!----></li><li><a href="/java/Nacos.html" class="sidebar-item" aria-label="Nacos.md"><!--[--><!--]--> Nacos.md <!--[--><!--]--></a><!----></li><li><a href="/java/OkHttp3.html" class="sidebar-item" aria-label="OkHttp3.md"><!--[--><!--]--> OkHttp3.md <!--[--><!--]--></a><!----></li><li><a href="/java/OpenFeign.html" class="sidebar-item" aria-label="OpenFeign.md"><!--[--><!--]--> OpenFeign.md <!--[--><!--]--></a><!----></li><li><a href="/java/" class="router-link-active sidebar-item" aria-label="Dev"><!--[--><!--]--> Dev <!--[--><!--]--></a><!----></li><li><a href="/java/RestTemplate.html" class="sidebar-item" aria-label="RestTemplate.md"><!--[--><!--]--> RestTemplate.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot-%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86DataSourceBean.html" class="sidebar-item" aria-label="SpringBoot-动态管理DataSourceBean.md"><!--[--><!--]--> SpringBoot-动态管理DataSourceBean.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="SpringBoot基础.md"><!--[--><!--]--> SpringBoot基础.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot%E8%BF%9B%E9%98%B6.html" class="sidebar-item" aria-label="SpringBoot进阶.md"><!--[--><!--]--> SpringBoot进阶.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringCloud.html" class="sidebar-item" aria-label="SpringCloud.md"><!--[--><!--]--> SpringCloud.md <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Spring基础.md"><!--[--><!--]--> Spring基础.md <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#spring-mvc" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring MVC"><!--[--><!--]--> Spring MVC <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#_1-参数绑定" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 参数绑定"><!--[--><!--]--> 1. 参数绑定 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#_2-restful-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Restful API"><!--[--><!--]--> 2. Restful API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#_3-json解析器" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. JSON解析器"><!--[--><!--]--> 3. JSON解析器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#_4-表单验证" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.  表单验证"><!--[--><!--]--> 4.  表单验证 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#_5-请求rest接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.  请求Rest接口"><!--[--><!--]--> 5.  请求Rest接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#_6-上传下载" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 上传下载"><!--[--><!--]--> 6. 上传下载 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#spring-bean" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring Bean"><!--[--><!--]--> Spring Bean <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#bean的生命周期" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean的生命周期"><!--[--><!--]--> Bean的生命周期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#bean级生命周期接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean级生命周期接口"><!--[--><!--]--> Bean级生命周期接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#容器级bean生命周期接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="容器级Bean生命周期接口"><!--[--><!--]--> 容器级Bean生命周期接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#beanfactory和applicationcontext" class="router-link-active router-link-exact-active sidebar-item" aria-label="BeanFactory和ApplicationContext"><!--[--><!--]--> BeanFactory和ApplicationContext <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#bean的作用域" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean的作用域"><!--[--><!--]--> Bean的作用域 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#bean循环依赖问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean循环依赖问题"><!--[--><!--]--> Bean循环依赖问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#bean的创建和使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bean的创建和使用"><!--[--><!--]--> Bean的创建和使用 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#" class="router-link-active router-link-exact-active sidebar-item" aria-label><!--[--><!--]-->  <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#尽量使用构造注入" class="router-link-active router-link-exact-active sidebar-item" aria-label="尽量使用构造注入"><!--[--><!--]--> 尽量使用构造注入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#静态实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="静态实例"><!--[--><!--]--> 静态实例 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#spring-aop" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP"><!--[--><!--]--> Spring AOP <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#异常处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="异常处理"><!--[--><!--]--> 异常处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#简单authfilter" class="router-link-active router-link-exact-active sidebar-item" aria-label="简单AuthFilter"><!--[--><!--]--> 简单AuthFilter <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#aop-日志-非异步" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOP 日志(非异步)"><!--[--><!--]--> AOP 日志(非异步) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#aop-日志-异步" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOP 日志 (异步)"><!--[--><!--]--> AOP 日志 (异步) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#spring-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring Transaction"><!--[--><!--]--> Spring Transaction <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#传播性-propagation" class="router-link-active router-link-exact-active sidebar-item" aria-label="传播性（propagation）"><!--[--><!--]--> 传播性（propagation） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#事务不生效的原因" class="router-link-active router-link-exact-active sidebar-item" aria-label="事务不生效的原因"><!--[--><!--]--> 事务不生效的原因 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#回滚不生效的原因" class="router-link-active router-link-exact-active sidebar-item" aria-label="回滚不生效的原因"><!--[--><!--]--> 回滚不生效的原因 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#spring-async" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring Async"><!--[--><!--]--> Spring Async <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#引入" class="router-link-active router-link-exact-active sidebar-item" aria-label="引入"><!--[--><!--]--> 引入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#开启" class="router-link-active router-link-exact-active sidebar-item" aria-label="开启"><!--[--><!--]--> 开启 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#带返回值的future" class="router-link-active router-link-exact-active sidebar-item" aria-label="带返回值的Future"><!--[--><!--]--> 带返回值的Future <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/Spring%E5%9F%BA%E7%A1%80.html#future接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="Future接口"><!--[--><!--]--> Future接口 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/java/WPS.html" class="sidebar-item" aria-label="WPS.md"><!--[--><!--]--> WPS.md <!--[--><!--]--></a><!----></li><li><a href="/java/%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6.html" class="sidebar-item" aria-label="安全框架.md"><!--[--><!--]--> 安全框架.md <!--[--><!--]--></a><!----></li><li><a href="/java/%E6%B5%8B%E8%AF%95.html" class="sidebar-item" aria-label="测试.md"><!--[--><!--]--> 测试.md <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="spring-mvc" tabindex="-1"><a class="header-anchor" href="#spring-mvc" aria-hidden="true">#</a> Spring MVC</h2><h3 id="_1-参数绑定" tabindex="-1"><a class="header-anchor" href="#_1-参数绑定" aria-hidden="true">#</a> 1. 参数绑定</h3><p>@RequestParam: 接收的参数是来自requestHeader中，即请求头。通常用于GET请求,可以获取URL上的数据.用来处理 Content-Type 为 application/x-www-form-urlencoded 编码的内容，Content-Type默认为该属性</p><ul><li>required 表示是否必须，默认为 true，必须。</li><li>defaultValue 可设置请求参数的默认值。</li><li>value 为接收url的参数名（相当于key值）。</li></ul><p>@RequestBody: 接收的参数是来自requestBody中，即请求体.一般用于处理非 Content-Type: application/x-www-form-urlencoded编码格式的数据，比如：application/json、application/xml等类型的数据。 比如</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/map&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@ResponseBody</span> <span class="token class-name">User</span> <span class="token function">getMap</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//对应到Talent API Tester 请求应该是[在postman中将body选为raw-&gt;JSON(application/json)]</span>
<span class="token comment">//POST:http://localhost/map </span>
<span class="token comment">//HEADERS:Content-Type/application/json</span>
<span class="token comment">//BODY:{&quot;name&quot;:&quot;啊&quot;}		 </span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/map1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@ResponseBody</span> <span class="token class-name">User</span> <span class="token function">getMap1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//对应的请求应该是(在Postman中将body选为x-www-form-urlencoded )</span>
<span class="token comment">//POST:http://localhost/map1</span>
<span class="token comment">//HEADERS:Content-Type/application/x-www-form-urlencoded</span>
<span class="token comment">//BODY:{&quot;name&quot;:&quot;啊&quot;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_1-包装数据类型" tabindex="-1"><a class="header-anchor" href="#_1-包装数据类型" aria-hidden="true">#</a> 1.包装数据类型</h4><p>包装数据类型绑定的时候(一般不使用基础数据类型),前台请求key值可以不传,数据也可以为空,成功绑定需要key值和参数名一致,另外可以@RequestParam来建立对应关系.</p><h4 id="_2-数组元素" tabindex="-1"><a class="header-anchor" href="#_2-数组元素" aria-hidden="true">#</a> 2.数组元素</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/array&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span>  name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// http://localhost/user?name=a&amp;name=b</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-多层级对象" tabindex="-1"><a class="header-anchor" href="#_3-多层级对象" aria-hidden="true">#</a> 3.多层级对象</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// http://localhost/user?name=a&amp;role.name=admin</span>
<span class="token comment">// User对象中包含role对象</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="_3-1-多对象含相同属性" tabindex="-1"><a class="header-anchor" href="#_3-1-多对象含相同属性" aria-hidden="true">#</a> 3.1 多对象含相同属性</h5><p>user:name\type... role:name\type...</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@InitBinder</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initUser</span><span class="token punctuation">(</span><span class="token class-name">WebDataBinder</span> binder<span class="token punctuation">)</span><span class="token punctuation">{</span>
    binder<span class="token punctuation">.</span><span class="token function">setFieldDefaultPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;user.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@InitBinder</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">initAdmin</span><span class="token punctuation">(</span><span class="token class-name">WebDataBinder</span> binder<span class="token punctuation">)</span><span class="token punctuation">{</span>
    binder<span class="token punctuation">.</span><span class="token function">setFieldMarkerPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;role.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">//同时在请求中要在各个属性前加上 对象前缀.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_3-2-list类型" tabindex="-1"><a class="header-anchor" href="#_3-2-list类型" aria-hidden="true">#</a> 3.2 List类型</h5><p>需要新建一个类用来保存list对象,</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token class-name">UserList</span><span class="token punctuation">{</span> <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">;</span><span class="token comment">//users与前台请求一致}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">UserList</span> userList<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> userList<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>list<span class="token operator">?</span>users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token operator">=</span>xxx<span class="token operator">&amp;</span>users<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token operator">=</span>yyy
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="_3-3-map类型" tabindex="-1"><a class="header-anchor" href="#_3-3-map类型" aria-hidden="true">#</a> 3.3 Map类型</h5><p>和List类似,需要额外的类用来维护该对象</p><h3 id="_2-restful-api" tabindex="-1"><a class="header-anchor" href="#_2-restful-api" aria-hidden="true">#</a> 2. Restful API</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token comment">//get请求:用户列表</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token comment">// post请求:新增用户</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">postUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span><span class="token comment">// get请求:根据id获取用户</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span><span class="token comment">// put请求:根据id,user更新用户</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">putUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>测试:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.GET 		http://localhost/users/
2.Post    	http://localhost/users/
  HEADERS 	Content-Type:application/json
  BODY    	{&quot;name&quot;:&quot;aaa&quot;}
3.GET 		http://localhost/users/1
4.PUT		http://localhost/users/1
  HEADERS 	Content-Type:application/json
  BODY    	{&quot;name&quot;:&quot;aaa&quot;}
5.DELETE	http://localhost/users/1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-json解析器" tabindex="-1"><a class="header-anchor" href="#_3-json解析器" aria-hidden="true">#</a> 3. JSON解析器</h3><p>SpringBoot默认使用Jackson,替换为:Fastjson,先引入com.alibaba.fastjson</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
         先把Jackson的消息转换器删除.
         备注:
         (1)源码分析可知，返回json的过程为: Controller调用结束后返回一个数据对象，for循环遍历conventers，找到支持application/json的HttpMessageConverter，然后将返回的数据序列化成json。
          具体参考org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor的writeWithMessageConverters方法
         (2)由于是list结构，我们添加的fastjson在最后。因此必须要将jackson的转换器删除，不然会先匹配上jackson，导致没使用fastjson
        */</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> converters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>converters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">MappingJackson2HttpMessageConverter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                converters<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">FastJsonHttpMessageConverter</span> fastJsonHttpMessageConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FastJsonHttpMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//自定义fastjson配置</span>
        <span class="token class-name">FastJsonConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FastJsonConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setSerializerFeatures</span><span class="token punctuation">(</span>
                <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteMapNullValue</span><span class="token punctuation">,</span>        <span class="token comment">// 是否输出值为null的字段,默认为false,我们将它打开</span>
                <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteNullListAsEmpty</span><span class="token punctuation">,</span>     <span class="token comment">// 将Collection类型字段的字段空值输出为[]</span>
                <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteNullStringAsEmpty</span><span class="token punctuation">,</span>   <span class="token comment">// 将字符串类型字段的空值输出为空字符串</span>
                <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteNullNumberAsZero</span><span class="token punctuation">,</span>    <span class="token comment">// 将数值类型字段的空值输出为0</span>
                <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteDateUseDateFormat</span><span class="token punctuation">,</span>
                <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>DisableCircularReferenceDetect</span>    <span class="token comment">// 禁用循环引用</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastJsonHttpMessageConverter<span class="token punctuation">.</span><span class="token function">setFastJsonConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加支持的MediaTypes;不添加时默认为*/*,也就是默认支持全部</span>
        <span class="token comment">// 但是MappingJackson2HttpMessageConverter里面支持的MediaTypes为application/json</span>
        <span class="token comment">// 参考它的做法, fastjson也只添加application/json的MediaType</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> fastMediaTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastMediaTypes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_UTF8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fastJsonHttpMessageConverter<span class="token punctuation">.</span><span class="token function">setSupportedMediaTypes</span><span class="token punctuation">(</span>fastMediaTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        converters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fastJsonHttpMessageConverter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>测试如下</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>format <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">LocalDateTime</span> time<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token comment">//get请求:用户列表</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//  [{&quot;name&quot;:&quot;1&quot;,&quot;time&quot;:&quot;2020-02-14&quot;}]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-表单验证" tabindex="-1"><a class="header-anchor" href="#_4-表单验证" aria-hidden="true">#</a> 4.  表单验证</h3><p>表单验证如果仅仅在前端处理,仍然有比如直接用postman请求来跳过其验证的方法,所以后台往往也需要添加数据验证,表单验证可以使用JSR 303的Bean Validation,在实体类上添加相应的注解,就可以完成后台表单验证</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;名字不能为空&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">,</span>max <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">&quot;长度在2到10之间&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>format <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其中@<a href="mailto:NotNull/@Size%E5%9D%87%E6%98%AFjavax.validation.constraints%E5%8C%85%E4%B8%8B%E7%9A%84%E5%86%85%E5%AE%B9">NotNull/@Size均是javax.validation.constraints包下的内容</a>,更多使用方法可以参考 <a href="https://beanvalidation.org/1.0/spec/#d0e5601" target="_blank" rel="noopener noreferrer">JSR 303</a> 控制器中相关地方只需要添加BindingResult和@Valid即可.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> bindingResult<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bindingResult<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> bindingResult<span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>模拟请求和响应如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /valid/test HTTP/1.1
Content-Length: 12
Content-Type: application/json
Host: localhost:8080
{&quot;name&quot;:&quot;1&quot;}

Content-Type: application/json;charset=UTF-8
Content-Length: 309
Date: Sun, 01 Mar 2020 08:07:25 GMT
Keep-Alive: timeout=60
Connection: keep-alive
[{&quot;arguments&quot;:[{&quot;arguments&quot;:[],&quot;code&quot;:&quot;name&quot;,&quot;codes&quot;:[&quot;user.name&quot;,&quot;name&quot;],&quot;defaultMessage&quot;:&quot;name&quot;},10,2],&quot;bindingFailure&quot;:false,&quot;code&quot;:&quot;Size&quot;,&quot;codes&quot;:[&quot;Size.user.name&quot;,&quot;Size.name&quot;,&quot;Size.java.lang.String&quot;,&quot;Size&quot;],&quot;defaultMessage&quot;:&quot;长度在2到10之间&quot;,&quot;field&quot;:&quot;name&quot;,&quot;objectName&quot;:&quot;user&quot;,&quot;rejectedValue&quot;:&quot;1&quot;}]
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_5-请求rest接口" tabindex="-1"><a class="header-anchor" href="#_5-请求rest接口" aria-hidden="true">#</a> 5.  请求Rest接口</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/users/1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6-上传下载" tabindex="-1"><a class="header-anchor" href="#_6-上传下载" aria-hidden="true">#</a> 6. 上传下载</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//Servlet原生
response.setCharacterEncoding(&quot;utf-8&quot;);
response.setContentType(&quot;application/octet-stream&quot;);
response.setHeader(&quot;Content-disposition&quot;, &quot;attachment;filename=\&quot;&quot;
                   + new String(fileName.getBytes(&quot;UTF-8&quot;),&quot;ISO8859_1&quot;) + &quot;\&quot;&quot;);
FileInputStream fis = new FileInputStream(path+fileName);
ServletOutputStream sos = response.getOutputStream();
int b;
byte[] buffer = new byte[1024*8];
while ((b = fis.read(buffer))!= -1) {
    sos.write(buffer, 0, b);
}
fis.close();
sos.close();
  

//SpringMVC
  @RequestMapping(&quot;/download&quot;)
  public ResponseEntity&lt;byte[]&gt; download(@RequestParam String fileName) throws IOException {
      File file = new File(&quot;C:\\&quot;+fileName);
      byte[] body = null;
      InputStream inputStream = new FileInputStream(file);
      body = new byte[inputStream.available()];
      inputStream.read(body);
      HttpHeaders httpHeaders = new HttpHeaders();
      httpHeaders.add(&quot;Content-disposition&quot;,&quot;attachment;filename=&quot;+fileName);
      HttpStatus httpStatus = HttpStatus.OK;
      ResponseEntity&lt;byte[]&gt; entity = new ResponseEntity&lt;&gt;(body,httpHeaders,httpStatus);
      return entity;
  }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="spring-bean" tabindex="-1"><a class="header-anchor" href="#spring-bean" aria-hidden="true">#</a> Spring Bean</h2><h3 id="bean的生命周期" tabindex="-1"><a class="header-anchor" href="#bean的生命周期" aria-hidden="true">#</a> Bean的生命周期</h3><blockquote><p>实例化 -&gt; 属性赋值 -&gt; 初始化 -&gt; 销毁</p></blockquote><h3 id="bean级生命周期接口" tabindex="-1"><a class="header-anchor" href="#bean级生命周期接口" aria-hidden="true">#</a> Bean级生命周期接口</h3><ol><li>BeanNameAware(对象实例化设置属性之后设置BeanName)</li><li>BeanFactoryAware(设置BeanFactory)</li><li>InitializingBean(实例化之后调用)</li><li>DisposableBean (销毁)</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>package com.demo.bean;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.*;

@Slf4j
public class Test implements BeanNameAware, BeanFactoryAware, InitializingBean, DisposableBean {
    private String name;
    public String getName() {
        return name;
    }
    public void setName(String name) {
        System.out.println(&quot;setName&quot;+name);
        this.name = name;
    }
    @Override
    public void setBeanFactory(BeanFactory beanFactory) throws BeansException {
        System.out.println(beanFactory.toString());
    }
    @Override
    public void setBeanName(String s) {
        System.out.println(&quot;beanName:&quot;+s);
    }
    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println(&quot;afterPropertiesSet&quot;);
    }
    @Override
    public void destroy() throws Exception {
        System.out.println(&quot;destroy&quot;);
    }
    private void myInit() {
        System.out.println(&quot;myInit&quot;);
    }
    private void myDestroy() {
        System.out.println(&quot;myDes&quot;);
    }
}

}
package com.demo.bean;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;

/**
 * 实例化完成之后调用该接口
 */
public class MyBeanPostProcessor implements BeanPostProcessor {
    //实例化完成，setBeanName/setBeanFactory完成之后调用该方法
    public Object postProcessBeforeInitialization(Object o, String s) throws BeansException {
        System.out.println(&quot;postProcessBeforeInitialization&quot;);
        return o;
    }
    //全部是实例化完成以后调用该方法
    public Object postProcessAfterInitialization(Object o, String s) throws BeansException {
        System.out.println(&quot;postProcessAfterInitialization&quot;);
        return o;
    }

}
package com.demo.bean;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessorAdapter;

/**
 * 实例化前／后，及框架设置Bean属性时调用该接口
 */
public class MyInstantiationAwareBeanPostProcessor extends InstantiationAwareBeanPostProcessorAdapter {
    //在Bean对象实例化前调用
    @Override
    public Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) throws BeansException {
        System.out.println(&quot;postProcessBeforeInstantiation&quot;);
        return null;
    }
    //在Bean对象实例化后调用（如调用构造器之后调用）
    @Override
    public boolean postProcessAfterInstantiation(Object bean, String beanName) throws BeansException {
        System.out.println(&quot;postProcessAfterInstantiation&quot;);
        return true;
    }
}
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans
        xmlns=&quot;http://www.springframework.org/schema/beans&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xmlns:p=&quot;http://www.springframework.org/schema/p&quot;
        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
    &lt;bean id=&quot;test&quot; class=&quot;com.demo.bean.Test&quot;
          p:name = &quot;Paul&quot;
          init-method=&quot;myInit&quot;
          destroy-method=&quot;myDestroy&quot;
    /&gt;
&lt;/beans&gt;
@Resource
    private BeanFactory beanFactory;
    @Test
    void beanFactory(){
        org.springframework.core.io.Resource resource =  new ClassPathResource(&quot;Test.xml&quot;);
        BeanFactory beanFactory = new DefaultListableBeanFactory();
        XmlBeanDefinitionReader reader = new XmlBeanDefinitionReader((DefaultListableBeanFactory) beanFactory);
        reader.loadBeanDefinitions(resource);

        //向容器中注册后处理器 MyBeanPostProcessor
        ((DefaultListableBeanFactory) beanFactory).addBeanPostProcessor(new MyBeanPostProcessor());

        //向容器中注册后处理器 MyInstantiationAwareBeanPostProcessor
        //注意：后处理器调用顺序和注册顺序无关。在处理多个后处理器的情况下，必需通过实现Ordered接口来确定顺序
        ((DefaultListableBeanFactory) beanFactory).addBeanPostProcessor(new MyInstantiationAwareBeanPostProcessor());

        com.demo.bean.Test test = (com.demo.bean.Test) beanFactory.getBean(&quot;test&quot;);
        ((DefaultListableBeanFactory) beanFactory).destroySingletons();
    }

    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><p>输出如下:</p><blockquote><p>postProcessBeforeInstantiation postProcessAfterInstantiation setNamePaul beanName:test org.springframework.beans.factory.support.DefaultListableBeanFactory@2f0e7fa8: defining beans [test]; root of factory hierarchy postProcessBeforeInitialization afterPropertiesSet myInit postProcessAfterInitialization Paul destroy myDes</p></blockquote><h3 id="容器级bean生命周期接口" tabindex="-1"><a class="header-anchor" href="#容器级bean生命周期接口" aria-hidden="true">#</a> 容器级Bean生命周期接口</h3><ol><li>InstantiationAwareBeanPostProcessorAdapter</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    //在Bean对象实例化前调用
    @Override
    public Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) throws BeansException;
 
    //在Bean对象实例化后调用（如调用构造器之后调用）
    @Override
    public boolean postProcessAfterInstantiation(Object bean, String beanName) throws BeansException;
 
    /**
     * 在设置某个属性前调用，然后再调用设置属性的方法
     * 注意：这里的设置属性是指通过配置设置属性，直接调用对象的setXX方法不会调用该方法，如bean配置中配置了属性address/age属性，将会调用该方法
     * @param pvs 如 PropertyValues: length=2; bean property &#39;address&#39;; bean property &#39;age&#39;
     */
    @Override
    public PropertyValues postProcessPropertyValues(PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName) throws BeansException;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol><li>BeanPostProcessor</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    //实例化完成，setBeanName/setBeanFactory完成之后调用该方法
    public Object postProcessBeforeInitialization(Object o, String s) throws BeansException;
 
    //全部是实例化完成以后调用该方法
    public Object postProcessAfterInitialization(Object o, String s) throws BeansException;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="beanfactory和applicationcontext" tabindex="-1"><a class="header-anchor" href="#beanfactory和applicationcontext" aria-hidden="true">#</a> BeanFactory和ApplicationContext</h3><ul><li>前者是Spring容器底层实现的基础,负责配置创建管理bean,它主要的方法由getBean,在beanfactory初始化的时候并不会创建bean,只有在读取配置从容器中拿bean的时候才会实例化,与后者相比,它只能提供基本的DI功能.</li><li>ApplicationContext(称为Spring上下文)是BeanFactory的子接口,它们都可以当做Spring的容器，Spring容器是生成Bean实例的工厂，并管理容器中的Bean。在基于Spring的Java EE应用中，所有组件都被当成Bean处理，包括数据源,SessionFactory、事务管理器等。在启动的时候就把所有的Bean全部实例化了。也可以为Bean配置lazy-init=true来让Bean延迟实例化.</li></ul><p>其常用的实现类包括:</p><ol><li>AnnotationConfigApplicationContext:从一个或多个基于java的配置类中加载上下文定义，适用于java注解的方式。</li><li>ClassPathXmlApplicationContext:从类路径下的一个或多个xml配置文件中加载上下文定义，适用于xml配置的方式。</li></ol><h3 id="bean的作用域" tabindex="-1"><a class="header-anchor" href="#bean的作用域" aria-hidden="true">#</a> Bean的作用域</h3><p>Spring默认的Bean是容器级单例的(即通过SpringIOC获取的对象都是唯一的),而Java中使用比如静态枚举类实现的单例是JVM级的单例. 通常使用@Scope来声明bean的作用域:</p><ul><li>singleton:IOC容器仅创建一个Bean实例，IOC容器每次返回的是同一个Bean实例。</li><li>prototype:IOC容器可以创建多个Bean实例，每次返回的都是一个新的实例。</li><li>request:该属性仅对HTTP请求产生作用，使用该属性定义Bean时，每次HTTP请求都会创建一个新的Bean，适用于WebApplicationContext环境。</li><li>session:该属性仅用于HTTP Session，同一个Session共享一个Bean实例。不同Session使用不同的实例。(用于比如购物车等场景)</li><li>global-session:该属性仅用于HTTP Session，同session作用域不同的是，所有的Session共享一个Bean实例。</li></ul><h3 id="bean循环依赖问题" tabindex="-1"><a class="header-anchor" href="#bean循环依赖问题" aria-hidden="true">#</a> Bean循环依赖问题</h3><p>比如classA中有一个成员变量B,B中又有A作为成员变量.在Spring中是通过三级缓存解决循环依赖的问题的(当bean是单例模式的时候才能被缓存). Spring单例对象的初始化主要是三步:</p><blockquote><p>实例化(instance)-填充属性-初始化(调用init方法) 循环依赖主要是因为前两步: 在A实例化后,便将自己曝光在singletonFactories中,当注入B属性的时候发现B还没有被create,所以走create流程,B初始化第一步的时候发现依赖A,于是尝试getA,在一级缓存singletonObjects二级缓存earlySingletonObjects都没有找到A,尝试从三级缓存singletonFactories中,由于A的提前曝光,所以B能拿到A的引用,在B拿到之后便完成了初始化,并将自己放到一级缓存中,此时返回到A中,便能顺利完成初始化.</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/** Cache of singleton objects: bean name --&gt; bean instance */
private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;String, Object&gt;(256);

/** Cache of singleton factories: bean name --&gt; ObjectFactory */
private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;String, ObjectFactory&lt;?&gt;&gt;(16);

/** Cache of early singleton objects: bean name --&gt; bean instance */
private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;String, Object&gt;(16);
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>singletonFactories ： 单例对象工厂的cache earlySingletonObjects ：提前暴光的单例对象的Cache singletonObjects：单例对象的cache 由于加入singletonFactories三级缓存的前提是执行了构造器，所以构造器的循环依赖没法解决.</p></blockquote><h3 id="bean的创建和使用" tabindex="-1"><a class="header-anchor" href="#bean的创建和使用" aria-hidden="true">#</a> Bean的创建和使用</h3><h4 id="创建" tabindex="-1"><a class="header-anchor" href="#创建" aria-hidden="true">#</a> 创建</h4><ol><li>注解 一般就是在类上添加@Component, @Service等注解（@Controller表示提供http接口的bean, @Configuration表示配置类Bean)(注意bean的包路径扫描配置)</li><li><a href="/Bean">@Bean </a> 主要是结合Configuration来定义bean，首先是声明一个配置类，然后再配置类中，通过返回bean对象的方法形式来声明bean</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Configuration
public class BeanLoadConfig {
    @Bean
    public ConfigDemoBean configDemoBean() {
        return new ConfigDemoBean();
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li>工厂类方式 实现FactoryBean接口</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
public class MyBean implements FactoryBean&lt;Object&gt; {


    @Override
    public Object getObject() throws Exception {
        return null;
    }

    @Override
    public Class&lt;?&gt; getObjectType() {
        return null;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>再通过MyBean来获取所需要的bean对象</p><h4 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h4><ol><li>Autowired @Autowired或者@Resource添加到成员变量上，即表示这个成员变量会由Spring容器注入对应的Bean对象</li><li>Setter</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>private MyBean demo;

@Autowired
private void setMyBean(Mybean demo) {
    this.demo = demo;
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>构造方法</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public class DemoController {
    private MyBean demo;
    public DemoController(MyBean demo) {
        this.demo= demo;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="多实例bean的选择" tabindex="-1"><a class="header-anchor" href="#多实例bean的选择" aria-hidden="true">#</a> 多实例Bean的选择</h4><p>比如一个接口两个实现类,</p><blockquote><p>IPrint: ConsolePrint,LogPrint</p></blockquote><p>@Autowired注解时，属性名即为默认的Bean名，如下面的logPrint就是获取beanName=logPrint的bean @Resource(name=xxx) 直接指定Bean的name，来唯一选择匹配的bean</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Resource(name = &quot;consolePrint&quot;)
    private IPrint consolePrint;
    @Autowired
    private IPrint logPrint;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>也可以通过@Primary来解决:当有多个bean满足注入条件时，有这个注解的实例被选中</p><blockquote><p>@Primary注解的使用有唯一性要求：一个接口的子类中，只能有一个实现上有这个注解</p></blockquote><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h2><h4 id="尽量使用构造注入" tabindex="-1"><a class="header-anchor" href="#尽量使用构造注入" aria-hidden="true">#</a> 尽量使用构造注入</h4><blockquote><p>保证依赖不可变（final关键字） 保证依赖不为空（省去了我们对其检查）</p></blockquote><blockquote><p>保证返回客户端（调用）的代码的时候是完全初始化的状态</p></blockquote><blockquote><p>避免了循环依赖</p></blockquote><blockquote><p>提升了代码的可复用性</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="静态实例" tabindex="-1"><a class="header-anchor" href="#静态实例" aria-hidden="true">#</a> 静态实例</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinioUtil</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MinioClient</span> minioClient<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MinioConfig</span> minioConfig<span class="token punctuation">;</span>
	<span class="token comment">//不需要显示的添加@Autowire(如果类只提供了一个带参数的构造方法)</span>
    <span class="token keyword">public</span> <span class="token class-name">MinioUtil</span><span class="token punctuation">(</span><span class="token class-name">MinioConfig</span> minioConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minioConfig <span class="token operator">=</span> minioConfig<span class="token punctuation">;</span>
        minioClient <span class="token operator">=</span> minioConfig<span class="token punctuation">.</span><span class="token function">getMinioClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="spring-aop" tabindex="-1"><a class="header-anchor" href="#spring-aop" aria-hidden="true">#</a> Spring AOP</h2><h3 id="异常处理" tabindex="-1"><a class="header-anchor" href="#异常处理" aria-hidden="true">#</a> 异常处理</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonExceptionAdvice</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot; 公共异常: {} &quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">ERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span> <span class="token function">handlerIllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;非法参数异常: {} &quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">PARAMS_ERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PARAMS_ERROR</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span> <span class="token function">handlerMethodArgumentNotValidException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;非法参数异常: {} &quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">ObjectError</span><span class="token operator">::</span><span class="token function">getDefaultMessage</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">PARAMS_ERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PARAMS_ERROR</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span> <span class="token function">handlerNullPointerException</span><span class="token punctuation">(</span><span class="token class-name">NullPointerException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;空值异常: {} &quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">PARAMS_NULL</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PARAMS_NULL</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">CustomException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span> <span class="token function">handlerCustomException</span><span class="token punctuation">(</span><span class="token class-name">CustomException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;自定义异常: {} &quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonResponseBody</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span>  code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomException</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonResponseBodyAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseBodyAdvice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> selectedConverterType<span class="token punctuation">,</span> <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">IMAGE_JPEG</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>selectedContentType<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">CommonResponseEnum</span> <span class="token punctuation">{</span>

    <span class="token function">SUCCESS</span><span class="token punctuation">(</span><span class="token number">20000</span><span class="token punctuation">,</span> <span class="token string">&quot;操作成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ERROR</span><span class="token punctuation">(</span><span class="token number">40000</span><span class="token punctuation">,</span> <span class="token string">&quot;操作失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">DATA_NOT_FOUND</span><span class="token punctuation">(</span><span class="token number">40001</span><span class="token punctuation">,</span> <span class="token string">&quot;查询失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PARAMS_NULL</span><span class="token punctuation">(</span><span class="token number">40002</span><span class="token punctuation">,</span> <span class="token string">&quot;参数不能为空！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">NOT_LOGIN</span><span class="token punctuation">(</span><span class="token number">40003</span><span class="token punctuation">,</span> <span class="token string">&quot;当前账号未登录！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PARAMS_ERROR</span><span class="token punctuation">(</span><span class="token number">40005</span><span class="token punctuation">,</span> <span class="token string">&quot;参数不合法！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">AUTH_DENY</span><span class="token punctuation">(</span><span class="token number">4006</span><span class="token punctuation">,</span><span class="token string">&quot;没有权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

    <span class="token class-name">CommonResponseEnum</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="简单authfilter" tabindex="-1"><a class="header-anchor" href="#简单authfilter" aria-hidden="true">#</a> 简单AuthFilter</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonAuthFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CommonExceptionAdvice<span class="token punctuation">.</span>CustomException</span><span class="token punctuation">(</span><span class="token constant">AUTH_DENY</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">AUTH_DENY</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CommonExceptionAdvice<span class="token punctuation">.</span>CustomException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            servletResponse<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            servletResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            servletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="aop-日志-非异步" tabindex="-1"><a class="header-anchor" href="#aop-日志-非异步" aria-hidden="true">#</a> AOP 日志(非异步)</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yonyou<span class="token punctuation">.</span>aspect</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">SneakyThrows</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">JoinPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AfterThrowing</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Around</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Pointcut</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">MethodSignature</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">RequestContextHolder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">ServletRequestAttributes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> zongkxc
 * @Description
 * <span class="token keyword">@create</span> 2021/6/8  10:14
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestLogAspect</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.yonyou.web..*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">requestServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;requestServer()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServletRequestAttributes</span> attributes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RequestInfo</span> requestInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setHttpMethod</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setClassMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s.%s&quot;</span><span class="token punctuation">,</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setRequestParams</span><span class="token punctuation">(</span><span class="token function">getRequestParamsByProceedingJoinPoint</span><span class="token punctuation">(</span>proceedingJoinPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestInfo<span class="token punctuation">.</span><span class="token function">setTimeCost</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Request Info      : {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>requestInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>pointcut <span class="token operator">=</span> <span class="token string">&quot;requestServer()&quot;</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfterThrow</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletRequestAttributes</span> attributes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RequestErrorInfo</span> requestErrorInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestErrorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestErrorInfo<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestErrorInfo<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestErrorInfo<span class="token punctuation">.</span><span class="token function">setHttpMethod</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestErrorInfo<span class="token punctuation">.</span><span class="token function">setClassMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s.%s&quot;</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestErrorInfo<span class="token punctuation">.</span><span class="token function">setRequestParams</span><span class="token punctuation">(</span><span class="token function">getRequestParamsByJoinPoint</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestErrorInfo<span class="token punctuation">.</span><span class="token function">setException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Error Request  Info      : {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>requestErrorInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRequestParamsByProceedingJoinPoint</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramNames <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span>proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParameterNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramValues <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">buildRequestParam</span><span class="token punctuation">(</span>paramNames<span class="token punctuation">,</span> paramValues<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRequestParamsByJoinPoint</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramNames <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParameterNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramValues <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">buildRequestParam</span><span class="token punctuation">(</span>paramNames<span class="token punctuation">,</span> paramValues<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildRequestParam</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramNames<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramValues<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> requestParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paramNames<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> paramValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">MultipartFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">MultipartFile</span> file <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MultipartFile</span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
                value <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            requestParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>paramNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> requestParams<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestInfo</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> ip<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> httpMethod<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> classMethod<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Object</span> requestParams<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Object</span> result<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> timeCost<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestErrorInfo</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> ip<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> httpMethod<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> classMethod<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Object</span> requestParams<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">RuntimeException</span> exception<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br></div></div><h3 id="aop-日志-异步" tabindex="-1"><a class="header-anchor" href="#aop-日志-异步" aria-hidden="true">#</a> AOP 日志 (异步)</h3><h2 id="spring-transaction" tabindex="-1"><a class="header-anchor" href="#spring-transaction" aria-hidden="true">#</a> Spring Transaction</h2><p>Spring事务管理分为编程式和声明式，声明式基于AOP，将业务和事务解耦，声明式的事务不会污染业务代码，常用于Service层。</p><h3 id="传播性-propagation" tabindex="-1"><a class="header-anchor" href="#传播性-propagation" aria-hidden="true">#</a> 传播性（propagation）</h3><ol><li>PROPAGATION_REQUIRED（默认） 在程序运行中，如果一个方法已经在一个事务中，那么就加入改事务，否则创建一个新的事务。</li><li>PROPAGATION_REQUIRES_NEW 不管是否存在事务，该方法总会为自己发起一个新的事务。如果方法已经运行在一个事务中，则原有事务挂起，新的事务被创建。</li><li>PROPAGATION_SUPPORTS 假设ServiceB.methodB() 的事务级别为 PROPAGATION_SUPPORTS，那么当执行到ServiceB.methodB()时，如果发现ServiceA.methodA()已经开启了一个事务，则加入当前的事务，如果发现ServiceA.methodA()没有开启事务，则自己也不开启事务。这种时候，内部方法的事务性完全依赖于最外层的事务。</li></ol><h3 id="事务不生效的原因" tabindex="-1"><a class="header-anchor" href="#事务不生效的原因" aria-hidden="true">#</a> 事务不生效的原因</h3><ol><li>spring默认是通过动态代理实现aop（jdk代理：基于接口，cglib基于继承），无法代理private方法。 可以手动织入，@spectj，编译的时候织入需要代理的方法；或者私有方法更改为public</li><li>需要通过代理类调用方法才能调用事务增强过的方法。可以在service中注入一个selfbean，且子调用必须用注入的对象进行调用，否则还是this。 事务生效</li></ol><h3 id="回滚不生效的原因" tabindex="-1"><a class="header-anchor" href="#回滚不生效的原因" aria-hidden="true">#</a> 回滚不生效的原因</h3><p>1，手动catch到异常 2，默认只对runtimeexception和error进行回滚，对于受检异常，并不会回滚，这种异常常与业务相关。可以在@transactional（rollbackFor=&quot;Exception.class&quot;）</p><h2 id="spring-async" tabindex="-1"><a class="header-anchor" href="#spring-async" aria-hidden="true">#</a> Spring Async</h2><h3 id="引入" tabindex="-1"><a class="header-anchor" href="#引入" aria-hidden="true">#</a> 引入</h3><p>今天线上的项目遇到一个问题，有个Ajax请求后台需要处理的时间太长，后台业务大致是主表和子表数据的迁移，子表数量过多且需要复制数据导致请求时间过长。 考虑Ajax轮询或者后台多线程处理，鉴于子表的数据迁移之间互不影响，所以使用@Async来异步处理子表的数据迁移工作。</p><h3 id="开启" tabindex="-1"><a class="header-anchor" href="#开启" aria-hidden="true">#</a> 开启</h3><p>Spring原生配置application.xml</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>beans里面需要添加:
xmlns:task=&quot;http://www.springframework.org/schema/task&quot;
xsi:schemaLocation中添加: 
http://www.springframework.org/schema/task 
http://www.springframework.org/schema/task/spring-task.xsd&quot;
&lt;task:annotation-driver&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>SpringBoot只需要在启动类上添加注解@EnableAsync即可</p><h3 id="带返回值的future" tabindex="-1"><a class="header-anchor" href="#带返回值的future" aria-hidden="true">#</a> 带返回值的Future</h3><p>测试例子如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
public class AsyncTask {
    @Async
    public Future&lt;String&gt; doTask1(String xlhs) throws Exception {
        System.out.println(&quot;开始做任务一&quot;);
	// 子表1  拷贝入库操作
        return new AsyncResult&lt;String&gt;(&quot;ok&quot;);
    }
    @Async
    public Future&lt;String&gt; doTask2() throws Exception {
        System.out.println(&quot;开始做任务二&quot;);
        // 子表2  拷贝入库操作
	return new AsyncResult&lt;String&gt;(&quot;ok&quot;);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>控制器中代码:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	//
	Future&lt;String&gt; task1 = testTaskAsync.doTask1();
	Future&lt;String&gt; task2 = testTaskAsync.doTask2();
	while(true){
	    if(task1.isDone()&amp;&amp; task2.isDone()){
		break;	
	    }	    
	}
	//
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>控制台可见 任务一和任务二并不是顺序执行的，即完成@Async的使用，使用异步的核心就是程序在顺序执行时，不等待异步调用的语句返回结果就执行后面的程序。 每个异步方法都在在独立的线程内完成操作，这样可以有效减少响应时间。</p><h3 id="future接口" tabindex="-1"><a class="header-anchor" href="#future接口" aria-hidden="true">#</a> Future接口</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public interface Future&lt;V&gt; {
    boolean cancel(boolean mayInterruptIfRunning);
    boolean isCancelled();
    boolean isDone();
    V get() throws InterruptedException, ExecutionException;
    V get(long timeout, TimeUnit unit)
        throws InterruptedException, ExecutionException, TimeoutException;
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><ul><li>cancel方法用来取消任务，如果取消任务成功则返回true，如果取消任务失败则返回false。参数mayInterruptIfRunning表示是否允许取消正在执行却没有执行完毕的任务，如果设置true，则表示可以取消正在执行过程中的任务。如果任务已经完成，则无论mayInterruptIfRunning为true还是false，此方法肯定返回false，即如果取消已经完成的任务会返回false；如果任务正在执行，若mayInterruptIfRunning设置为true，则返回true，若mayInterruptIfRunning设置为false，则返回false；如果任务还没有执行，则无论mayInterruptIfRunning为true还是false，肯定返回true。 - isCancelled方法表示任务是否被取消成功，如果在任务正常完成前被取消成功，则返回 true。 - isDone方法表示任务是否已经完成，若任务完成，则返回true； - get()方法用来获取执行结果，这个方法会产生阻塞，会一直等到任务执行完毕才返回； - get(long timeout, TimeUnit unit)用来获取执行结果，如果在指定时间内，还没获取到结果，就直接返回null。</li></ul></blockquote><p>Future提供了三种功能：判断任务是否完成；能够中断任务；能够获取任务执行结果。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.08em;" aria-hidden="true" width="17.28" height="17.28" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/zongkx/zongkx.github.io/edit/main/notes/java/Spring基础.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/java/SpringCloud.html" class="" aria-label="SpringCloud.md"><!--[--><!--]--> SpringCloud.md <!--[--><!--]--></a></span><span class="next"><a href="/java/WPS.html" class="" aria-label="WPS.md"><!--[--><!--]--> WPS.md <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----></div><!--]--></div>
    <script type="module" src="/assets/app.6a98a4dc.js" defer></script>
  </body>
</html>

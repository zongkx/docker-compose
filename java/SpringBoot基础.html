<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.svg"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>raynor</title><meta name="description" content="raynor's messy notebook.">
    <link rel="modulepreload" href="/assets/app.6a98a4dc.js"><link rel="modulepreload" href="/assets/SpringBoot基础.html.b83671c6.js"><link rel="modulepreload" href="/assets/SpringBoot基础.html.9b29eee1.js">
    <link rel="stylesheet" href="/assets/style.c88710ac.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/favicon.svg" alt="raynor"><span class="site-name can-hide">raynor</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/java/" class="router-link-active" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/database/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/js/" class="" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ops/" class="" aria-label="OPS"><!--[--><!--]--> OPS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/practice/" class="" aria-label="Practice"><!--[--><!--]--> Practice <!--[--><!--]--></a></div><div class="navbar-item"><a href="/snippets/" class="" aria-label="Snippets"><!--[--><!--]--> Snippets <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><div class="navbar-buttons"><a rel="noopener noreferrer" target="_blank" href="https://github.com/zongkx/zongkx.github.io"><svg class="ov-icon" style="font-size:1.26em;" aria-hidden="true" width="20.16" height="20.16" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32 0 01-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 01.676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 01.63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731 0 0112 3.315c.912 0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 01.616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293 0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492 0 01-.012 2.716 1 1 0 01-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998 0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66 0-.955-.312-1.744-.913-2.404a1 1 0 01-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 01-.833.135A9.626 9.626 0 0012 5.315c-.89 0-1.772.119-2.592.35a1 1 0 01-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 01-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 01-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/></svg></a><a rel="noopener noreferrer" target="_blank" href="https://zongkx.icu"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M13.12 17.023l-4.199-2.29a4 4 0 110-5.465l4.2-2.29a4 4 0 11.959 1.755l-4.2 2.29a4.008 4.008 0 010 1.954l4.199 2.29a4 4 0 11-.959 1.755zM6 14a2 2 0 100-4 2 2 0 000 4zm11-6a2 2 0 100-4 2 2 0 000 4zm0 12a2 2 0 100-4 2 2 0 000 4z"/></svg></a><button class="toggle-dark-button" title="toggle dark mode"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor" focusable="false"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 110-12 6 6 0 010 12zm0-2a4 4 0 100-8 4 4 0 000 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewbox="0 0 24 24" fill="currentColor" focusable="false"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0012 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0010 7zm-6 5a8 8 0 0015.062 3.762A9 9 0 018.238 4.938 7.999 7.999 0 004 12z"/></svg></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/java/" class="router-link-active" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/database/" class="" aria-label="DB"><!--[--><!--]--> DB <!--[--><!--]--></a></div><div class="navbar-item"><a href="/js/" class="" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/ops/" class="" aria-label="OPS"><!--[--><!--]--> OPS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/practice/" class="" aria-label="Practice"><!--[--><!--]--> Practice <!--[--><!--]--></a></div><div class="navbar-item"><a href="/snippets/" class="" aria-label="Snippets"><!--[--><!--]--> Snippets <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/java/CSV_Writer.html" class="sidebar-item" aria-label="CSV_Writer.md"><!--[--><!--]--> CSV_Writer.md <!--[--><!--]--></a><!----></li><li><a href="/java/Graylog.html" class="sidebar-item" aria-label="Graylog.md"><!--[--><!--]--> Graylog.md <!--[--><!--]--></a><!----></li><li><a href="/java/Guava.html" class="sidebar-item" aria-label="Guava.md"><!--[--><!--]--> Guava.md <!--[--><!--]--></a><!----></li><li><a href="/java/IDEAlive_template.html" class="sidebar-item" aria-label="IDEAlive_template.md"><!--[--><!--]--> IDEAlive_template.md <!--[--><!--]--></a><!----></li><li><a href="/java/Jackson.html" class="sidebar-item" aria-label="Jackson.md"><!--[--><!--]--> Jackson.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Lamdba.html" class="sidebar-item" aria-label="Java-Lamdba.md"><!--[--><!--]--> Java-Lamdba.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Stream_%E9%9B%86%E5%90%88.html" class="sidebar-item" aria-label="Java-Stream_集合.md"><!--[--><!--]--> Java-Stream_集合.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-Thread.html" class="sidebar-item" aria-label="Java-Thread.md"><!--[--><!--]--> Java-Thread.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E5%8F%8D%E5%B0%84_%E6%B3%9B%E5%9E%8B.html" class="sidebar-item" aria-label="Java-反射_泛型.md"><!--[--><!--]--> Java-反射_泛型.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B8%B8%E9%87%8F.html" class="sidebar-item" aria-label="Java-常见的常量.md"><!--[--><!--]--> Java-常见的常量.md <!--[--><!--]--></a><!----></li><li><a href="/java/Java-%E9%9D%A2%E8%AF%95.html" class="sidebar-item" aria-label="Java-面试.md"><!--[--><!--]--> Java-面试.md <!--[--><!--]--></a><!----></li><li><a href="/java/JavaUtils.html" class="sidebar-item" aria-label="JavaUtils.md"><!--[--><!--]--> JavaUtils.md <!--[--><!--]--></a><!----></li><li><a href="/java/JdbcTemplate.html" class="sidebar-item" aria-label="JdbcTemplate.md"><!--[--><!--]--> JdbcTemplate.md <!--[--><!--]--></a><!----></li><li><a href="/java/Json.html" class="sidebar-item" aria-label="Json.md"><!--[--><!--]--> Json.md <!--[--><!--]--></a><!----></li><li><a href="/java/Maven.html" class="sidebar-item" aria-label="Maven.md"><!--[--><!--]--> Maven.md <!--[--><!--]--></a><!----></li><li><a href="/java/Minio.html" class="sidebar-item" aria-label="Minio.md"><!--[--><!--]--> Minio.md <!--[--><!--]--></a><!----></li><li><a href="/java/Nacos.html" class="sidebar-item" aria-label="Nacos.md"><!--[--><!--]--> Nacos.md <!--[--><!--]--></a><!----></li><li><a href="/java/OkHttp3.html" class="sidebar-item" aria-label="OkHttp3.md"><!--[--><!--]--> OkHttp3.md <!--[--><!--]--></a><!----></li><li><a href="/java/OpenFeign.html" class="sidebar-item" aria-label="OpenFeign.md"><!--[--><!--]--> OpenFeign.md <!--[--><!--]--></a><!----></li><li><a href="/java/" class="router-link-active sidebar-item" aria-label="Dev"><!--[--><!--]--> Dev <!--[--><!--]--></a><!----></li><li><a href="/java/RestTemplate.html" class="sidebar-item" aria-label="RestTemplate.md"><!--[--><!--]--> RestTemplate.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringBoot-%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86DataSourceBean.html" class="sidebar-item" aria-label="SpringBoot-动态管理DataSourceBean.md"><!--[--><!--]--> SpringBoot-动态管理DataSourceBean.md <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="SpringBoot基础.md"><!--[--><!--]--> SpringBoot基础.md <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_1-初始化" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.初始化"><!--[--><!--]--> 1.初始化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_2-web" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.Web"><!--[--><!--]--> 2.Web <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_3-tests" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.Tests"><!--[--><!--]--> 3.Tests <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_4-工程结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.工程结构"><!--[--><!--]--> 4.工程结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_5-配置文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. 配置文件"><!--[--><!--]--> 5. 配置文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_6-多环境配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 多环境配置"><!--[--><!--]--> 6. 多环境配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_7-加载顺序" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. 加载顺序"><!--[--><!--]--> 7. 加载顺序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_8-配置文件特性" class="router-link-active router-link-exact-active sidebar-item" aria-label="8. 配置文件特性"><!--[--><!--]--> 8. 配置文件特性 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#web配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="Web配置"><!--[--><!--]--> Web配置 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#自动配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动配置"><!--[--><!--]--> 自动配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#webmvcconfigurer" class="router-link-active router-link-exact-active sidebar-item" aria-label="WebMvcConfigurer"><!--[--><!--]--> WebMvcConfigurer <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#静态资源处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="静态资源处理"><!--[--><!--]--> 静态资源处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#数据转换器" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据转换器"><!--[--><!--]--> 数据转换器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#拦截器" class="router-link-active router-link-exact-active sidebar-item" aria-label="拦截器"><!--[--><!--]--> 拦截器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#页面跳转" class="router-link-active router-link-exact-active sidebar-item" aria-label="页面跳转"><!--[--><!--]--> 页面跳转 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#数据处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据处理"><!--[--><!--]--> 数据处理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#数据校验" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据校验"><!--[--><!--]--> 数据校验 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#" class="router-link-active router-link-exact-active sidebar-item" aria-label><!--[--><!--]-->  <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="依赖"><!--[--><!--]--> 依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#校验异常处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="校验异常处理"><!--[--><!--]--> 校验异常处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#demo" class="router-link-active router-link-exact-active sidebar-item" aria-label="demo"><!--[--><!--]--> demo <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#统一返回数据结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="统一返回数据结构"><!--[--><!--]--> 统一返回数据结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#统一异常处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="统一异常处理"><!--[--><!--]--> 统一异常处理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#mvc-mime处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="MVC MIME处理"><!--[--><!--]--> MVC MIME处理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#mime" class="router-link-active router-link-exact-active sidebar-item" aria-label="MIME"><!--[--><!--]--> MIME <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#json" class="router-link-active router-link-exact-active sidebar-item" aria-label="JSON"><!--[--><!--]--> JSON <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#xml" class="router-link-active router-link-exact-active sidebar-item" aria-label="XML"><!--[--><!--]--> XML <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#http参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP参数"><!--[--><!--]--> HTTP参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#文件上传" class="router-link-active router-link-exact-active sidebar-item" aria-label="文件上传"><!--[--><!--]--> 文件上传 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#文件下载" class="router-link-active router-link-exact-active sidebar-item" aria-label="文件下载"><!--[--><!--]--> 文件下载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#字节流" class="router-link-active router-link-exact-active sidebar-item" aria-label="字节流"><!--[--><!--]--> 字节流 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#mybatis" class="router-link-active router-link-exact-active sidebar-item" aria-label="Mybatis"><!--[--><!--]--> Mybatis <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_1-依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.依赖"><!--[--><!--]--> 1.依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_2-配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 配置"><!--[--><!--]--> 2. 配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_3-jdbctemplate" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. JdbcTemplate"><!--[--><!--]--> 3. JdbcTemplate <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_4-注解实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 注解实现"><!--[--><!--]--> 4. 注解实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_5-自定义注解" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. 自定义注解"><!--[--><!--]--> 5. 自定义注解 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_6-缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.缓存"><!--[--><!--]--> 6.缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#_7-多数据源" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. 多数据源"><!--[--><!--]--> 7. 多数据源 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#mybatis-plus" class="router-link-active router-link-exact-active sidebar-item" aria-label="Mybatis-plus"><!--[--><!--]--> Mybatis-plus <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#引入" class="router-link-active router-link-exact-active sidebar-item" aria-label="引入"><!--[--><!--]--> 引入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#代码生成器" class="router-link-active router-link-exact-active sidebar-item" aria-label="代码生成器"><!--[--><!--]--> 代码生成器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#兼容原生mybatis" class="router-link-active router-link-exact-active sidebar-item" aria-label="兼容原生Mybatis"><!--[--><!--]--> 兼容原生Mybatis <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#分页插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="分页插件"><!--[--><!--]--> 分页插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#querywrapper" class="router-link-active router-link-exact-active sidebar-item" aria-label="QueryWrapper"><!--[--><!--]--> QueryWrapper <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#jpa" class="router-link-active router-link-exact-active sidebar-item" aria-label="JPA"><!--[--><!--]--> JPA <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#引入-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="引入"><!--[--><!--]--> 引入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#jparepository-crudrepository" class="router-link-active router-link-exact-active sidebar-item" aria-label="JpaRepository/CrudRepository"><!--[--><!--]--> JpaRepository/CrudRepository <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#jpa动态查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="Jpa动态查询"><!--[--><!--]--> Jpa动态查询 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#cache" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cache"><!--[--><!--]--> Cache <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#spring-cache" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring-Cache"><!--[--><!--]--> Spring-Cache <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#ehcache" class="router-link-active router-link-exact-active sidebar-item" aria-label="Ehcache"><!--[--><!--]--> Ehcache <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/SpringBoot%E5%9F%BA%E7%A1%80.html#redis" class="router-link-active router-link-exact-active sidebar-item" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/java/SpringBoot%E8%BF%9B%E9%98%B6.html" class="sidebar-item" aria-label="SpringBoot进阶.md"><!--[--><!--]--> SpringBoot进阶.md <!--[--><!--]--></a><!----></li><li><a href="/java/SpringCloud.html" class="sidebar-item" aria-label="SpringCloud.md"><!--[--><!--]--> SpringCloud.md <!--[--><!--]--></a><!----></li><li><a href="/java/Spring%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="Spring基础.md"><!--[--><!--]--> Spring基础.md <!--[--><!--]--></a><!----></li><li><a href="/java/WPS.html" class="sidebar-item" aria-label="WPS.md"><!--[--><!--]--> WPS.md <!--[--><!--]--></a><!----></li><li><a href="/java/%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6.html" class="sidebar-item" aria-label="安全框架.md"><!--[--><!--]--> 安全框架.md <!--[--><!--]--></a><!----></li><li><a href="/java/%E6%B5%8B%E8%AF%95.html" class="sidebar-item" aria-label="测试.md"><!--[--><!--]--> 测试.md <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>最近项目架构需要更新为SpringBoot，所以重新系统性的学习一次，这是我的笔记。(基于2.2.4)</p><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><h3 id="_1-初始化" tabindex="-1"><a class="header-anchor" href="#_1-初始化" aria-hidden="true">#</a> 1.初始化</h3><p>idea初始化的SpringBoot模块会生成的核心文件为src目录下的三个文件夹:</p><ul><li><strong>src/main/java</strong>下的程序入口：Application</li><li><strong>src/main/resources</strong>下的配置文件：application.properties</li><li><strong>src/test</strong>/下的测试入口：Chapter11ApplicationTests- 以及pom.xml文件,主要有四个部分</li><li><strong>项目元数据</strong>：创建时候输入的Project Metadata部分，也就是Maven项目的基本元素，包括：groupId、artifactId、version、name、description等 parent：继承spring-boot-starter-parent的依赖管理，控制版本与打包等内容</li><li><strong>dependencies</strong>：项目具体依赖，这里包含了spring-boot-starter-web用于实现HTTP接口（该依赖中包含了Spring MVC）；spring-boot-starter-test用于编写- 单元测试的依赖包。</li><li><strong>build</strong>：构建配置部分。默认使用了spring-boot-maven-plugin，配合spring-boot-starter-parent就可以把Spring Boot应用打包成JAR来直接运行。</li></ul><h3 id="_2-web" tabindex="-1"><a class="header-anchor" href="#_2-web" aria-hidden="true">#</a> 2.Web</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@RestController
public class TestController {

    @RequestMapping(&quot;/test&quot;)
    public String index() {
        return &quot;Hello&quot;;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-tests" tabindex="-1"><a class="header-anchor" href="#_3-tests" aria-hidden="true">#</a> 3.Tests</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static org.hamcrest.Matchers.equalTo;

@SpringBootTest
class DemoApplicationTests {
    private MockMvc mvc;
    @Test
    public void getHello() throws Exception {
        mvc = MockMvcBuilders.standaloneSetup(new TestController()).build();
        mvc.perform(MockMvcRequestBuilders.get(&quot;/test&quot;).accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(content().string(equalTo(&quot;Hello&quot;)));
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>测试完成.</p><h3 id="_4-工程结构" tabindex="-1"><a class="header-anchor" href="#_4-工程结构" aria-hidden="true">#</a> 4.工程结构</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>com
  +- example
    +- myproject
      +- Application.java//可扫描到myproject下的配置类等
      +- domain
         +- Customer.java
         +- CustomerRepository.java
      +- service
	 +- impl
	      +- CustomerServiceImpl.java
         +- CustomerService.java
      +- web
         +- CustomerController.java
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_5-配置文件" tabindex="-1"><a class="header-anchor" href="#_5-配置文件" aria-hidden="true">#</a> 5. 配置文件</h3><p>其目录为:src/main/resources/application.properties，在此处定义数据库、日志、服务等配置信息，除此之外也可以自定义配置信息： author:RaynorZong 使用的时候 @Value(&quot;$&quot;),再该配置文件中自定义属性直接也可以通过PlaceHolder进行引用,比如 desc:author is $</p><h3 id="_6-多环境配置" tabindex="-1"><a class="header-anchor" href="#_6-多环境配置" aria-hidden="true">#</a> 6. 多环境配置</h3><p>新增三个配置文件在相同目录下 application-dev.properties：开发环境 application-test.properties：测试环境 application-prod.properties：生产环境 在application.properties中通过spring.profiles.active=dev可以设置当前环境为开发环境</p><h3 id="_7-加载顺序" tabindex="-1"><a class="header-anchor" href="#_7-加载顺序" aria-hidden="true">#</a> 7. 加载顺序</h3><p>Spring Boot为了能够更合理的重写各属性的值，使用了下面这种较为特别的属性加载顺序：</p><ol><li>命令行中传入的参数。</li><li>SPRING_APPLICATION_JSON中的属性。SPRING_APPLICATION_JSON是以JSON格式配置在系统环境变量中的内容。</li><li>java:comp/env中的JNDI属性。</li><li>Java的系统属性，可以通过System.getProperties()获得的内容。</li><li>操作系统的环境变量</li><li>通过random.*配置的随机属性</li><li>位于当前应用jar包之外，针对不同环境的配置文件内容，例如：application-.properties或是YAML定义的配置文件</li><li>位于当前应用jar包之内，针对不同环境的配置文件内容，例如：application-.properties或是YAML定义的配置文件</li><li>位于当前应用jar包之外的application.properties和YAML配置内容</li><li>位于当前应用jar包之内的application.properties和YAML配置内容</li><li>在@Configuration注解修改的类中，通过@PropertySource注解定义的属性</li><li>应用默认属性，使用SpringApplication.setDefaultProperties定义的内容</li></ol><h3 id="_8-配置文件特性" tabindex="-1"><a class="header-anchor" href="#_8-配置文件特性" aria-hidden="true">#</a> 8. 配置文件特性</h3><p>List类型用 []来表示: spring.my-example.url[0]=<a href="http://example.com/" target="_blank" rel="noopener noreferrer">http://example.com</a></p><p>支持逗号分隔: spring.resources.static-locations=classpath:/templates/,classpath:/static/</p><p>属性绑定,比如List类型 com.test[0]=test0 com.test[1]=test1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ApplicationContext context = SpringApplication.run(Application.class, args);
Binder binder = Binder.get(context.getEnvironment());
// 绑定List配置
List&lt;String&gt; test= binder.bind(&quot;com.test&quot;, Bindable.listOf(String.class)).get();
System.out.println(post);
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="web配置" tabindex="-1"><a class="header-anchor" href="#web配置" aria-hidden="true">#</a> Web配置</h2><h3 id="自动配置" tabindex="-1"><a class="header-anchor" href="#自动配置" aria-hidden="true">#</a> 自动配置</h3><p>在SpringBoot中自动配置的WebMvcAutoConfiguration类中已经实现了部分Mvc相关的配置, 官网参考如下: <a href="https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc-auto-configuration" target="_blank" rel="noopener noreferrer">WebMvcAutoConfiguration</a> The auto-configuration adds the following features on top of Spring’s defaults:</p><ul><li>Inclusion of ContentNegotiatingViewResolver and BeanNameViewResolver beans.</li><li>Support for serving static resources, including support for WebJars (covered later in this document)).</li><li>Automatic registration of Converter, GenericConverter, and Formatter beans.</li><li>Support for HttpMessageConverters (covered later in this document).</li><li>Automatic registration of MessageCodesResolver (covered later in this document).</li><li>Static index.html support.</li><li>Custom Favicon support (covered later in this document).</li><li>Automatic use of a ConfigurableWebBindingInitializer bean (covered later in this document).</li></ul><p>如果需要自定义配置的时候,由于SpringBoot 2.0之后WebMvcConfigurerAdapter已经过时,通过实现WebMvcConfigurer接口,可以通过JavaBean的方式对SpringMVC进行定制,也可以通过注解@EnableWebMvc关闭WebMvcAutoConfiguration.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Configuration
@EnableWebMvc
public class MvcConfig implements WebMvcConfigurer{}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="webmvcconfigurer" tabindex="-1"><a class="header-anchor" href="#webmvcconfigurer" aria-hidden="true">#</a> WebMvcConfigurer</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public interface WebMvcConfigurer {
    default void configurePathMatch(PathMatchConfigurer configurer) {
    }
    default void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
    }
    default void configureAsyncSupport(AsyncSupportConfigurer configurer) {
    }
    default void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
    }
    default void addFormatters(FormatterRegistry registry) {
    }
    default void addInterceptors(InterceptorRegistry registry) {
    }
    default void addResourceHandlers(ResourceHandlerRegistry registry) {
    }
    default void addCorsMappings(CorsRegistry registry) {
    }
    default void addViewControllers(ViewControllerRegistry registry) {
    }
    default void configureViewResolvers(ViewResolverRegistry registry) {
    }
    default void addArgumentResolvers(List&lt;HandlerMethodArgumentResolver&gt; resolvers) {
    }
    default void addReturnValueHandlers(List&lt;HandlerMethodReturnValueHandler&gt; handlers) {
    }
    default void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
    }
    default void extendMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
    }
    default void configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {
    }
    default void extendHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {
    }
    @Nullable
    default Validator getValidator() {
        return null;
    }
    @Nullable
    default MessageCodesResolver getMessageCodesResolver() {
        return null;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>其中所有方法都添加了default关键字,从而在实现该接口的时候可以选择性的修改某些具体的方法.</p><h3 id="静态资源处理" tabindex="-1"><a class="header-anchor" href="#静态资源处理" aria-hidden="true">#</a> 静态资源处理</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#默认为 */**
spring.mvc.static-path-pattern: /static/**
#默认值如下
spring.resources.static-locations:classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>前者用来匹配请求路径,当路径中包含/static/的时候才进行处理,匹配命中后才定位到具体的资源,此时需要后者进行优先级的处理,它表示在置顶路径下的匹配顺序. 除此之外也可以使用 继承 WebMvcConfigurerAdapter (已过时)或者实现WebMvcConfigurer 接口(推荐)处理静态资源等问题 下面是WebMvcConfigurer 接口中声明的方法:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public class MvcConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(&quot;/static/**&quot;)
                .addResourceLocations(&quot;classpath:/static/&quot;);
        registry.addResourceHandler(&quot;/templates/**&quot;)
                .addResourceLocations(&quot;classpath:/templates/&quot;);
        registry.addResourceHandler(&quot;/webjars/** &quot;).addResourceLocations(&quot;classpath:/META-INF/resources/webjars/ &quot;);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="数据转换器" tabindex="-1"><a class="header-anchor" href="#数据转换器" aria-hidden="true">#</a> 数据转换器</h3><p>其中addResourceHandlers和configureMessageConverters之前均已经使用过,分别用来处理静态资源和JSON解析器的替换问题. 如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    
    @Override
    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        for (int i = converters.size() - 1; i &gt;= 0; i--) {
            if (converters.get(i) instanceof MappingJackson2HttpMessageConverter) {
                converters.remove(i);
            }
        }
        FastJsonHttpMessageConverter fastJsonHttpMessageConverter = new FastJsonHttpMessageConverter();
        FastJsonConfig config = new FastJsonConfig();
        config.setSerializerFeatures(
                SerializerFeature.WriteMapNullValue,        // 是否输出值为null的字段,默认为false,我们将它打开
                SerializerFeature.WriteNullListAsEmpty,     // 将Collection类型字段的字段空值输出为[]
                SerializerFeature.WriteNullStringAsEmpty,   // 将字符串类型字段的空值输出为空字符串
                SerializerFeature.WriteNullNumberAsZero,    // 将数值类型字段的空值输出为0
                SerializerFeature.WriteDateUseDateFormat,
                SerializerFeature.DisableCircularReferenceDetect    // 禁用循环引用
        );
        fastJsonHttpMessageConverter.setFastJsonConfig(config);
        List&lt;MediaType&gt; fastMediaTypes = new ArrayList&lt;&gt;();
        fastMediaTypes.add(MediaType.APPLICATION_JSON_UTF8);
        fastJsonHttpMessageConverter.setSupportedMediaTypes(fastMediaTypes);
        converters.add(fastJsonHttpMessageConverter);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol><li>其中addResourceHandlers中可以添加多个静态资源映射,区别于application.properties中的</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.resources.static-locations=classpath:/static/,classpath:/templates/
spring.mvc.static-path-pattern=/static/**
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>它可以添加多个pattern,表示在请求路径中匹配不同的pathPattern寻找不同的路径下的资源 另外在SpringBoot默认配置的WebMvcAutoConfiguration中已经配置了部分静态资源和默认的视图跳转 &quot;/&quot;---&gt; &quot;index.html&quot; 比如新建一个模块,在static下新建一个index.html,访问端口后会自动跳转到该页面(如果引入了spring-boot-starter-thymeleaf,则在templates下新建index.html也会正常访问,其优先级小于static;如果我们在Controller中编写了/的跳转为test.html,那么它将会覆盖默认的index.html,且如果引入了thymeleaf,那么test.html必须在templates目录下)其中默认配置的addResourceHandlers代码如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 如果spring.resources.addMappings 为false,则不进行处理
        if (!this.resourceProperties.isAddMappings()) {
            logger.debug(&quot;Default resource handling disabled&quot;);
            return;
        }
        // 获得缓存时间,默认没配置
        Integer cachePeriod = this.resourceProperties.getCachePeriod();
        if (!registry.hasMappingForPattern(&quot;/webjars/**&quot;)) {
            // 如果ResourceHandlerRegistry中不包含/webjars/**的路径映射,
            // 则添加 /webjars/** --&gt; classpath:/META-INF/resources/webjars/ 的映射规则
            customizeResourceHandlerRegistration(
                    registry.addResourceHandler(&quot;/webjars/**&quot;)
                            .addResourceLocations(
                                    &quot;classpath:/META-INF/resources/webjars/&quot;)
                            .setCachePeriod(cachePeriod));
        }
        // 获得静态资源的映射路径,默认为 /**,由于默认配置的/**使用范围太小,更多的需要自己配置静态资源
        String staticPathPattern = this.mvcProperties.getStaticPathPattern();
        if (!registry.hasMappingForPattern(staticPathPattern)) {
            // 如果ResourceHandlerRegistry中不包含静态资源的映射路径,
            // 则添加 staticPathPattern --&gt; classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/, classpath:/public/ 的映射规则
            customizeResourceHandlerRegistration(
                    registry.addResourceHandler(staticPathPattern)
                            .addResourceLocations(
                                    this.resourceProperties.getStaticLocations())
                            .setCachePeriod(cachePeriod));
        }
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>而webjars测试如下:引入(webjars-locator可以在引用的时候帮助省去版本号)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
            &lt;version&gt;3.3.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;webjars-locator&lt;/artifactId&gt;
            &lt;version&gt;0.30&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>访问:http://localhost:8080/webjars/bootstrap/css/bootstrap.min.css即可加载对应的资源文件</p><ol><li>其中configureMessageConverters实现了默认的Jackson替换为Fastjson.</li></ol><h3 id="拦截器" tabindex="-1"><a class="header-anchor" href="#拦截器" aria-hidden="true">#</a> 拦截器</h3><p>首先需要实现一个HandlerInterceptor接口的拦截器实例, 比如</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
@Slf4j
public class MyInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        log.info(&quot;请求路径：{}&quot;, request.getRequestURI());
//	业务处理
        return true;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>registry中的方法:</p><ul><li>addInterceptor:添加自定义的拦截器实例</li><li>addPathPatterns: 拦截规则</li><li>excludePathPatterns:过滤规则</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Resource
    MyInterceptor myInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(myInterceptor).addPathPatterns(&quot;/**&quot;)
                .excludePathPatterns(&quot;/toLogin&quot;,&quot;/login&quot;,&quot;/js/**&quot;,&quot;/css/**&quot;,&quot;/images/**&quot;);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="页面跳转" tabindex="-1"><a class="header-anchor" href="#页面跳转" aria-hidden="true">#</a> 页面跳转</h3><p>大部分页面跳转通过手写Controller类中的方法实现,对于类似登录跳转等,可以通过该方法实现</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController(&quot;/toLogin&quot;).setViewName(&quot;test.html&quot;);
    }
``
这里写的如果和WebMvcAutoConfiguration中默认的 &quot;/&quot;,则优先级大于默认配置.
### 默认静态资源处理器 configureDefaultServletHandling

这里拿 webjar来说明:
在Servlet 3 中 打包后的webjar会被放在 WEB-INF/lib 目录下，而 Servlet 3 允许直接访问 WEB-INF/lib 下 jar 中的 /META-INF/resources 目录下的资源。简单来说就是 WEB-INF/lib/{\*.jar}/META-INF/resources 下的资源可以被直接访问。
对于 Servlet 3 ，直接使用 http://localhost:8080/webjars/jquery/3.4.0/jquery.js 即可访问到 webjar 中的 jquery.js ，而不用做其它的配置。
对于SpringMVC来说,其处理流程只是将入口实现为DispatcherServlet,所有的请求都会汇集于该类，而后分发给不同的处理类。如果不做额外的配置，是无法访问静态资源的。如果想让 Dispatcher Servlet 直接可以访问到静态资源，最简单的方法当然是交给默认的 Servlet 。
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><a href="/Override">@Override </a> public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) { configurer.enable();//这种情况下 Spring MVC 对资源的处理与 Servlet 方式相同.在关闭自动配置的情况下,webjars也能被访问. }</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>具体的内容可参考
[深入 Spring 系列之静态资源处理](https://www.v2ex.com/t/312216)
详细的介绍了SpringMVC的静态资源处理的过程.
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="数据处理" tabindex="-1"><a class="header-anchor" href="#数据处理" aria-hidden="true">#</a> 数据处理</h2><h3 id="数据校验" tabindex="-1"><a class="header-anchor" href="#数据校验" aria-hidden="true">#</a> 数据校验</h3><h4 id="思考" tabindex="-1"><a class="header-anchor" href="#思考" aria-hidden="true">#</a> 思考</h4><p>restful 风格强调了资源而非动作,请求路径资源化,适合单一资源的增删改查的接口风格统一,但是也存在不灵活的问题,比如登录,登录动作抽象为资源可以理解为创建session: post /session 显然不和逻辑,批量删除也没办法按照restful风格等等.实际开发中需要前后台统一一种风格,而非全盘按照restful风格.</p><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h2><h4 id="依赖" tabindex="-1"><a class="header-anchor" href="#依赖" aria-hidden="true">#</a> 依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="校验异常处理" tabindex="-1"><a class="header-anchor" href="#校验异常处理" aria-hidden="true">#</a> 校验异常处理</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResponseBody</span> <span class="token function">handlerMethodArgumentNotValidException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;非法参数异常: {} &quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">ObjectError</span><span class="token operator">::</span><span class="token function">getDefaultMessage</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResponseBody</span><span class="token punctuation">(</span><span class="token constant">PARAMS_ERROR</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PARAMS_ERROR</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="demo" tabindex="-1"><a class="header-anchor" href="#demo" aria-hidden="true">#</a> demo</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zong<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Lists</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Validated</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span></span><span class="token class-name">Max</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span></span><span class="token class-name">Min</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> zongkxc
 * @Description
 * <span class="token keyword">@create</span> 2021/5/31  17:23
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rest&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestfulController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@AllArgsConstructor</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PageRespVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageNum<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageSize<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> total<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PageVO</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Max</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">40L</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;分页最大值不超过40&quot;</span><span class="token punctuation">)</span>
        <span class="token annotation punctuation">@Min</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;分页最小值不小于1&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Min</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;页码最小值不小于1&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//分页查询</span>
    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">PageRespVO</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span><span class="token annotation punctuation">@Validated</span> <span class="token class-name">PageVO</span> pageVO<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageRespVO</span><span class="token punctuation">(</span>pageVO<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pageVO<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//根据id获取</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//新增</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//补丁(更新部分属性)</span>
    <span class="token annotation punctuation">@PatchMapping</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updatePartProperty</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//修改(更新全部属性)</span>
    <span class="token annotation punctuation">@PutMapping</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateAllProperty</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h3 id="统一返回数据结构" tabindex="-1"><a class="header-anchor" href="#统一返回数据结构" aria-hidden="true">#</a> 统一返回数据结构</h3><p>主要为code码/返回数据data/错误提示errorMessage/系统时间currentTime</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Class RestResult.java
    private String code;
    private Object data;
    private Object errorMessage;
    private LocalDateTime currentTime;
Enum ErrorMessage.java
    SYSTEM_EXCEPTION (&quot;系统异常&quot;),
    LOGIC_EXCEPTION(&quot;业务异常&quot;);
    private String msg;
    ErrorMessage(String msg){
        this.msg = msg;
    }
    public String msg() {
        return this.msg;
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>再通过@RestControllerAdvice实现返回结果的封装,该注解与@ControllerAdvice的区别可类比@RestController和@Controller, 此处只对JSON结果进行封装,非JSON结果不进行处理.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@RestControllerAdvice
public class RestResultWrapper implements ResponseBodyAdvice&lt;Object&gt; {
    //可指定针对某些返回值的类型才进行rest风格的封装
    @Override
    public boolean supports(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) {
          Method returnTypeMethod = returnType.getMethod();
          if (returnTypeMethod != null) {
               /////处理
               return  false;
          }
	  return true;
    }
    @Override
    public Object beforeBodyWrite(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request, ServerHttpResponse response) {
        if (MediaType.IMAGE_JPEG.getType().equalsIgnoreCase(selectedContentType.getType())) {
            return body;//可根据实际需求选择是否包装返回的结果
        }
        if (body instanceof RestResult) {
            return body;//如果数据已经包装过,则直接返回
        }
        return new RestResult(&quot;1&quot;, body, &quot;&quot;);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="统一异常处理" tabindex="-1"><a class="header-anchor" href="#统一异常处理" aria-hidden="true">#</a> 统一异常处理</h3><p>在没有异常的情况下,统一返回的结构为RestResult,出现系统异常或者业务异常的时候,需要全局异常处理,同时对RestResult加工一下. 首先需要声明一个业务异常类,继承RuntimeException.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Data
public class LogicException extends RuntimeException{
    private String errorMsg;
    private String code;
    private LogicException(String errorMsg) {
        super(errorMsg);
        this.code = errorMsg.substring(0, 1);
        this.errorMsg = errorMsg.substring(2);
    }
    public static LogicException le(String errorMsg) {
        return new LogicException(errorMsg);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>接下来是全局异常处理类,需要@ControllerAdvice注解,在对其中的方法添加注解: [[@ExceptionHandler(value ](/ExceptionHandler(value ) ](/ExceptionHandler(value ) = Exception.class),即可实现异常的处理,当然此处也可以是MyException.class,通过不同的方法实现对不同类型异常的处理.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Log
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public Object logicExceptionHandler(HttpServletRequest request, Exception e, HttpServletResponse response) {
        RestResult result = new RestResult(&quot;-1&quot;, e.getMessage(), ErrorMessage.SYSTEM_EXCEPTION.msg());
        if (e instanceof LogicException) {//业务异常处理
            LogicException logicException = (LogicException) e;
            result.setCode(logicException.getCode());
            result.setErrorMessage(logicException.getErrorMsg());
        } else {
            log.info(&quot;系统异常:&quot; + e.getMessage());
        }
        return result;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="mvc-mime处理" tabindex="-1"><a class="header-anchor" href="#mvc-mime处理" aria-hidden="true">#</a> MVC MIME处理</h2><h3 id="mime" tabindex="-1"><a class="header-anchor" href="#mime" aria-hidden="true">#</a> MIME</h3><p>是用来描述消息内容类型的因特网标准,能包含文本、图像、音频、视频以及其他应用程序专用的数据,在HTTP中它是用来定义文档性质及格式的标准.</p><h3 id="json" tabindex="-1"><a class="header-anchor" href="#json" aria-hidden="true">#</a> JSON</h3><p>比如下面这样的请求:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /json HTTP/1.1
Content-Length: 18
Host: localhost:8080
Content-Type: application/json
{&quot;content&quot;:&quot;test&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>它指定了客户端发送application/json格式的数据到服务端,同样的在SpringMVC中也可以指定服务端返回的数据格式,比如</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(value =&quot;/json&quot;, consumes={MediaType.APPLICATION_JSON_UTF8_VALUE }, produces=&quot;application/json;charset=UTF-8&quot;)
// consumes 指定该方法只处理application/json格式的数据
// produces 则会在响应头中指定:Content-Type=application/json;charset=UTF-8
// @RestController或@ResponseBody指定该方法返回数据在ResponseBody
//如下面ResponseBody中的{&quot;content&quot;:&quot;test&quot;}
如下:
HTTP/1.1 200
Content-Type: application/json;charset=UTF-8
Content-Length: 70
Date: Thu, 20 Feb 2020 13:40:25 GMT
Keep-Alive: timeout=60
Connection: keep-alive

{&quot;content&quot;:&quot;test&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="xml" tabindex="-1"><a class="header-anchor" href="#xml" aria-hidden="true">#</a> XML</h3><p>Json作为常用的数据类型,上述例子已经展示了其用法,XML在soap,rpc领域中常用,在某些业务场景也经常使用,SpringBoot默认的Jackson想要实现XML数据的处理,需要引入</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   &lt;dependency&gt;
       &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;
       &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;
   &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在Spring项目中,引入该依赖后还需要配置configureMessageConverters,在 WebMvcConfigurer接口中可以实现</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> @Override
    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        Jackson2ObjectMapperBuilder builder = Jackson2ObjectMapperBuilder.xml();
        builder.indentOutput(true);
        converters.add(new MappingJackson2XmlHttpMessageConverter(builder.build()));
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>不过SpringBoot在引入依赖后会自动引入MappingJackson2XmlHttpMessageConverter的实现 请求:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /xml HTTP/1.1
Content-Length: 35
Host: localhost:8080
Content-Type: application/xml

&lt;user&gt;
  &lt;name&gt;Paul&lt;/name&gt;
&lt;/user&gt;
@PostMapping(value = &quot;xml&quot;,consumes = {MediaType.APPLICATION_XML_VALUE},produces = MediaType.APPLICATION_XML_VALUE)
    @ResponseBody
    public User xml(@RequestBody User user){
      log.info(user.getName());//    Paul
      return user;
    }

Content-Type: application/xml
Transfer-Encoding: chunked
Date: Thu, 20 Feb 2020 14:06:16 GMT
Keep-Alive: timeout=60
Connection: keep-alive
&lt;User&gt;&lt;name&gt;Paul&lt;/name&gt;&lt;/User&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="http参数" tabindex="-1"><a class="header-anchor" href="#http参数" aria-hidden="true">#</a> HTTP参数</h3><p>通常可以使用@RequestParam来接收比如表单请求(application/x-www-form-urlencoded)中的form data,也可以是其它类型请求的Request URL中包含的参数,否则会出现Required String parameter &#39;name&#39; is not present,比如使用POST :application/json,在body中添加参数,后台将不能绑定到该数据.当然这个异常可以用该注解的属性(required=false)来避免,不过这样就无法接收到数据</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @RequestMapping(value = &quot;/form&quot;)
    @ResponseBody
    public String form1(@RequestParam String name){
        return name;
    }
    //除此之外也可以直接用 User(name属性)来进行绑定.
    @RequestMapping(value = &quot;/form2&quot;)
    @ResponseBody
    public String form2( User user){
        return user.getName();
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>以上代码可以用表单数据或者URL带参数来获取</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /form HTTP/1.1
Content-Length: 9
Host: localhost:8080
Content-Type: application/x-www-form-urlencoded

Form Data:
 name=Paul
//或者

GET /form?name=Paul HTTP/1.1
Host: localhost:8080
Content-Type: text/plain;charset=UTF-8
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="文件上传" tabindex="-1"><a class="header-anchor" href="#文件上传" aria-hidden="true">#</a> 文件上传</h3><p>文件的格式为:multipart/form-data</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @ResponseBody //返回json数据
    @RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.POST)
    public JSONObject uploadImg(@RequestParam(&quot;file&quot;) MultipartFile file, HttpServletRequest request) {
        String contentType = file.getContentType();
        System.out.print(contentType);
        String fileName = System.currentTimeMillis()+file.getOriginalFilename();
        String filePath = ClassUtils.getDefaultClassLoader()
                .getResource(&quot;&quot;).getPath()+&quot;static/admin/upload/&quot;;
        JSONObject jo = new JSONObject();//实例化json数据
        if (file.isEmpty()) {
            jo.put(&quot;success&quot;, 0);
            jo.put(&quot;fileName&quot;, &quot;&quot;);
        }
        try {
            uploadFile(file.getBytes(), filePath, fileName);
            jo.put(&quot;success&quot;, 1);
            jo.put(&quot;fileName&quot;, fileName);
        } catch (Exception e) {
        }
        return jo;
    }
    public static void uploadFile(byte[] file, String filePath, String fileName) throws Exception {
        File targetFile = new File(filePath);
        if (!targetFile.exists()) {
            targetFile.mkdirs();
        }
        FileOutputStream out = new FileOutputStream(filePath +&quot;/&quot;+ fileName);
        out.write(file);
        out.flush();
        out.close();
    }
        function fileLoad(){
            var form = new FormData();
            form.append(&quot;file&quot;, document.getElementById(&quot;file&quot;).files[0]);
            $.ajax({
                url: &quot;/upload&quot;,
                data: form,
                cache: false,
                async: false,
                type: &quot;POST&quot;, 
                dataType: &#39;json&#39;, //数据返回类型
                processData: false,
                contentType: false,
                success: function (data) { 
                    var res = eval(data);
                    } else {
                        alert(&quot;失败&quot;);
                    }
                }
            });
        }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h3 id="文件下载" tabindex="-1"><a class="header-anchor" href="#文件下载" aria-hidden="true">#</a> 文件下载</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@GetMapping(path =&quot;/download&quot;)
    public ResponseEntity&lt;Resource&gt; download(@RequestParam(&quot;name&quot;)String name)throws IOException{
        File file =new File(&quot;D:/Raynor&quot;, name);
        Path path = Paths.get(file.getAbsolutePath());
        ByteArrayResource resource =new ByteArrayResource(Files.readAllBytes(path));
        return ResponseEntity.ok().header(&quot;Content-Disposition&quot;,&quot;attachment;fileName=&quot;+ name)
                .contentLength(file.length()).contentType(MediaType.APPLICATION_OCTET_STREAM).body(resource);
    }

GET /download?name=1.txt HTTP/1.1
Host: localhost:8080

HTTP/1.1 200
Content-Disposition: attachment;fileName=1.txt //表示文档作为附件保存,名称为1.txt
Accept-Ranges: bytes
Content-Type: application/octet-stream // 表示响应的文档是未知二进制类型,多数浏览器会直接下载
Content-Length: 0
Date: Tue, 25 Feb 2020 11:50:08 GMT
Keep-Alive: timeout=60
Connection: keep-alive
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="字节流" tabindex="-1"><a class="header-anchor" href="#字节流" aria-hidden="true">#</a> 字节流</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(value = &quot;/data1&quot;, produces = MediaType.TEXT_PLAIN_VALUE)
    @ResponseBody
    public String data1(@RequestBody byte[] body) throws Exception {
        return body.toString();
    }
    @PostMapping(value = &quot;/data2&quot;, produces = MediaType.TEXT_PLAIN_VALUE)
    @ResponseBody
    public String data2(InputStream inputStream, HttpServletRequest request) throws Exception {
        log.info(request.getInputStream().toString());
        return inputStream.toString();
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="mybatis" tabindex="-1"><a class="header-anchor" href="#mybatis" aria-hidden="true">#</a> Mybatis</h2><h3 id="_1-依赖" tabindex="-1"><a class="header-anchor" href="#_1-依赖" aria-hidden="true">#</a> 1.依赖</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
            &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.2.12&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-配置" tabindex="-1"><a class="header-anchor" href="#_2-配置" aria-hidden="true">#</a> 2. 配置</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#mysql
spring.datasource.url=jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
#mybatis扫描路径,这里配置的是 resources/mapper/路径,也可以是其他路径
mybatis.mapper-locations=classpath:mapper/*.xml
#对应实体类的路径,这样在xml里面只用写实体类名就能找到对应的类,比如resultType=&quot;User&quot;
mybatis.type-aliases-package=com.demo.model
#PageHelper
pagehelper.helper-dialect=mysql
pagehelper.reasonable=true
pagehelper.support-methods-arguments=true
pagehelper.params=count=countSql
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>接下来只需要维护_.xml和_Mapper.java接口就行,其中xml中mapper标签的namespace属性要与对应Mapper接口的路径一致 例如:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.demo.mapper.UserMapper&quot;&gt;
    &lt;select id=&quot;selectUser&quot; resultType=&quot;User&quot;&gt;
      select * from user
    &lt;/select&gt;
    &lt;select id=&quot;selectUserById&quot; resultType=&quot;User&quot;&gt;
      select * from user where id = #{id}
    &lt;/select&gt;
    &lt;insert id=&quot;addUser&quot; parameterType=&quot;User&quot;&gt;
      insert into user (id,name,pwd) values (#{id},#{name},#{pwd})
    &lt;/insert&gt;
    &lt;update id=&quot;updateUser&quot; parameterType=&quot;User&quot;&gt;
      update user set name=#{name},pwd=#{pwd} where id = #{id}
    &lt;/update&gt;
    &lt;delete id=&quot;deleteUser&quot; parameterType=&quot;int&quot;&gt;
      delete from user where id = #{id}
   &lt;/delete&gt;
&lt;/mapper&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol><li><a href="/Mapper">@Mapper </a> 它是mybatis提供的注解,用于将这个DAO交给Spring管理,生成对应的实现类,另外也可以不使用该注解,而是在SpringBoot的启动类上添加@MapperScan(&quot;com.demo.mapper&quot;)来实现.</li><li><a href="/Repository">@Repository </a> UserMapper接口可以添加注解@Repository,也可以不添加 该注解用于将数据访问层的接口表示为Spring Bean,添加后可以被spring框架所扫描并注入到spring容器来进行管理,类似的还有@Service,@Component,@Controller,其主要区别在于使用于不同层,此处因为Mybatis的配置的MapperScannerConfigurer实现了实例化Spring Bean的功能,所以可以选择不使用<a href="/Repository.">@Repository. </a></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>package com.demo.mapper;
import com.demo.model.User;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.stereotype.Repository;
import java.util.List;
@Mapper
@Repository
public interface UserMapper {
    List&lt;User&gt; selectUser();
    User selectUserById(int id);
    int addUser(User user);
    int updateUser(User user);
    int deleteUser(int id);
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>分页只需要在查询前面,添加</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    PageHelper.startPage(pageNum,pageSize);
    List&lt;User&gt; list= userService.pageUser();
    PageInfo&lt;User&gt; page = new PageInfo&lt;&gt;(list);
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-jdbctemplate" tabindex="-1"><a class="header-anchor" href="#_3-jdbctemplate" aria-hidden="true">#</a> 3. JdbcTemplate</h3><p>也可以通过org.springframework.jdbc.core.JdbcTemplate,直接注入这个bean就可以使用JDBC来操作数据库.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    //JdbcTemplate 是 core 包的核心类，用于简化 JDBC操作，还能避免一些常见的错误，如忘记关闭数据库连接
    //Spring Boot 默认提供了数据源，默认提供了 org.springframework.jdbc.core.JdbcTemplate
    //JdbcTemplate 中会自己注入数据源，使用起来也不用再自己来关闭数据库连接
    @Autowired
    JdbcTemplate jdbcTemplate;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-注解实现" tabindex="-1"><a class="header-anchor" href="#_4-注解实现" aria-hidden="true">#</a> 4. 注解实现</h3><p>Mybatis除了灵活的xml,也提供了诸如@Select、@Update等注解，可以直接实现大部分简单的CRUD功能。 如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Mapper
public interface UserMapper  {

    @Select(&quot;select * from user where id = #{id}&quot;)
    User getUserById(Long id);

    @Delete(&quot;delete from user where id=#{id}&quot;)
    int deleteUserById(Long id);

    @Options(useGeneratedKeys = true,keyProperty = &quot;id&quot;,keyColumn = &quot;id&quot;)
    @Insert(&quot;insert into user (name,password) values(#{name},#{password})&quot;)
    int insertUser(User user);

    @Update(&quot;update user set name=#{name} where id = #{id}&quot;)
    int updateUser(User user);

}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>其中@Options: userGeneratedKeys = &quot;true&quot; : 是在支持主键自增的数据库中使用主键自增属性 keyProperty = &quot;id&quot; : 表示返回的主键值将插入到实体类的id属性中 keyColumn = &quot;id&quot; : 表示主键对应的字段名为id 意为插入数据后将数据库的主键返回,其中id表示主键名. 另外@Delete和@Update在执行成功均返回 1,失败返回0 测试如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> 	User user = userMapper.getUserById(1L);
        log.info(user.toString());
        user.setName(&quot;xxx1&quot;);
        user.setId(10L);
        int update = userMapper.updateUser(user);
        log.info(&quot;成功返回1,失败返回0:&quot;+update);
        User user1 = new User();
        user1.setName(&quot;Eric&quot;);
        user1.setPassword(&quot;123456&quot;);
        int id = userMapper.insertUser(user);
        log.info(&quot;插入数据的主键:&quot;+user.getId()+&quot;&quot;);
        int del = userMapper.deleteUserById(user.getId());
        log.info(&quot;成功返回1,失败返回0:&quot;+del);
 User(id=1, name=xxx1, password=null, time=null, records=null)
 成功返回1,失败返回0:0
 插入数据的主键:7
 成功返回1,失败返回0:1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_5-自定义注解" tabindex="-1"><a class="header-anchor" href="#_5-自定义注解" aria-hidden="true">#</a> 5. 自定义注解</h3><p>SimpleInsertLangDriver/SimpleSelectLangDriver/SimpleUpdateLangDriver三个对象均需要</p><p>继承XMLLanguageDriver 并重写createSqlSource方法</p><h4 id="insert" tabindex="-1"><a class="header-anchor" href="#insert" aria-hidden="true">#</a> insert</h4><p>在数据插入的时候,可能存在比如Oracle中序列的使用,此时通过自定义注解即可完成,能最大化程度上减少无用代码.比如下面代码中的PrimrayKey注解,通过实体类中某个字段的注解,即可完成相应的功能.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">PrimrayKey</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">seq_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>db</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PrimrayKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">SqlSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span></span><span class="token class-name">LanguageDriver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span>xmltags<span class="token punctuation">.</span></span><span class="token class-name">XMLLanguageDriver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Matcher</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleInsertLangDriver</span> <span class="token keyword">extends</span> <span class="token class-name">XMLLanguageDriver</span> <span class="token keyword">implements</span> <span class="token class-name">LanguageDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> inPattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;\\(#\\{(\\w+)\\}\\)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSource</span> <span class="token function">createSqlSource</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">String</span> script<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> inPattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringBuilder</span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field<span class="token operator">:</span>parameterType<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>isAnnotationPresent <span class="token punctuation">(</span><span class="token class-name">PrimrayKey</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">PrimrayKey</span> primrayKey <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">PrimrayKey</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> seqName <span class="token operator">=</span> primrayKey<span class="token punctuation">.</span><span class="token function">seq_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    tmp<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;#{&quot;</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;} || &quot;</span><span class="token operator">+</span>seqName<span class="token operator">+</span><span class="token string">&quot;.nextval,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    tmp<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;#{&quot;</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">getJdbcType</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;},&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            sb<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmp<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;) values (&quot;</span><span class="token operator">+</span>tmp<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            script <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            script <span class="token operator">=</span> <span class="token string">&quot;&lt;script&gt;&quot;</span><span class="token operator">+</span>script<span class="token operator">+</span><span class="token string">&quot;&lt;/script&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> script<span class="token punctuation">,</span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getJdbcType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;,jdbcType=VARCHAR&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span><span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;,jdbcType=DATE&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;,jdbcType=NUMERIC&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h4 id="select" tabindex="-1"><a class="header-anchor" href="#select" aria-hidden="true">#</a> select</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>db</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">SqlSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>parsing<span class="token punctuation">.</span></span><span class="token class-name">XNode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span></span><span class="token class-name">LanguageDriver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span>xmltags<span class="token punctuation">.</span></span><span class="token class-name">XMLLanguageDriver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Matcher</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleSelectLangDriver</span> <span class="token keyword">extends</span> <span class="token class-name">XMLLanguageDriver</span> <span class="token keyword">implements</span> <span class="token class-name">LanguageDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> inPattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;\\(#\\{(\\w+)\\}\\)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSource</span> <span class="token function">createSqlSource</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">String</span> script<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> inPattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;where&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field<span class="token operator">:</span>parameterType<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">String</span> tmp <span class="token operator">=</span> <span class="token string">&quot;&lt;if test=\&quot;_field != null \&quot;&gt; AND _column= #{_field}&lt;/if&gt;&quot;</span><span class="token punctuation">;</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;_field&quot;</span><span class="token punctuation">,</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;_column&quot;</span><span class="token punctuation">,</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/where&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            script <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            script <span class="token operator">=</span> <span class="token string">&quot;&lt;script&gt;&quot;</span><span class="token operator">+</span>script<span class="token operator">+</span><span class="token string">&quot;&lt;/script&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> script<span class="token punctuation">,</span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> update</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>db</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span></span><span class="token class-name">SqlSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span></span><span class="token class-name">LanguageDriver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span>xmltags<span class="token punctuation">.</span></span><span class="token class-name">XMLLanguageDriver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Matcher</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleUpdateLangDriver</span> <span class="token keyword">extends</span> <span class="token class-name">XMLLanguageDriver</span> <span class="token keyword">implements</span> <span class="token class-name">LanguageDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> inPattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;\\(#\\{(\\w+)\\}\\)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSource</span> <span class="token function">createSqlSource</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">String</span> script<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parameterType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> inPattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;set&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field<span class="token operator">:</span>parameterType<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;xlh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">String</span> tmp <span class="token operator">=</span> <span class="token string">&quot;&lt;if test=\&quot;_field != null \&quot;&gt;_column=#{_field},&lt;/if&gt;&quot;</span><span class="token punctuation">;</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;_field&quot;</span><span class="token punctuation">,</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;_column&quot;</span><span class="token punctuation">,</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            sb<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/set&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            script <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            script <span class="token operator">=</span> <span class="token string">&quot;&lt;script&gt;&quot;</span><span class="token operator">+</span>script<span class="token operator">+</span><span class="token string">&quot;&lt;/script&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> script<span class="token punctuation">,</span> parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="应用" tabindex="-1"><a class="header-anchor" href="#应用" aria-hidden="true">#</a> 应用</h4><p>insert</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot; insert into TableName (#{htxx})&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">SimpleInsertLangDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">//插入后获取htid</span>
<span class="token annotation punctuation">@SelectKey</span><span class="token punctuation">(</span>keyColumn <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>resultType <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>before <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> statement <span class="token operator">=</span> <span class="token string">&quot;select id from TableName where xlh = #{xlh}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Htxx</span> htxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>update</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot; update  TableName (#{htxx}) WHERE xlh = #{xlh} &quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Lang</span><span class="token punctuation">(</span><span class="token class-name">SimpleUpdateLangDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">//更新前获取htid</span>
<span class="token annotation punctuation">@SelectKey</span><span class="token punctuation">(</span>keyColumn <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>resultType <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>before <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> statement <span class="token operator">=</span> <span class="token string">&quot;select id from TableName where xlh = #{xlh}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Htxx</span> htxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>select</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ResultType</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>A</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot; select * FROM TableName where xlh = #{xlh}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">String</span> xlh<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="缺点" tabindex="-1"><a class="header-anchor" href="#缺点" aria-hidden="true">#</a> 缺点</h4><p>该方法需要在mapper中通过字符串拼接的方法书写大量的sql语句,维护起来可能存在问题,尤其是select</p><h3 id="_6-缓存" tabindex="-1"><a class="header-anchor" href="#_6-缓存" aria-hidden="true">#</a> 6.缓存</h3><p>Mybatis提供了一级二级缓存,同时预留了集成第三方三级缓存的接口.MyBatis 跟缓存相关的类都在cache 包里面，其中有一个Cache 接口，只有一个默认的实现类 PerpetualCache，它是用HashMap 实现.</p><blockquote><p>SpringBott+MyBatis中一级缓存和二级缓存都是开启的，注意二级缓存虽然是开启状态但是需要进行配置才可以使用 SqlSession ： 对应一次数据库的CURD操作。当所有的CURD都处于同一个事务管理中，SqlSession只会建立一次。</p></blockquote><h4 id="一级缓存" tabindex="-1"><a class="header-anchor" href="#一级缓存" aria-hidden="true">#</a> 一级缓存</h4><p>一级缓存(本地缓存)默认开启,是存在会话层(SqlSession)中的. MyBatis会在一次会话的表示----一个SqlSession对象中创建一个本地缓存(local cache)，对于每一次查询，都会尝试根据查询的条件去本地缓存中查找是否在缓存中，如果在缓存中，就直接从缓存中取出，然后返回给用户；否则，从数据库读取数据，将查询结果存入缓存并返回给用户。 其生命周期如下:</p><ol><li>MyBatis在开启一个数据库会话时，会 创建一个新的SqlSession对象，SqlSession对象中会有一个新的Executor对象，Executor对象中持有一个新的PerpetualCache对象；当会话结束时，SqlSession对象及其内部的Executor对象还有PerpetualCache对象也一并释放掉。</li><li>如果SqlSession调用了close()方法，会释放掉一级缓存PerpetualCache对象，一级缓存将不可用；</li><li>如果SqlSession调用了clearCache()，会清空PerpetualCache对象中的数据，但是该对象仍可使用；</li><li>SqlSession中执行了任何一个update操作(update()、delete()、insert()) ，都会清空PerpetualCache对象的数据，但是该对象可以继续使用； 例如下面:</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Autowired
    SqlSessionFactory sqlSessionFactory;

    @Test
    void test(){
        SqlSession sqlSession = sqlSessionFactory.openSession();
        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
        log.info(userMapper.getUserById(1L).toString());
        log.info(userMapper.getUserById(1L).toString());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以看到控制台只打印了一次sql语句. ( 开启sql输出:logging.level.com.demo.mapper=debug)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Autowired
    SqlSessionFactory sqlSessionFactory;

    @Test
    void test(){
        SqlSession sqlSession = sqlSessionFactory.openSession(true);//true自动提交事务,false手动
        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
        User user = userMapper.getUserById(1L);
        log.info(user.toString());
        user.setPassword(&quot;123&quot;);
        userMapper.updateUser(user);
        log.info(userMapper.getUserById(1L).toString());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果其调用了update或delete,将会删除缓存</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Test
    void test1(){
        SqlSession sqlSession1 = sqlSessionFactory.openSession();
        UserMapper userMapper1 = sqlSession1.getMapper(UserMapper.class);

        SqlSession sqlSession2 = sqlSessionFactory.openSession();
        UserMapper userMapper2 = sqlSession2.getMapper(UserMapper.class);

        User user = userMapper1.getUserById(1L);
        log.info(user.toString());

        user.setPassword(&quot;123&quot;);
        userMapper2.updateUser(user);

        log.info(userMapper1.getUserById(1L).toString());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>由于一级缓存不能跨会话共享,所以上述例子会使其获取到脏数据 控制台输出两端sql,一个查询,一个更新.最后输出的user对象是被session2更改 前的脏数据.为了解决这个问题,一是使用二级缓存,二是更改一级缓存的级别为statement(默认为session ):每次查询结束都会清掉一级缓存</p><h4 id="二级缓存" tabindex="-1"><a class="header-anchor" href="#二级缓存" aria-hidden="true">#</a> 二级缓存</h4><p>范围是namespace级别的，可以被多个SqlSession 共享（只要是同一个接口里面的相同方法，都可以共享），生命周期和应用同步。使用了二级缓存，且Mapper和select语句也配置使用了二级缓存，那么在执行select查询的时候，MyBatis会先从二级缓存中取输入，其次才是一级缓存</p><blockquote><p>MyBatis 用了一个装饰器的类来维护，就是CachingExecutor。如果启用了二级缓存，MyBatis 在创建Executor 对象的时候会对Executor 进行装饰。CachingExecutor 对于查询请求，会判断二级缓存是否有缓存结果，如果有就直接返回，如果没有委派交给真正的查询器Executor 实现类，比如SimpleExecutor 来执行查询，再走到一级缓存的流程。最后会把结果缓存起来，并且返回给用户。</p></blockquote><p>SpringBoot通过启动类注解@EnableCaching(或者在配置文件中添加mybatis.configuration.cache-enabled=true)即可开启二级缓存 A.同时在mapper接口上添加注解</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    @Cacheable(cacheNames = &quot;user&quot;)
    @Select(&quot;select * from user where id = #{id}&quot;)
    User getUserById(Long id);
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>//二级缓存需要User实现序列号接口 然后再对上面的读脏数据的例子测试后发现,没有再出现脏数据的问题. B.或者在*Mapper.xml中添加以下配置</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;cache type=&quot;org.apache.ibatis.cache.impl.PerpetualCache&quot;
    size=&quot;1024&quot;
    eviction=&quot;LRU&quot;//最近最少使用-回收策略
    flushInterval=&quot;120000&quot;//缓存刷新间隔
    readOnly=&quot;false&quot;/&gt; //只读更快,可读写更安全
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>1.映射语句文件中所有的select语句将会被缓存 2.映射语句文件中所有的insert update delete语句会刷新缓存 3.缓存会使用(Least Flush Interval,LRU最近最少使用的)算法来收回 4.根据时间表（如 no Flush Interval,没有刷新间隔），缓存不会以任何时间顺序来刷新 5.缓存会存储集合或对象（无论查询方法返回什么类型的值）的1024个引用 6.缓存会被视为read/wriete(可读/可写)的，意味着对象检索不是共享的，而且可以安全的被调用者修改，而不干扰其他调用者或者线程所做的潜在修改。 7.在开启事务的前提下,事务不提交的话二级缓存将不会生效</p></blockquote><p>二级缓存的适用范围:</p><blockquote><ol><li>为所有的增删改都会刷新二级缓存，导致二级缓存失效，所以适合在查询为主的应用中使用，比如历史交易、历史订单的查询。否则缓存就失去了意义。</li><li>如果多个namespace 中有针对于同一个表的操作，比如Blog 表，如果在一个namespace 中刷新了缓存，另一个namespace 中没有刷新，就会出现读到脏数据的情况。所以，推荐在一个Mapper 里面只操作单表的情况使用。</li></ol></blockquote><p>鉴于Mybatis的二级缓存并不是很好,其配置可以参考如下,之后将学习引入Ehcachehe和Redis作为第三方缓存.</p><h3 id="_7-多数据源" tabindex="-1"><a class="header-anchor" href="#_7-多数据源" aria-hidden="true">#</a> 7. 多数据源</h3><h4 id="思路" tabindex="-1"><a class="header-anchor" href="#思路" aria-hidden="true">#</a> 思路</h4><p>在一个单独的模块中,配置两种数据源,操作不同类型的数据库.</p><p>通过自定义配置类来指向不同的DataSource配置,核心在于Mybatis中的SqlSessionFactory对象,而注解</p><p>MapperScan中可以通过sqlSessionFactoryRef属性指定某个Mapper包下的接口的实现.</p><h4 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h4><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.datasource.ds2.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:oracle:thin:@//172.16.0.148:1521/ORCL</span>
<span class="token key attr-name">spring.datasource.ds2.username</span><span class="token punctuation">=</span><span class="token value attr-value">htjgzkx</span>
<span class="token key attr-name">spring.datasource.ds2.password</span><span class="token punctuation">=</span><span class="token value attr-value">htjgzkx</span>
<span class="token key attr-name">spring.datasource.ds2.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">oracle.jdbc.OracleDriver</span>


<span class="token key attr-name">spring.datasource.ds3.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/</span>
<span class="token key attr-name">spring.datasource.ds3.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.ds3.password</span><span class="token punctuation">=</span><span class="token value attr-value">123</span>
<span class="token key attr-name">spring.datasource.ds3.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="配置类" tabindex="-1"><a class="header-anchor" href="#配置类" aria-hidden="true">#</a> 配置类</h4><p>下面的两个配置类注册了不同的bean,来为db2,db3包下的mapper接口提供不同的对象.Mapper接口正常写即可.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>confg<span class="token punctuation">.</span>datasource</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceTransactionManager</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.mapper.db2&quot;</span><span class="token punctuation">,</span>sqlSessionFactoryRef <span class="token operator">=</span> <span class="token string">&quot;test2SqlSessionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSource2Config</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test2&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.ds2&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">DataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test2SqlSessionFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">test2SqlSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SqlSessionFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test2TransactionManager&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSourceTransactionManager</span> <span class="token function">test2TransactionManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test2SqlSessionTemplates&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionTemplate</span> <span class="token function">test2SqlSessionTemplates</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;test2SqlSessionFactory&quot;</span><span class="token punctuation">)</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>confg<span class="token punctuation">.</span>datasource</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceTransactionManager</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.mapper.db3&quot;</span><span class="token punctuation">,</span>sqlSessionFactoryRef <span class="token operator">=</span> <span class="token string">&quot;test3SqlSessionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSource3Config</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test3&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.ds3&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">DataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test3SqlSessionFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">test3SqlSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;test3&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SqlSessionFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test3TransactionManager&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSourceTransactionManager</span> <span class="token function">test3TransactionManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;test3&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;test3SqlSessionTemplates&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionTemplate</span> <span class="token function">test3SqlSessionTemplates</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;test3SqlSessionFactory&quot;</span><span class="token punctuation">)</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><h4 id="问题和缺点" tabindex="-1"><a class="header-anchor" href="#问题和缺点" aria-hidden="true">#</a> 问题和缺点</h4><p>事务:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;test2TransactionManager&quot;</span><span class="token punctuation">,</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果只是读取Oracle中的数据再写入到Mysql中,事务只需要设置被写入方即可;若均存在写入的情况,事务将不方便处理.</p><p>更好的解决方案:</p><p>是否可以通过自定义注解,来实现Mapper接口实现的时候所使用的实例,而不是需要实现配置好包.</p><h2 id="mybatis-plus" tabindex="-1"><a class="header-anchor" href="#mybatis-plus" aria-hidden="true">#</a> Mybatis-plus</h2><h3 id="引入" tabindex="-1"><a class="header-anchor" href="#引入" aria-hidden="true">#</a> 引入</h3><p>MybatisPlus能够作为一个增强Mybatis的工具，在能够使用MybatisXML自定义Sql的基础上，以无侵入的特点通过内置的Mapper和Service实现大部分单表的增上改查操作，简化代码。其中常用的包括代码构造器、分页、QueryWrapper的使用。更多使用指南官网:<a href="https://mp.baomidou.com/guide/generator.html" target="_blank" rel="noopener noreferrer">MybatisPlus</a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> 	&lt;!--Mybatis Plus--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.0.6&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="代码生成器" tabindex="-1"><a class="header-anchor" href="#代码生成器" aria-hidden="true">#</a> 代码生成器</h3><p>在当前最新的版本中3.0.3之后移除了代码生成器与模板引擎的默认依赖,需要手动引入模板引擎,比如Freemaker.在生成的Mapper接口中,默认没有添加@Mapper注解,建议在SpringBoot的启动类上添加注解 @MapperScan(&quot;com.demo.mapper&quot;)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;dependency&gt;
            &lt;groupId&gt;org.freemarker&lt;/groupId&gt;
            &lt;artifactId&gt;freemarker&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行下面的main方法即可生成相关表的MVC三层结构的代码.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>package com.demo.code;

import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;
import com.baomidou.mybatisplus.core.toolkit.StringPool;
import com.baomidou.mybatisplus.core.toolkit.StringUtils;
import com.baomidou.mybatisplus.generator.AutoGenerator;
import com.baomidou.mybatisplus.generator.InjectionConfig;
import com.baomidou.mybatisplus.generator.config.*;
import com.baomidou.mybatisplus.generator.config.po.TableInfo;
import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;
import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;

import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class CodeGenerator {

    /**
     * 读取控制台内容
     */
    public static String scanner(String tip) {
        @SuppressWarnings(&quot;resource&quot;)
        Scanner scanner = new Scanner(System.in);
        StringBuilder help = new StringBuilder();
        help.append(&quot;请输入&quot; + tip + &quot;：&quot;);
        System.out.println(help.toString());
        if (scanner.hasNext()) {
            String ipt = scanner.next();
            if (StringUtils.isNotEmpty(ipt)) {
                return ipt;
            }
        }
        throw new MybatisPlusException(&quot;请输入正确的&quot; + tip + &quot;！&quot;);
    }
    /*
        Mybatis-plus 版本,最新版本有问题
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.0.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.freemarker&lt;/groupId&gt;
            &lt;artifactId&gt;freemarker&lt;/artifactId&gt;
        &lt;/dependency&gt;
     */
    public static void main(String[] args) {
        // 代码生成器
        AutoGenerator mpg = new AutoGenerator();

        // 全局配置
        GlobalConfig gc = new GlobalConfig();
        String projectPath = System.getProperty(&quot;user.dir&quot;);
        gc.setOutputDir(projectPath + &quot;/day08/src/main/java&quot;);//模块名
        gc.setAuthor(&quot;Raynor&quot;);
        gc.setOpen(false);
        // gc.setSwagger2(true); 实体属性 Swagger2 注解
        mpg.setGlobalConfig(gc);

        // 数据源配置
        DataSourceConfig dsc = new DataSourceConfig();
        dsc.setUrl(&quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone=UTC&quot;);
        //dsc.setSchemaName(&quot;public&quot;);
        dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);
        dsc.setUsername(&quot;root&quot;);
        dsc.setPassword(&quot;123456&quot;);
        mpg.setDataSource(dsc);

        // 包配置
        PackageConfig pc = new PackageConfig();
        //pc.setModuleName(scanner(&quot;模块名&quot;));
        pc.setParent(&quot;com.demo&quot;);
        mpg.setPackageInfo(pc);

        // 自定义配置
        InjectionConfig cfg = new InjectionConfig() {
            @Override
            public void initMap() {
                // to do nothing
            }
        };
        List&lt;FileOutConfig&gt; focList = new ArrayList&lt;&gt;();
        focList.add(new FileOutConfig(&quot;/templates/mapper.xml.ftl&quot;) {
            @Override
            public String outputFile(TableInfo tableInfo) {
                // 自定义输入文件名称
                return projectPath + &quot;/code/src/main/resources/mapper/&quot;
                        + &quot;/&quot; + tableInfo.getEntityName() + &quot;Mapper&quot; + StringPool.DOT_XML;
            }
        });
        cfg.setFileOutConfigList(focList);
        mpg.setCfg(cfg);
        mpg.setTemplate(new TemplateConfig().setXml(null));

        // 策略配置
        StrategyConfig strategy = new StrategyConfig();
        strategy.setNaming(NamingStrategy.underline_to_camel);
        strategy.setColumnNaming(NamingStrategy.underline_to_camel);
        // strategy.setSuperEntityClass(&quot;com.baomidou.ant.common.BaseEntity&quot;);
        strategy.setEntityLombokModel(true);
        strategy.setRestControllerStyle(true);
        // strategy.setSuperControllerClass(&quot;com.baomidou.ant.common.BaseController&quot;);
        strategy.setInclude(scanner(&quot;表名&quot;));
        strategy.setSuperEntityColumns(&quot;id&quot;);
        strategy.setControllerMappingHyphenStyle(true);
        strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);
        mpg.setStrategy(strategy);
        mpg.setTemplateEngine(new FreemarkerTemplateEngine());
        mpg.execute();
    }

}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br></div></div><h3 id="兼容原生mybatis" tabindex="-1"><a class="header-anchor" href="#兼容原生mybatis" aria-hidden="true">#</a> 兼容原生Mybatis</h3><p>在SpringBoot的配置文件中添加一下配置,能够启用原生Mybatis的功能.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#mybatis-plus 实现同时兼任原生Mybatis的xml功能
mybatis-plus.mapper-locations=classpath:mapper/*.xml
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>示例:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.demo.mapper.UserMapper&quot;&gt;
    &lt;select id=&quot;selectUserByName&quot; resultType=&quot;com.demo.entity.User&quot; parameterType=&quot;java.lang.String&quot;&gt;
        select * from user where name = #{name}
    &lt;/select&gt;
&lt;/mapper&gt;
================================
public interface UserMapper extends BaseMapper&lt;User&gt; {
    List&lt;User&gt; selectUserByName(String name);
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="分页插件" tabindex="-1"><a class="header-anchor" href="#分页插件" aria-hidden="true">#</a> 分页插件</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>package com.demo.config;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.transaction.annotation.EnableTransactionManagement;

import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;
import com.baomidou.mybatisplus.extension.plugins.PerformanceInterceptor;


@Configuration
@EnableTransactionManagement(proxyTargetClass = true)
@MapperScan(&quot;com.demo.mapper&quot;)//扫描 mapper接口对应的包

public class MybatisPageConfig {
	
	/**
     * mybatis-plus SQL执行效率插件【生产环境可以关闭】
     */
    @Bean
    public PerformanceInterceptor performanceInterceptor() {
        return new PerformanceInterceptor();
    }
	/**
     * 分页插件
     */
    @Bean
    public PaginationInterceptor paginationInterceptor() {
        return new PaginationInterceptor();
    }
}
    @GetMapping(&quot;/{limit}/{offset}/&quot;)
    public IPage&lt;User&gt; userPage(@PathVariable Long limit,@PathVariable Long offset){
        IPage&lt;User&gt; p = new Page&lt;User&gt;(offset,limit);
        return userService.page(p);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="querywrapper" tabindex="-1"><a class="header-anchor" href="#querywrapper" aria-hidden="true">#</a> QueryWrapper</h3><p>继承自 AbstractWrapper ,自身的内部属性 entity 也用于生成 where 条件.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(&quot;/{limit}/{offset}/&quot;)
    public IPage&lt;User&gt; userPage(@PathVariable Long limit, @PathVariable Long offset, @RequestBody User user){
        QueryWrapper&lt;User&gt; queryWrapper =new QueryWrapper();
        queryWrapper.eq(&quot;name&quot;,user.getName())
                .eq(&quot;password&quot;,user.getPassword())
                .orderByDesc(&quot;time&quot;);
        IPage&lt;User&gt; p = new Page&lt;User&gt;(offset,limit);
        return userService.page(p,queryWrapper);
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="jpa" tabindex="-1"><a class="header-anchor" href="#jpa" aria-hidden="true">#</a> JPA</h2><h3 id="引入-1" tabindex="-1"><a class="header-anchor" href="#引入-1" aria-hidden="true">#</a> 引入</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>基础配置</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>##validate 加载hibernate时，验证创建数据库表结构
##create  每次加载hibernate，重新创建数据库表结构
##create-drop 加载hibernate时创建，退出是删除表结构
##update 加载hibernate自动更新数据库结构
##validate 启动时验证表的结构，不会创建表
##none 启动时不做任何操作
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="jparepository-crudrepository" tabindex="-1"><a class="header-anchor" href="#jparepository-crudrepository" aria-hidden="true">#</a> JpaRepository/CrudRepository</h3><p>Jpa的核心就是声明一个接口继承Jpa提供的接口,其中常用的是JpaRepository/CrudRepository,前者继承了PagingAndSortingRepository,能够实现分页和排序的相关操作,后者提供基础的增上改查操作,其中具体的实现有一定的区别,下面用JpaRepository作为示例,下面实现了分页和自定义查询的功能.</p><h4 id="user-java" tabindex="-1"><a class="header-anchor" href="#user-java" aria-hidden="true">#</a> User.java</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>import lombok.Data;
import javax.persistence.*;

@Entity //默认所有属性映射到数据库中的同名字段
@Table(name = &quot;jpa_user&quot;) // 表名
@Data
public class User {
    @Id //主键
    @GeneratedValue(strategy = GenerationType.AUTO) // 自增
    private Long id;
    private String username;

}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="blog-java" tabindex="-1"><a class="header-anchor" href="#blog-java" aria-hidden="true">#</a> Blog.java</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Entity
@Table(name = &quot;jpa_blog&quot;)
@Data
public class Blog {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    private String title;
    private String content;
    @ManyToOne
    private User author;// 建表后将创建外键:为user表的主键,默认级联关系为RESTRICT,字段名为 author_id
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="blogrepository" tabindex="-1"><a class="header-anchor" href="#blogrepository" aria-hidden="true">#</a> BlogRepository</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

public interface BlogRepository extends JpaRepository&lt;Blog,Long&gt; {
    @Query(&quot;select blog from Blog blog join blog.author author where author.username = ?1&quot;)
    Page&lt;Blog&gt; findByUsername(String username, Pageable pageable);
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="blogcontroller" tabindex="-1"><a class="header-anchor" href="#blogcontroller" aria-hidden="true">#</a> BlogController</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@RestController
@RequestMapping(&quot;/blog&quot;)
public class BlogController {

    @Resource
    private BlogRepository blogRepository;

    @GetMapping(&quot;/{pageNum}/{pageSize}/{username}&quot;)
    public Page&lt;Blog&gt; getBlogByUsername(@PathVariable Integer pageNum,
        @PathVariable Integer pageSize, @PathVariable String username){
        PageRequest pageRequest = PageRequest.of(pageNum,pageSize);
        return blogRepository.findByUsername(username,pageRequest);
    }
    @PostMapping(&quot;/&quot;)
    public String addBlog(@RequestBody Blog blog){
        blogRepository.save(blog);
        return &quot;ok&quot;;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>先添加数据,对上述addBlog接口而言,直接用Blog接收前台参数,需要完整的Json数据 比如:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /blog/1/1/Paul HTTP/1.1
Content-Length: 69
Content-Type: application/json
Host: localhost:8080
{&quot;title&quot;:&quot;title3&quot;,&quot;content&quot;:&quot;c3&quot;,&quot;author&quot;:{&quot;id&quot;:1,&quot;username&quot;:&quot;Paul&quot;}}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>添加完数据后就可以调用查询接口,该接口主要是满足根据用户名查找该用户创建的blog数据</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://localhost:8080/blog/0/2/Paul
//需要注意的是PageRequest.of(pageNum,pageSize) pageNum是从0开始的
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="jpa动态查询" tabindex="-1"><a class="header-anchor" href="#jpa动态查询" aria-hidden="true">#</a> Jpa动态查询</h3><p>Jpa开发维护简单高效,但是对于业务复制的需求而言,其关联查询,动态查询都是其缺点,对于常用的动态查询,可以参考<a href="https://github.com/wenhao/jpa-spec" target="_blank" rel="noopener noreferrer">Jpa动态查询</a>,下面是一个简单的例子,如果未来有需要的话可以深入研究一下.</p><h2 id="cache" tabindex="-1"><a class="header-anchor" href="#cache" aria-hidden="true">#</a> Cache</h2><h3 id="spring-cache" tabindex="-1"><a class="header-anchor" href="#spring-cache" aria-hidden="true">#</a> Spring-Cache</h3><p>Spring从3.1开始定义了org.springframework.cache.Cache和org.springframework.cache.CacheManager接口来统一不同的缓存技术；并支持使用JCache（JSR-107）注解 Spring自带的缓存类型为Simple，这个缓存与Spring Boot应用在同一个Java虚拟机内，适合单体应用系统。</p><h4 id="配置和依赖" tabindex="-1"><a class="header-anchor" href="#配置和依赖" aria-hidden="true">#</a> 配置和依赖</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>	&lt;!-- Spring boot Cache--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>application.properties</li></ol><blockquote><p>#Simple：基于ConcurrentHashMap实现的缓存 #None：禁止使用缓存。 #Redis：使用Redis缓存 .... spring.cache.type=Simple</p></blockquote><ol start="2"><li>启动类添加注解</li></ol><blockquote><p><a href="/EnableCaching">@EnableCaching </a></p></blockquote><h4 id="常用注解" tabindex="-1"><a class="header-anchor" href="#常用注解" aria-hidden="true">#</a> 常用注解</h4><blockquote><ol><li><a href="/Cacheable">@Cacheable </a> 主要针对方法配置，能够根据方法的请求参数对其进行缓存</li><li><a href="/CachePut">@CachePut </a> 保证方法被调用，又希望结果被缓存。与@Cacheable区别在于是否每次都调用方法，常用于更新</li><li><a href="/CacheEvict">@CacheEvict </a> 清空缓存 以上三个注解都有以下属性: value:指定至少一个名称 key:SpEL表达式编写(可空),如@Cacheable(value=&quot;demo&quot;,key=&quot;#id&quot;) condition:缓存条件(可空),如 condition=&quot;#userName.length()&gt;2&quot; unless:否定缓存,当结果为true,则不缓存unless=&quot;#userName.length()&gt;2&quot;</li></ol></blockquote><p>另外@CacheEvict另外有allEntries=true:方法调用后清除缓存 beforeInvocation=true:方法执行前清除缓存,出现异常则不会</p><blockquote><p><a href="/CacheConfig">@CacheConfig </a> 统一配置本类的缓存注解的属性</p></blockquote><h4 id="spel" tabindex="-1"><a class="header-anchor" href="#spel" aria-hidden="true">#</a> SpEL</h4><p>SpEL类似于EL表达式, 常见的包含 关系运算:&gt; &lt; = != gt eq... 算术:+ - * / % 逻辑:&amp;&amp;，||，!，and，or，not，between，instanceof 条件: ()?()😦) 具体可参考Spring官方文档 除此之外还提供了一些SpEL上下文可以使用</p><blockquote><ul><li>methodName:当前被调用的方法名</li><li>method:当前被调用的方法</li><li>target:当前被调用的目标对象实例</li><li>targetClass:当前被调用的目标对象的类</li><li>args:当前被调用的方法的参数列表</li><li>caches:当前方法调用使用的缓存列表 以上都在#root下,比如:#root.targetClass</li><li>Argument Name:当前被调用的方法的参数，如findUser(User user),可以通过#user.id获得参数</li><li>result:方法执行后的返回值（仅当方法执行后的判断有效，如 unless cacheEvict的beforeInvocation=false）</li></ul></blockquote><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h4><ol><li><a href="/Cacheable">@Cacheable </a></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Service
@CacheConfig(cacheNames = &quot;myCache&quot;)
public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements IUserService {
    @Resource
    private UserMapper userMapper;

    @Override
    @Cacheable(key = &quot;#id&quot;)
    //如果在CacheConfig中指定了name,此处可以不用写value值
    //也可以用 “#p参数index”,此处为 #p0
    public User getOne(Long id) {
        return userMapper.selectById(id);
    }
}

    @Resource
    IUserService userService;
    @Test
    void contextLoads() {
        log.info(userService.getOne(1L).toString());
        log.info(userService.getOne(1L).toString());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>连续执行两次查询后,可见控制台只有一次SQL. 2. <a href="/CachePut">@CachePut </a></p><blockquote><p>主要针对方法配置，能够根据方法的请求参数对其结果进行缓存，和 <a href="/Cacheable">@Cacheable </a> 不同的是，它每次都会触发真实方法的调用 。简单来说就是用户更新缓存数据。但需要注意的是该注解的value 和 key 必须与要更新的缓存相同，也就是与<a href="/Cacheable">@Cacheable </a> 相同。</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>     @Override
    @CachePut(key = &quot;#user.id&quot;)
    public User updateUser(User user) {
        return userMapper.updateById(user);
    }

    @Test
    void contextLoads() {
        User user = userService.getOne(1L);
        user.setPassword(&quot;11111&quot;);
        userService.updateUser(user);
        log.info(userService.getOne(1L).toString());
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>//由于updateUser和getOne都在UserServiceImpl下,而UserServiceImpl配置了[[@CacheConfig(cacheNames ](/CacheConfig(cacheNames ) ](/CacheConfig(cacheNames ) = &quot;user&quot;),所以在方法上未声明value值得情况下,这些方法的value都是&#39;user&#39; // 这里有一个坑,对于key和value都相同的缓存方法,如果返回的结果与@Cacheable的返回结果不一致,它将尝试类型转换,如果上面的update返回int类型,则会报类型转换异常:user不能转为integer 3. <a href="/CacheEvict">@CacheEvict </a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    //清除一条缓存，key为要清空的数据
    @CacheEvict(key = &quot;#p0.id&quot;)
    public void delete(User user){
    }

    //方法调用后清空所有缓存
    @CacheEvict(allEntries = true)
    public void deleteAll(){

    }

    @Test
    void contextLoads() {
        User user = userService.getOne(1L);
        user.setPassword(&quot;11111&quot;);
        userService.updateUser(user);
        log.info(userService.getOne(1L).toString());
        userService.delete(user);
        log.info(userService.getOne(1L).toString());//可见结果:缓存被删除后,需要再次查询数据库
    }
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="ehcache" tabindex="-1"><a class="header-anchor" href="#ehcache" aria-hidden="true">#</a> Ehcache</h3><blockquote><p>是现在最流行的纯Java开源缓存框架，配置简单、结构清晰、功能强大，最初知道它，是从Hibernate的缓存开始的, 是Hibernate的二级缓存技术之一，可以把查询出来的数据存储在内存或者磁盘，节省下次同样查询语句再次查询数据库，大幅减轻数据库压力</p></blockquote><h4 id="依赖和配置" tabindex="-1"><a class="header-anchor" href="#依赖和配置" aria-hidden="true">#</a> 依赖和配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.ehcache&lt;/groupId&gt;
    &lt;artifactId&gt;ehcache&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在配置文件中加入:</p><blockquote><p>spring.cache.type=ehcache spring.cache.ehcache.config=classpath:/ehcache.xml</p></blockquote><p>idea中添加完依赖后将在src/resources下出现一个ehcahe.xml,</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ehcache xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:noNamespaceSchemaLocation=&quot;http://ehcache.org/ehcache.xsd&quot;
         name=&quot;ZONG&quot;
         updateCheck=&quot;false&quot;
         maxBytesLocalHeap=&quot;16M&quot;&gt;

    &lt;diskStore path=&quot;/data/app/cache/ehcache&quot;/&gt; &lt;!--磁盘路径--&gt;
    &lt;defaultCache
            eternal=&quot;false&quot;
            overflowToDisk=&quot;false&quot;
            maxElementsInMemory=&quot;10000&quot;
            timeToIdleSeconds=&quot;3600&quot;
            timeToLiveSeconds=&quot;36000&quot;
    /&gt;
&lt;/ehcache&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在里面添加 cache-template 和 cache 标签,然后使用的时候[[@CacheConfig(cacheNames ](/CacheConfig(cacheNames ) ](/CacheConfig(cacheNames ) = {&quot;myuser&quot;})中的cacheNames的名字，xml中的alias必须也有，不然会报找不到缓存名。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>     &lt;cache name=&quot;user&quot; eternal=&quot;false&quot;
           timeToIdleSeconds=&quot;120&quot; timeToLiveSeconds=&quot;600&quot; overflowToDisk=&quot;true&quot; /&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意自己定义的cache中不能添加maxElementsInMemory属性,否则会报错</p><h3 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> Redis</h3><ul><li>对于分布式应用，通常都会将缓存放在一台或者多台专门的缓存服务器上。使用Redis作为缓存是一种常用的选择。Redis不仅可以作为缓存,后续将会对Redis深入学习.</li></ul><h4 id="依赖和配置-1" tabindex="-1"><a class="header-anchor" href="#依赖和配置-1" aria-hidden="true">#</a> 依赖和配置</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- redis依赖commons-pool --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>配置如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.cache.type=Redis
spring.redis.host=127.0.0.1
spring.redis.port=6379
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="定制缓存" tabindex="-1"><a class="header-anchor" href="#定制缓存" aria-hidden="true">#</a> 定制缓存</h4><p>可以通过对RedisCacheManager进行定制缓存存活时间\序列化等,也可以不进行额外的配置,此时直接测试可见Redis中已经有放进来的缓存了.</p><p>RedisCacheManager默认使用的是JdkSerializationRedisSerializer,可以使用Jackson2JsonRedisSerializer 比如这样的配置,配置了CacheManager的同时 将RedisCacheManager 和RedisTemplate都配置了Jackson解析器.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> package com.demo.config;

import com.fasterxml.jackson.annotation.JsonAutoDetect;
import com.fasterxml.jackson.annotation.PropertyAccessor;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration;
import org.springframework.cache.annotation.CachingConfigurerSupport;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.cache.RedisCacheConfiguration;
import org.springframework.data.redis.cache.RedisCacheManager;
import org.springframework.data.redis.cache.RedisCacheWriter;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.*;

import java.time.Duration;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

@Configuration
@AutoConfigureAfter(RedisAutoConfiguration.class)
public class CacheConfig extends CachingConfigurerSupport {

     @Bean(name = &quot;redisTemplate&quot;)
     public RedisTemplate&lt;String,Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory){
         RedisTemplate&lt;String,Object&gt; redisTemplate = new RedisTemplate&lt;&gt;();
         redisTemplate.setConnectionFactory(redisConnectionFactory);
         redisTemplate.setKeySerializer(keySerializer());
         redisTemplate.setHashKeySerializer(keySerializer());
         redisTemplate.setValueSerializer(valueSerializer());
         redisTemplate.setHashValueSerializer(valueSerializer());
         return redisTemplate;
     }

    private RedisSerializer&lt;String&gt; keySerializer() {
        return new StringRedisSerializer();
    }
    private RedisSerializer&lt;Object&gt; valueSerializer() {
        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        return jackson2JsonRedisSerializer;
    }
    @Bean
    public RedisCacheManager redisCacheManager(RedisConnectionFactory factory) {

        // 生成一个默认配置，通过config对象即可对缓存进行自定义配置
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(valueSerializer()));

        // 设置缓存的默认过期时间，也是使用Duration设置
        config = config.entryTtl(Duration.ofMinutes(10))
                .disableCachingNullValues();     // 不缓存空值

        // 设置一个初始化的缓存空间set集合
        Set&lt;String&gt; cacheNames = new HashSet&lt;&gt;();
        cacheNames.add(&quot;space&quot;);
        cacheNames.add(&quot;user&quot;);

        // 对每个缓存空间应用不同的配置
        Map&lt;String, RedisCacheConfiguration&gt; configMap = new HashMap&lt;&gt;();
        // 通过Duration可以自己实现以什么时间为单位
        configMap.put(&quot;space&quot;, config.entryTtl(Duration.ofMinutes(1)));
        configMap.put(&quot;user&quot;, config.entryTtl(Duration.ofSeconds(10)));

        return RedisCacheManager
                .builder(RedisCacheWriter.nonLockingRedisCacheWriter(factory))
                .initialCacheNames(cacheNames)
                 .withInitialCacheConfigurations(configMap)
                .cacheDefaults(config).build();
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.08em;" aria-hidden="true" width="17.28" height="17.28" viewbox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/zongkx/zongkx.github.io/edit/main/notes/java/SpringBoot基础.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/java/SpringBoot-%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86DataSourceBean.html" class="" aria-label="SpringBoot-动态管理DataSourceBean.md"><!--[--><!--]--> SpringBoot-动态管理DataSourceBean.md <!--[--><!--]--></a></span><span class="next"><a href="/java/SpringBoot%E8%BF%9B%E9%98%B6.html" class="" aria-label="SpringBoot进阶.md"><!--[--><!--]--> SpringBoot进阶.md <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----></div><!--]--></div>
    <script type="module" src="/assets/app.6a98a4dc.js" defer></script>
  </body>
</html>

import{_ as t,o as e,c as o,b as a,d as c,F as l,a as s,e as n,r as u}from"./app.d740ecc1.js";const r={},i=s('<h2 id="\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72" aria-hidden="true">#</a> \u90E8\u7F72</h2><h3 id="\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4" aria-hidden="true">#</a> \u96C6\u7FA4</h3><h3 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h3><ol><li>github\u4E0B\u8F7Dtar\u89E3\u538B\u7F29\u5230/opt\u4E0B,\u66F4\u65B0 application.properties \u7684\u6570\u636E\u5E93\u914D\u7F6E,\u53EF\u76F4\u63A5\u4F7F\u7528OB\u66FF\u4EE3mysql</li><li>\u8FDB\u5165 cluster.conf \u6DFB\u52A0\u96C6\u7FA4\u8282\u70B9(\u81F3\u5C113\u8282\u70B9)</li></ol>',4),k=n("\u9700\u8981\u6CE8\u610F\u7684\u662F "),b={href:"https://nacos.io/zh-cn/docs/2.0.0-compatibility.html",target:"_blank",rel:"noopener noreferrer"},d=n("https://nacos.io/zh-cn/docs/2.0.0-compatibility.html"),m=n(" Nacos2.0\u7248\u672C\u76F8\u6BD41.X\u65B0\u589E\u4E86gRPC\u7684\u901A\u4FE1\u65B9\u5F0F\uFF0C\u56E0\u6B64\u9700\u8981\u589E\u52A02\u4E2A\u7AEF\u53E3\u3002\u65B0\u589E\u7AEF\u53E3\u662F\u5728\u914D\u7F6E\u7684\u4E3B\u7AEF\u53E3(server.port)\u57FA\u7840\u4E0A\uFF0C\u8FDB\u884C\u4E00\u5B9A\u504F\u79FB\u91CF\u81EA\u52A8\u751F\u6210\u3002"),g=s(`<table><thead><tr><th>\u7AEF\u53E3</th><th>\u4E0E\u4E3B\u7AEF\u53E3\u7684\u504F\u79FB\u91CF</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>9848</td><td>1000</td><td>\u5BA2\u6237\u7AEFgRPC\u8BF7\u6C42\u670D\u52A1\u7AEF\u7AEF\u53E3\uFF0C\u7528\u4E8E\u5BA2\u6237\u7AEF\u5411\u670D\u52A1\u7AEF\u53D1\u8D77\u8FDE\u63A5\u548C\u8BF7\u6C42</td></tr><tr><td>9849</td><td>1001</td><td>\u670D\u52A1\u7AEFgRPC\u8BF7\u6C42\u670D\u52A1\u7AEF\u7AEF\u53E3\uFF0C\u7528\u4E8E\u670D\u52A1\u95F4\u540C\u6B65\u7B49</td></tr></tbody></table><p><strong>\u4F7F\u7528VIP/nginx\u8BF7\u6C42\u65F6\uFF0C\u9700\u8981\u914D\u7F6E\u6210TCP\u8F6C\u53D1\uFF0C\u4E0D\u80FD\u914D\u7F6Ehttp2\u8F6C\u53D1\uFF0C\u5426\u5219\u8FDE\u63A5\u4F1A\u88ABnginx\u65AD\u5F00\u3002</strong></p><h3 id="service\u6CE8\u518C" tabindex="-1"><a class="header-anchor" href="#service\u6CE8\u518C" aria-hidden="true">#</a> service\u6CE8\u518C</h3><blockquote><p>systemctl enable nacos.service</p></blockquote><blockquote><p>[Unit] Description=nacos After=network.target</p><p>[Service] Type=forking ExecStart=/opt/nacos/bin/startup.sh ExecReload=/opt/nacos/bin/shutdown.sh ExecStop=/opt/nacos/bin/shutdown.sh PrivateTmp=true</p><p>[Install] WantedBy=multi-user.target</p></blockquote><h2 id="springboot" tabindex="-1"><a class="header-anchor" href="#springboot" aria-hidden="true">#</a> SpringBoot</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>nacos<span class="token operator">-</span>config<span class="token operator">-</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">0.2</span><span class="token number">.11</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u7528\u4E8E\u89E3\u51B3bean\u5237\u65B0\u7684\u95EE\u9898<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>context<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.0</span><span class="token number">.3</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="\u591A\u73AF\u5883profile\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u591A\u73AF\u5883profile\u95EE\u9898" aria-hidden="true">#</a> \u591A\u73AF\u5883Profile\u95EE\u9898</h3><p>\u4E3A\u4E86\u80FD\u591F\u5229\u7528mvn\u7684profile\u80FD\u529B,\u533A\u5206\u4E0D\u540C\u73AF\u5883\u7684\u914D\u7F6E\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>demo
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>profile<span class="token punctuation">-</span>name<span class="token punctuation">}</span>

<span class="token key atrule">nacos</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.203.1<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 98ab843c<span class="token punctuation">-</span>e546<span class="token punctuation">-</span>4fdd<span class="token punctuation">-</span>be7a<span class="token punctuation">-</span>189494fb7872
    <span class="token key atrule">data-id</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>$<span class="token punctuation">{</span>profile<span class="token punctuation">-</span>name<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">auto-refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">group</span><span class="token punctuation">:</span> DEFAULT_GROUP
    <span class="token key atrule">type</span><span class="token punctuation">:</span> yaml
    <span class="token key atrule">bootstrap</span><span class="token punctuation">:</span>
      <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">log-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21561641/1658469470151-a315dcc5-2ce5-4f83-bdbc-69d1d8c35903.png#clientId=ue0bb4431-b2d8-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=92&amp;id=u956d26a1&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=92&amp;originWidth=1289&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=8450&amp;status=done&amp;style=none&amp;taskId=u92bf4689-9d14-401e-9e14-4ea5bf1c8a1&amp;title=&amp;width=1289" alt="image.png"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@NacosConfigurationProperties</span><span class="token punctuation">(</span>dataId <span class="token operator">=</span> <span class="token string">&quot;\${nacos.config.data-id}&quot;</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> autoRefreshed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Conf</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> custom<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6216\u8005\u4F7F\u7528 <code>spring-cloud-context</code>\u5305\u4E2D <code>@RefreshScope</code>\u6CE8\u89E3\u540C\u6837\u53EF\u4EE5\u5B9E\u73B0\u81EA\u52A8\u5237\u65B0\u914D\u7F6E\u7684\u529F\u80FD,\u4E0D\u8FC7\u8BE5\u6CE8\u89E3\u9700\u8981\u5B9E\u73B0\u4E00\u4E2A\u76D1\u542C\u5668</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.data.mongodb&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MongoBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uri<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ContextRefresher</span> contextRefresher<span class="token punctuation">;</span>    
    <span class="token annotation punctuation">@NacosConfigListener</span><span class="token punctuation">(</span>dataId <span class="token operator">=</span>  <span class="token string">&quot;\${nacos.config.data-id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aaaa</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;refresh&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> contextRefresher<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="bean\u5237\u65B0\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#bean\u5237\u65B0\u95EE\u9898" aria-hidden="true">#</a> bean\u5237\u65B0\u95EE\u9898</h3><p>\u4E0E\u524D\u9762\u540C\u6837\u7684\u63AA\u65BD,\u9700\u8981 <code>contextRefresher</code>\u548C <code>@NacosConfigListener</code> \u4EE5<code>Mysql</code>\u548C<code>JdbcTemplate</code>\u4E3A\u4F8B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MysqlBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DbConf</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@RefreshScope</span><span class="token comment">// \u8BE5\u6CE8\u89E3\u653E\u5728 \u7C7B\u4E0A\u5B58\u5728\u4E0D\u751F\u6548\u7684\u95EE\u9898,\u6B64\u5904\u6682\u65F6\u6CA1\u6709\u6DF1\u5165\u7814\u7A76</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">MysqlBean</span> mysqlBean<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">HikariConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span>mysqlBean<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>mysqlBean<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>mysqlBean<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setMaxLifetime</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@DependsOn</span><span class="token punctuation">(</span><span class="token string">&quot;dataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RefreshScope</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">jdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>nacos\u914D\u7F6E\u6587\u4EF6:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">mysql</span><span class="token punctuation">:</span>
<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//39.97.243.43<span class="token punctuation">:</span>3306/xxl
<span class="token key atrule">name</span><span class="token punctuation">:</span> root
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">11111</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6B64\u65F6\u4FEE\u6539url\u4E2D\u7684\u6570\u636E\u5E93\u8FDE\u63A5,\u53EF\u4EE5\u81EA\u52A8\u66F4\u65B0<code>DataSource</code>\u548C<code> JdbcTemplate</code>bean</p>`,22);function h(f,y){const p=u("ExternalLinkIcon");return e(),o(l,null,[i,a("p",null,[k,a("a",b,[d,c(p)]),m]),g],64)}var w=t(r,[["render",h],["__file","Nacos.html.vue"]]);export{w as default};

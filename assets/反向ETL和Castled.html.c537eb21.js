import{_ as a,a as n}from"./app.6a98a4dc.js";const e={},s=n(`<p><a href="https://hub.fastgit.xyz/castledio/castled" target="_blank" rel="noopener noreferrer">https://hub.fastgit.xyz/castledio/castled</a></p><p><a href="https://docs.castled.io/" target="_blank" rel="noopener noreferrer">https://docs.castled.io/</a></p><h2 id="\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a> \u7B80\u4ECB</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/21561641/1646895719338-c72efec5-107d-4741-8ff0-20e8d63966dc.png#clientId=ue59b4c7a-bcf2-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=368&amp;id=uea13457f&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=654&amp;originWidth=810&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=96358&amp;status=done&amp;style=none&amp;taskId=u87238297-3661-4b78-bac8-04aa441c020&amp;title=&amp;width=456" alt="image.png"></p><h3 id="\u53CD\u5411etl" tabindex="-1"><a class="header-anchor" href="#\u53CD\u5411etl" aria-hidden="true">#</a> \u53CD\u5411ETL</h3><ol><li>\u6838\u5FC3\u5728\u4E8E DataWareHouse \u6570\u636E\u5206\u53D1\u5230\u4E0B\u6E38\u7CFB\u7EDF</li><li>\u76F8\u8F83\u4E8Eetl \u5F80\u5F80\u5B9E\u73B0\u7684\u662F \u4E1A\u52A1\u6570\u636E\u6536\u96C6\u7684\u529F\u80FD,\u800C\u53CD\u5411etl\u5DE5\u5177\u5B9E\u73B0\u7684\u662F\u6570\u636E\u5206\u53D1\u7684\u529F\u80FD.</li><li>\u540C\u7C7B\u7684\u8FD8\u6709 <code>Census\`\`Grouparoo</code></li><li>\u53CD\u5411etl\u503C\u5F97\u5B66\u4E60\u7684\u5730\u65B9\u5728\u4E8E <code>sink</code>\u7684\u7075\u6D3B \u96C6\u6210</li></ol><h3 id="\u589E\u91CF\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#\u589E\u91CF\u529F\u80FD" aria-hidden="true">#</a> \u589E\u91CF\u529F\u80FD</h3><p>castled \u5B9E\u73B0\u4E86 \u589E\u91CF/\u5168\u91CF\u7684\u63A8\u9001\u529F\u80FD,\u57FA\u4E8E snapshot\u5B9E\u73B0\u589E\u91CF\u529F\u80FD</p><p>\u5176\u6E90\u7801 <code>/connectors</code>\u6A21\u5757\u4E0B\u7684 <code>io.castled.warehouses.connectors.postgres</code>\u5305\u4E2D\u5927\u6982\u63D0\u793A\u4E86\u5176\u5728\u4F7F <code>pg source </code>\u65F6\u7684 diff \u7684\u6838\u5FC3\u903B\u8F91:</p><p>\u901A\u8FC7 pg\u7684<code>except</code>\u914D\u5408 <code>uncommit_snapshot</code>\u548C <code>commit_snapshot</code>\u5B9E\u73B0\u4E86\u6570\u636Ediff,\u8FDB\u884C\u589E\u91CF\u63A8\u9001.</p><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h3><h2 id="\u5B89\u88C5\u8BD5\u7528" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5\u8BD5\u7528" aria-hidden="true">#</a> \u5B89\u88C5\u8BD5\u7528</h2><p>docker-compose: \u4E0B\u8F7D\u6E90\u7801,\u5176\u4E2D<code> .env</code>\u548C<code>docker-compose.yaml </code>\u653E\u5230<code> /opt/castled</code>\u4E2D\u6267\u884C</p><blockquote><p>docker-compose up -d</p></blockquote><blockquote><p><a href="http://192.168.203.128:3000" target="_blank" rel="noopener noreferrer">http://192.168.203.128:3000</a></p></blockquote><p>\u6DFB\u52A0\u6570\u636E\u6E90 <img src="https://cdn.nlark.com/yuque/0/2022/png/21561641/1646895865435-cb58b06b-9025-443b-b051-0c6d1f8f5c97.png#clientId=ue59b4c7a-bcf2-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=386&amp;id=u16195cad&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=706&amp;originWidth=930&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44090&amp;status=done&amp;style=none&amp;taskId=udbe6f4ef-354c-4c35-a7ae-e7f8f71059c&amp;title=&amp;width=509" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/21561641/1646896656612-572313ca-0098-4778-ba8e-4a9736cb1a40.png#clientId=ue59b4c7a-bcf2-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=436&amp;id=u05a65ade&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=789&amp;originWidth=933&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46382&amp;status=done&amp;style=none&amp;taskId=uf0a708b9-8b89-4bb2-8a17-e9b33c768e1&amp;title=&amp;width=515" alt="image.png"></p><h2 id="\u6E90\u7801\u5B66\u4E60" tabindex="-1"><a class="header-anchor" href="#\u6E90\u7801\u5B66\u4E60" aria-hidden="true">#</a> \u6E90\u7801\u5B66\u4E60</h2><h3 id="datapoll" tabindex="-1"><a class="header-anchor" href="#datapoll" aria-hidden="true">#</a> DataPoll</h3><p>\u5BF9\u4E8E\u4E0D\u540C\u7684 source \u800C\u8A00,diff \u529F\u80FD\u7684\u5B9E\u73B0\u5E76\u4E0D\u76F8\u540C,\u4F46\u903B\u8F91\u65F6\u76F8\u901A\u7684. <img src="https://cdn.nlark.com/yuque/0/2022/png/21561641/1646896888003-d0a96db7-a2e6-4541-a61b-9ce510cf3513.png#clientId=ue59b4c7a-bcf2-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=220&amp;id=u873901ca&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=220&amp;originWidth=676&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39990&amp;status=done&amp;style=none&amp;taskId=uc6fb4f8c-840d-41ec-a177-6c41b247378&amp;title=&amp;width=676" alt="image.png"></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>package io.castled.warehouses;

import io.castled.constants.ConnectorExecutionConstants;
import io.castled.warehouses.models.WarehousePollContext;
import io.castled.warehouses.models.WarehousePollResult;

import java.nio.file.Path;


public interface WarehouseDataPoller <span class="token punctuation">{</span>

    WarehousePollResult pollRecords(WarehousePollContext warehousePollContext);

    WarehousePollResult resumePoll(WarehousePollContext warehousePollContext);

    void cleanupPipelineRunResources(WarehousePollContext warehousePollContext);

    void cleanupPipelineResources(String pipelineUUID<span class="token punctuation">,</span> WarehouseConfig warehouseConfig);

    default Path getPipelineRunUnloadDirectory(String pipelineUUID<span class="token punctuation">,</span> Long pipelineRunId) <span class="token punctuation">{</span>
        return ConnectorExecutionConstants.WAREHOUSE_UNLOAD_DIR_PATH.resolve(pipelineUUID).resolve(String.valueOf(pipelineRunId));
    <span class="token punctuation">}</span>

    default Path getPipelineUnloadDirectory(String pipelineUUID) <span class="token punctuation">{</span>
        return ConnectorExecutionConstants.WAREHOUSE_UNLOAD_DIR_PATH.resolve(pipelineUUID);
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>\u5176\u4E2D\u6838\u5FC3\u5728\u4E8E <code>pollRecords</code>\u548C <code>resumePoll</code>, \u540E\u8005\u533A\u522B\u662F\u975E\u9996\u6B21\u63A8\u9001</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>    private String getDataFetchQuery(WarehousePollContext warehousePollRequest<span class="token punctuation">,</span> List&lt;String<span class="token punctuation">&gt;</span> bookKeepingTables) <span class="token punctuation">{</span>
        String committedSnapshot = ConnectorExecutionConstants.getQualifiedCommittedSnapshot(warehousePollRequest.getPipelineUUID());
        String uncommittedSnapshot = ConnectorExecutionConstants.getQualifiedUncommittedSnapshot(warehousePollRequest.getPipelineUUID());
        if (bookKeepingTables.contains(ConnectorExecutionConstants.getCommittedSnapshot(warehousePollRequest.getPipelineUUID()))) <span class="token punctuation">{</span>
            return String.format(&quot;select * from %s except select * from %s&quot;<span class="token punctuation">,</span> uncommittedSnapshot<span class="token punctuation">,</span> committedSnapshot);
        <span class="token punctuation">}</span>
        return String.format(&quot;select * from %s&quot;<span class="token punctuation">,</span> uncommittedSnapshot);
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>pg</code>\u7684\u5B9E\u73B0\u6838\u5FC3\u4FBF\u662F\u4E0A\u9762\u7684\u4EE3\u7801.</p><h3 id="app-sink-\u62BD\u8C61" tabindex="-1"><a class="header-anchor" href="#app-sink-\u62BD\u8C61" aria-hidden="true">#</a> App(Sink)\u62BD\u8C61</h3><p>castld\u4E3A\u4E86\u65B9\u4FBF\u5404\u79CD<code>sink</code>\u96C6\u6210,\u62BD\u8C61\u51FA\u4E86 <code>DataSink</code>\u63A5\u53E3</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataSink</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">syncRecords</span><span class="token punctuation">(</span><span class="token class-name">DataSinkRequest</span> dataSinkRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

    <span class="token class-name">AppSyncStats</span> <span class="token function">getSyncStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u6211\u7684\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u6211\u7684\u65B9\u6848" aria-hidden="true">#</a> \u6211\u7684\u65B9\u6848</h2><p>\u5229\u7528dremio\u7684 create view select as \u548C except(\u53D6\u5DEE\u96C6)\u7684\u80FD\u529B, \u9488\u5BF9\u67D0\u4E9B\u7279\u5B9A\u7684\u6A21\u578B,\u6307\u5B9A\u8C03\u5EA6\u4EFB\u52A1\u8FDB\u884C\u6570\u636E\u5FEB\u7167,\u5E76\u8FDB\u884Cs3\u5B58\u50A8(parquet) \u5FEB\u7167\u540E\u7684\u6570\u636E\u53EF\u4EE5\u7528\u6765diff\u4E5F\u53EF\u4EE5\u7528\u6765\u6EAF\u6E90\u7B49.</p><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/21561641/1649301232501-5c4b77dd-29f0-48a8-8dec-cba63a150929.jpeg" alt=""></p><p>\u53CD\u5411etl\u7684\u6838\u5FC3\u5728\u4E8E\u6269\u5C55\u6027,dremio\u4F5C\u4E3A\u6570\u636E\u6E56\u5F15\u64CE\u63D0\u4F9B\u4E86source\u7AEF\u7684\u5F3A\u5927\u80FD\u529B,\u91CD\u70B9\u5728\u4E8Esink\u7684\u6807\u51C6\u63A5\u53E3\u58F0\u660E \u5BF9\u4E8E\u4E0D\u540C\u7684\u4E0B\u6E38\u7CFB\u7EDF,\u53EF\u80FD\u5B58\u5728\u4E0D\u540C\u7684\u63A5\u53E3\u89C4\u8303,\u57FA\u4E8Epf4j\u7684\u63D2\u4EF6\u5316\u80FD\u529B,\u4EE5\u53CAeasybatch\u7684writer\u7684\u6807\u51C6\u58F0\u660E,\u53EF\u4EE5\u6781\u5927\u7A0B\u5EA6\u4E0A\u63D0\u9AD8\u7CFB\u7EDF\u7684\u6269\u5C55\u6027.</p>`,30);function p(t,o){return s}var i=a(e,[["render",p],["__file","\u53CD\u5411ETL\u548CCastled.html.vue"]]);export{i as default};
